<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>PlugIn And Repository</title>
      <link href="/2022/08/04/Tao-2022-2022-08-04-PlugInAndRepository/"/>
      <url>/2022/08/04/Tao-2022-2022-08-04-PlugInAndRepository/</url>
      <content type="html"><![CDATA[<h1 id="插件式架构与仓储模式"><a href="#插件式架构与仓储模式" class="headerlink" title="插件式架构与仓储模式"></a>插件式架构与仓储模式</h1><h1 id="插件式架构"><a href="#插件式架构" class="headerlink" title="插件式架构"></a>插件式架构</h1><p><img src="/img/2022/plugin_arch.png" alt="plugin"></p><p>Uncle Blob 在《Clean Architecture》提到了一种叫插件式架构的架构模式。<br>具体实现就是把数据库和GUI这2个层当做插件， 系统的核心就是业务逻辑层。<br>既然是插件就是代表可以切换别的插件，比如数据库可以是mysql，Oracle， 也可以是NoSQL，甚至是文件系统。GUI可以是VUE实现，也可以是react实现。</p><h1 id="仓储模式"><a href="#仓储模式" class="headerlink" title="仓储模式"></a>仓储模式</h1><p>将业务逻辑与数据存储隔离的做法，和DDD里的仓储模式（Repository）不谋而合。 </p><p><img src="/img/2022/ddd-repo.png" alt="repo"></p><h1 id="真正的单元测试"><a href="#真正的单元测试" class="headerlink" title="真正的单元测试"></a>真正的单元测试</h1><p>业务逻辑不依赖具体实现的好处就是可以独立测试，这是单元测试实现的最理想的方式了，如果你的测试需要一个正在的运行的数据库，或者一个支持控制逻辑运行的web容器，那这绝对是一个假的单元测试， 通常我们叫这种测试为集成测试，而且它通常是不稳定，且易碎的。</p>]]></content>
      
      <categories>
          
          <category> Dao </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>minikube start issue</title>
      <link href="/2021/11/24/Tech-2021-2021-11-24-minikubeStartIssue/"/>
      <url>/2021/11/24/Tech-2021-2021-11-24-minikubeStartIssue/</url>
      <content type="html"><![CDATA[<h1 id="minikube-start-issue"><a href="#minikube-start-issue" class="headerlink" title="minikube start issue"></a>minikube start issue</h1><p>把macos升级到 <em>Monterey</em>之后， 发现minkube start 失败了。<br>报一个<em>bsdthread_register error</em>的错误，具体日志如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">minikube start</span><br><span class="line">fatal error: runtime: bsdthread_register error</span><br><span class="line"></span><br><span class="line">runtime stack:</span><br><span class="line">runtime.throw(0x20b9368, 0x21)</span><br><span class="line">/usr/local/go/src/runtime/panic.go:605 +0x95 fp=0x7ff7bfeff560 sp=0x7ff7bfeff540 pc=0x102b565</span><br><span class="line">runtime.goenvs()</span><br><span class="line">/usr/local/go/src/runtime/os_darwin.go:108 +0x83 fp=0x7ff7bfeff590 sp=0x7ff7bfeff560 pc=0x1028e03</span><br><span class="line">runtime.schedinit()</span><br><span class="line">/usr/local/go/src/runtime/proc.go:482 +0xa1 fp=0x7ff7bfeff5d0 sp=0x7ff7bfeff590 pc=0x102df11</span><br><span class="line">runtime.rt0_go(0x7ff7bfeff608, 0x2, 0x7ff7bfeff608, 0x0, 0x1000000, 0x2, 0x7ff7bfeff810, 0x7ff7bfeff819, 0x0, 0x7ff7bfeff81f, ...)</span><br><span class="line">/usr/local/go/src/runtime/asm_amd64.s:175 +0x1eb fp=0x7ff7bfeff5d8 sp=0x7ff7bfeff5d0 pc=0x1058d2b</span><br></pre></td></tr></table></figure><p>google了一轮解决方案，试了不少方式：<br>升级brew、minikube、go、docker等，还是不行。</p><p>查了一下官网文档，发现有一段描述了：</p><blockquote><p>If which minikube fails after installation via brew, you may have to remove the old minikube links and link the newly installed binary:<br>brew unlink minikube<br>brew link minikube</p></blockquote><p>最后overwrite brew link解决了问题。</p><pre><code>brew link --overwrite minikube</code></pre><p>运行minikube status， 正常启动。</p><pre><code class="shell">minikubetype: Control Planehost: Runningkubelet: Runningapiserver: Runningkubeconfig: Configured</code></pre><h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><ul><li><a href="https://github.com/kubernetes/minikube/issues/12832" target="_blank" rel="noopener">https://github.com/kubernetes/minikube/issues/12832</a></li><li><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank" rel="noopener">https://minikube.sigs.k8s.io/docs/start/</a></li></ul>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Web Secure Test Tech</title>
      <link href="/2020/06/28/Art-2020-2020-06-28-WebSecureTestTech/"/>
      <url>/2020/06/28/Art-2020-2020-06-28-WebSecureTestTech/</url>
      <content type="html"><![CDATA[<h1 id="Web-应用安全测试技术速览"><a href="#Web-应用安全测试技术速览" class="headerlink" title="Web 应用安全测试技术速览"></a>Web 应用安全测试技术速览</h1><h1 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h1><p>Web 应用安全测试技术主要有 3 种:</p><ol><li>DAST</li><li>SAST</li><li>IAST</li></ol><h1 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h1><p><img src="/img/2020/websercue-1.png" alt="img"></p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>不同时期选择不同的工具,例如:</p><blockquote><p>日常迭代开发的时候嵌入 SAST<br>项目上线验收前嵌入 DAST 和 IAST</p></blockquote>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>First Learn on Go Language 5 execution</title>
      <link href="/2020/06/18/Tech-2020-2020-06-24-FirstLearnOnGo5/"/>
      <url>/2020/06/18/Tech-2020-2020-06-24-FirstLearnOnGo5/</url>
      <content type="html"><![CDATA[<h1 id="Go语言初学记-（四）-运行篇"><a href="#Go语言初学记-（四）-运行篇" class="headerlink" title="Go语言初学记 （四）:  运行篇"></a>Go语言初学记 （四）:  运行篇</h1><h1 id="原文再续"><a href="#原文再续" class="headerlink" title="原文再续"></a>原文再续</h1><p>上一篇 <a href="http://antinomy.top/2020/05/29/Tech-2020-2020-06-12-FirstLearnOnGo4/">Go语言初学记 (四）: 配置篇</a> 介绍了如何在实际项目中使用配置文件,来实现灵活配置功能.<br>看板的基本功能都已实现,接下来是做一些扩展功能.</p><h1 id="绘制看板"><a href="#绘制看板" class="headerlink" title="绘制看板"></a>绘制看板</h1><p>通过 <a href="https://github.com/bndr/gotabulate" target="_blank" rel="noopener">gotabulate</a> 可以很方便地在命令行的模式下打印表格,利用这个功能,就可以实现看板的看了.</p><p><img src="/img/2020/go-5-1.png" alt="img"></p><p>为了给看板提供灵活的展示形态, 设计了用于展示数据的数据结构KanSpec.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// KanSpec vo</span></span><br><span class="line"><span class="keyword">type</span> KanSpec <span class="keyword">struct</span> &#123;</span><br><span class="line">    hearders      []<span class="keyword">string</span></span><br><span class="line">    maxCellSize   <span class="keyword">int</span></span><br><span class="line">    owners        []<span class="keyword">string</span></span><br><span class="line">    priorities    []<span class="keyword">string</span></span><br><span class="line">    projects      []<span class="keyword">string</span></span><br><span class="line">    deadlineTypes []<span class="keyword">string</span></span><br><span class="line">    rows          [][]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    taskMap       <span class="keyword">map</span>[<span class="keyword">string</span>]kt.Task</span><br><span class="line">    banMap        <span class="keyword">map</span>[<span class="keyword">string</span>]Ban</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Kan</span><span class="params">(kanban Kanban, taskItem kt.TaskItem)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> kanSpec KanSpec = getKanSpec(kanban, taskItem)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ts kt.TaskService = <span class="built_in">new</span>(kt.FileWay)</span><br><span class="line"></span><br><span class="line">    tskItem := <span class="keyword">string</span>(taskItem)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> viewType = ts.FillBlank(<span class="string">"Kan View : "</span>+tskItem, kanSpec.maxCellSize)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> today = ts.FillBlank(<span class="string">"Today    : "</span>+time.Now().Format(<span class="string">"0102"</span>), kanSpec.maxCellSize)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println</span>(viewType)</span><br><span class="line">    <span class="built_in">println</span>(today)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create an object from 2D interface array</span></span><br><span class="line"></span><br><span class="line">    table := gotabulate.Create(kanSpec.rows)</span><br><span class="line"></span><br><span class="line">    table.SetHeaders(kanSpec.hearders)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the Empty String (optional)</span></span><br><span class="line">    <span class="comment">// t.SetEmptyString("")</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set Align (Optional)</span></span><br><span class="line">    table.SetAlign(<span class="string">"left"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set Max Cell Size</span></span><br><span class="line">    table.SetMaxCellSize(kanSpec.maxCellSize)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Turn On String Wrapping</span></span><br><span class="line">    table.SetWrapStrings(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Print the result: grid, or simple</span></span><br><span class="line">    fmt.Println(table.Render(<span class="string">"grid"</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gotabulate的用起来也很简单,设置好表头,宽度之类就能开箱即用了.</p><h1 id="联动系统编辑器"><a href="#联动系统编辑器" class="headerlink" title="联动系统编辑器"></a>联动系统编辑器</h1><p>通过命令管理任务的时候, 使用系统的命令,可以很方便的调用起系统设定的编辑器. </p><p>比如我打开一个的任务的时候, 自动调用 vscode 来编辑任务文件.<br>这个功能主要是通过”os/exec”来实现:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// absPath 任务文件的路径</span></span><br><span class="line"></span><br><span class="line">cmd := exec.Command(<span class="string">"open"</span>, <span class="string">"-n"</span>, <span class="string">"-b"</span>, <span class="string">"com.microsoft.VSCode"</span>, <span class="string">"--args"</span>, absPath)</span><br><span class="line">cmd.Env = os.Environ()</span><br><span class="line"></span><br><span class="line">err := cmd.Run()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"EXECUTE COMMAND ERROR : "</span> + err.Error())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="版本管理"><a href="#版本管理" class="headerlink" title="版本管理"></a>版本管理</h1><p>看板G的设计理念是通过最简单的系统文件IO来管理任务的数据和状态, 为了保证数据不会丢失和历史可回溯, 我引进了 GIT 来进行版本管理.</p><p>GIT如何使用不在此处展开,毕竟这是每个程序员该有的基本素养. :)</p><p>为了让同步做得更方便一点, 我设计了主动同步和被动同步.</p><h2 id="脚本实现"><a href="#脚本实现" class="headerlink" title="脚本实现"></a>脚本实现</h2><p>编辑一个简单的 shell 脚本, 可以实现代码的一键提交+推送</p><p>新建文件lazyGit.sh, 内容如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">current_path=$(<span class="built_in">cd</span> $(dirname <span class="string">"<span class="variable">$&#123;BASH_SOURCE[0]&#125;</span>"</span>) &amp;&amp; <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Git working on path : <span class="variable">$current_path</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$current_path</span></span><br><span class="line"></span><br><span class="line">git add -A</span><br><span class="line"></span><br><span class="line">git commit  -m <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line"></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure><h2 id="主动同步"><a href="#主动同步" class="headerlink" title="主动同步"></a>主动同步</h2><p>通过看板命令输入指定命令来触发主动同步, 比如当我输入 g 的时候就触发同步.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lasyGit</span><span class="params">(execPath <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> lasyGitShell = execPath + <span class="string">"/lazyGit.sh"</span></span><br><span class="line">    <span class="keyword">var</span> commitStr = <span class="string">"GitSyncOn:["</span> + time.Now().Format(<span class="string">"2006-01-02 15:04:05"</span>+<span class="string">"]"</span>)</span><br><span class="line">    _, err := kb.Exec(lasyGitShell, commitStr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">println</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="被动同步"><a href="#被动同步" class="headerlink" title="被动同步"></a>被动同步</h2><p>一开始我设计被动同步的策略是统计指定命令的次数, 当次数达到指定值的时候就触发同步.</p><p>这里使用了关键字 go 来启用多线程,避免因为同步问题影响看板使用.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> autoGitCounter <span class="keyword">int</span> = <span class="number">5</span> </span><br><span class="line"><span class="keyword">var</span> gitcouter <span class="keyword">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">autoGit</span><span class="params">(execPath <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> gitcouter &gt;= autoGitCounter &#123;</span><br><span class="line">        gitcouter = <span class="number">0</span></span><br><span class="line">        <span class="keyword">go</span> lasyGit(execPath)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gitcouter++</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>后面我改变的策略, 统计本地改动过的文件数量,超过指定值的时候才触发同步</p><p>编写一个脚本统计文件数量,新建文件countGit.sh 内容如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">current_path=$(<span class="built_in">cd</span> $(dirname <span class="string">"<span class="variable">$&#123;BASH_SOURCE[0]&#125;</span>"</span>) &amp;&amp; <span class="built_in">pwd</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$current_path</span></span><br><span class="line"></span><br><span class="line">git status -s | wc -l</span><br></pre></td></tr></table></figure><p>修改autoGit代码,通过 exec 调用脚本, 处理非数字字符.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">autoGit</span><span class="params">(execPath <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> countResult = countGit(execPath)</span><br><span class="line"></span><br><span class="line">    countResult = strings.Trim(countResult, <span class="string">"\n"</span>)</span><br><span class="line">    countResult = strings.TrimSpace(countResult)</span><br><span class="line"></span><br><span class="line">    changeFileNum, err := strconv.Atoi(countResult)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    gitcouter = changeFileNum</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> gitcouter &gt;= autoGitCounter &#123;</span><br><span class="line">        gitcouter = <span class="number">0</span></span><br><span class="line">        <span class="keyword">go</span> lasyGit(execPath)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countGit</span><span class="params">(execPath <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> countGitShell = execPath + <span class="string">"/countGit.sh"</span></span><br><span class="line"></span><br><span class="line">    out, err := kb.Exec(countGitShell)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此看板数据就很方便的同步到指定的私有仓库了, 通过对应的 git 手机客户端,可以很方便查看任务数据.</p><p><img src="/img/2020/go-5-2.png" alt="img"></p><h1 id="命令行交互"><a href="#命令行交互" class="headerlink" title="命令行交互"></a>命令行交互</h1><p>一开始读取命令的输入是通过”bufio”来实现.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">input := bufio.NewScanner(os.Stdin)</span><br><span class="line"></span><br><span class="line">CommandMode:</span><br><span class="line">    <span class="keyword">for</span> input.Scan() &#123;</span><br><span class="line">        <span class="comment">// default</span></span><br><span class="line">        kanban.IsShortMode = IsShortMode</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> cmds Cmds = buildCmd(input.Text())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> cmds.cmdType &#123;</span><br><span class="line">        <span class="keyword">case</span> EXIT:</span><br><span class="line">            <span class="keyword">break</span> CommandMode</span><br><span class="line">        <span class="keyword">case</span> .......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>但是这样用起来很不方便, 缺点很多:</p><ul><li>无移动光标</li><li>不能输错</li><li>没有命令行历史,不能调用历史命令</li><li>没有提示</li></ul><p>为此我引进了一个很好用的命令行交互插件 <a href="https://github.com/c-bata/go-prompt" target="_blank" rel="noopener">go-prompt</a></p><p>通过 go-prompt可以很好解决以上缺点.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"github.com/c-bata/go-prompt"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    kanbanPrompt := prompt.New(</span><br><span class="line">        dummyExecutor,</span><br><span class="line">        completer,</span><br><span class="line">        prompt.OptionPrefix(<span class="string">"InputCmd $"</span>),</span><br><span class="line">        prompt.OptionHistory([]<span class="keyword">string</span>&#123;<span class="string">"exit"</span>, <span class="string">"help"</span>&#125;),</span><br><span class="line">        prompt.OptionPrefixTextColor(prompt.Yellow),</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">CommandMode:</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        inputCmd := kanbanPrompt.Input()</span><br><span class="line">        inputCmd = strings.TrimLeft(inputCmd, <span class="string">" "</span>)</span><br><span class="line">        <span class="keyword">var</span> cmds Cmds = buildCmd(inputCmd)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> cmds.cmdType &#123;</span><br><span class="line">        <span class="keyword">case</span> EXIT:</span><br><span class="line">            <span class="keyword">break</span> CommandMode</span><br><span class="line">        <span class="keyword">case</span> .......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">completer</span><span class="params">(d prompt.Document)</span> []<span class="title">prompt</span>.<span class="title">Suggest</span></span> &#123;</span><br><span class="line">    suggest := []prompt.Suggest&#123;</span><br><span class="line">        &#123;Text: <span class="string">"o [open]"</span>, Description: <span class="string">"o [open] $taskKey "</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"s [short / shortmode]"</span>, Description: <span class="string">"short mode turn on/off"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"c [create]"</span>, Description: <span class="string">"c [create] taskname $banPrefix  "</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"g [git]"</span>, Description: <span class="string">"commit &amp; push to git "</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"ct [changetask]"</span>, Description: <span class="string">"ct [changetask] $taskKey $TaskItem context"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"cb [changeban]"</span>, Description: <span class="string">"cb [changeban] $taskKey $banPrefix "</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"k i"</span>, Description: <span class="string">"priority"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"k o"</span>, Description: <span class="string">"owner"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"k j"</span>, Description: <span class="string">"project"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"k d"</span>, Description: <span class="string">"deadline"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"h [help]"</span>, Description: <span class="string">"help doc"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"e [exit]"</span>, Description: <span class="string">"exit kanban"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"k [kan]"</span>, Description: <span class="string">"k [kan] &lt;i / o / j / d&gt;"</span>&#125;,</span><br><span class="line">        &#123;Text: <span class="string">"r [rekan]"</span>, Description: <span class="string">"refresh kanban"</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> prompt.FilterHasPrefix(suggest, d.GetWordBeforeCursor(), <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">dummyExecutor</span><span class="params">(in <span class="keyword">string</span>)</span></span> &#123;&#125;</span><br></pre></td></tr></table></figure><p>引入go-prompt,编写提示命令,运行效果如下:</p><p><img src="/img/2020/go-5-3.png" alt="img"></p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>从此,我的看板工具投入使用, 用于管理我个人的任务.</p><p>我的 go 语言初学记也告一段落, 看了一下Github上的项目, 71 commits还是成就感满满的. :)</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>First Learn on Go Language 4 config</title>
      <link href="/2020/05/29/Tech-2020-2020-06-12-FirstLearnOnGo4/"/>
      <url>/2020/05/29/Tech-2020-2020-06-12-FirstLearnOnGo4/</url>
      <content type="html"><![CDATA[<h1 id="Go语言初学记-（四）-配置篇"><a href="#Go语言初学记-（四）-配置篇" class="headerlink" title="Go语言初学记 （四）:  配置篇"></a>Go语言初学记 （四）:  配置篇</h1><h1 id="原文再续"><a href="#原文再续" class="headerlink" title="原文再续"></a>原文再续</h1><p>上一篇 <a href="http://antinomy.top/2020/05/19/Tech-2020-2020-05-29-FirstLearnOnGo3/">Go语言初学记 (三）: 踩坑篇</a> 介绍实际项目中踩到的一些坑. 经过一些的功能实现,初步功能已经可用了.</p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>一个成熟的工程都需要配置文件,为了 kanban 项目更加灵活,我开始引入配置文件 <em>conf.json</em>.<br>(采用json格式是因为它比较轻和通用)</p><h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><p>内容如下:</p><p>conf/conf.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"BanSize"</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">"BanConfigs"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"Name"</span>: <span class="string">"Todo"</span>,</span><br><span class="line">            <span class="attr">"Folder"</span>: <span class="string">"01-Todo"</span>,</span><br><span class="line">            <span class="attr">"SupportShortMode"</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"Name"</span>: <span class="string">"Doing"</span>,</span><br><span class="line">            <span class="attr">"Folder"</span>: <span class="string">"02-Doing"</span>,</span><br><span class="line">            <span class="attr">"SupportShortMode"</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"Name"</span>: <span class="string">"Hold"</span>,</span><br><span class="line">            <span class="attr">"Folder"</span>: <span class="string">"03-Hold"</span>,</span><br><span class="line">            <span class="attr">"SupportShortMode"</span>: <span class="literal">false</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"Name"</span>: <span class="string">"Done"</span>,</span><br><span class="line">            <span class="attr">"Folder"</span>: <span class="string">"04-Done"</span>,</span><br><span class="line">            <span class="attr">"SupportShortMode"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BanSize 为看板列数,BanConfig对应每一个列的相关属性</p><h1 id="配置结构"><a href="#配置结构" class="headerlink" title="配置结构"></a>配置结构</h1><p>编写与其对应的结构体</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> conf</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> BanConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">Name             <span class="keyword">string</span></span><br><span class="line">Folder           <span class="keyword">string</span></span><br><span class="line">SupportShortMode <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Jconf <span class="keyword">struct</span> &#123;</span><br><span class="line">BanSize    <span class="keyword">int</span></span><br><span class="line">BanConfigs []BanConfig</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="编写测试用例"><a href="#编写测试用例" class="headerlink" title="编写测试用例"></a>编写测试用例</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">unc TestReadConfig(t *testing.T) &#123;</span><br><span class="line"><span class="keyword">var</span> config kc.Jconf = loadConfig()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> banconfigs []kc.BanConfig = config.BanConfigs</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(banconfigs) != config.BanSize &#123;</span><br><span class="line">t.Log(banconfigs)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> banconfigs[<span class="number">0</span>].Name != <span class="string">"Todo"</span> &#123;</span><br><span class="line">t.Log(banconfigs[<span class="number">0</span>].Name)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> banconfigs[<span class="number">0</span>].Folder != <span class="string">"01-Todo"</span> &#123;</span><br><span class="line">t.Log(banconfigs[<span class="number">0</span>].Folder)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> banconfigs[<span class="number">3</span>].SupportShortMode != <span class="literal">true</span> &#123;</span><br><span class="line">t.Log(banconfigs[<span class="number">3</span>].SupportShortMode)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="编写实现代码"><a href="#编写实现代码" class="headerlink" title="编写实现代码"></a>编写实现代码</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ban</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"encoding/json"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line">kc <span class="string">"kanban/conf"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadConfig</span><span class="params">()</span> <span class="title">kc</span>.<span class="title">Jconf</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> configPath = <span class="string">".././conf/conf.json"</span></span><br><span class="line"></span><br><span class="line">_, err := os.Stat(configPath)</span><br><span class="line"><span class="keyword">if</span> os.IsNotExist(err) &#123;</span><br><span class="line">configPath = <span class="string">"./conf/conf.json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> config kc.Jconf = readJsonConfig(configPath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readJsonConfig</span><span class="params">(filePath <span class="keyword">string</span>)</span> <span class="title">kc</span>.<span class="title">Jconf</span></span> &#123;</span><br><span class="line"></span><br><span class="line">data, err := ioutil.ReadFile(filePath)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// json data</span></span><br><span class="line"><span class="keyword">var</span> result kc.Jconf</span><br><span class="line"></span><br><span class="line"><span class="comment">// unmarshall it</span></span><br><span class="line">err = json.Unmarshal(data, &amp;result)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(<span class="string">"error:"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>Tips:</p></li><li><p>loadConfig()里面兼容了从包内调用和应用目录下调用 2 种方式, 方便单元测试和实际使用.</p></li><li>采用”io/ioutil”来读取文件</li><li>采用”encoding/json”来读取 json并转化 banconfig 结构.</li></ul><h1 id="运行单元测试"><a href="#运行单元测试" class="headerlink" title="运行单元测试"></a>运行单元测试</h1><p>经过一系列的编写和测试,最终通过测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Running tool: /usr/<span class="built_in">local</span>/go/bin/go <span class="built_in">test</span> -timeout 30s kanban/ban -run ^(TestReadConfig)$</span><br><span class="line"></span><br><span class="line">ok  kanban/ban0.011s</span><br></pre></td></tr></table></figure><h1 id="To-be-continue"><a href="#To-be-continue" class="headerlink" title="To be continue"></a>To be continue</h1><p>到此为止,我学到了:</p><ol><li>如何从 io 读取文件</li><li>如何读取 json 结构的数据</li><li>配置文件的相对路径因为调用方不一样,而需要做适配</li></ol>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>First Learn on Go Language 3 lesson</title>
      <link href="/2020/05/19/Tech-2020-2020-05-29-FirstLearnOnGo3/"/>
      <url>/2020/05/19/Tech-2020-2020-05-29-FirstLearnOnGo3/</url>
      <content type="html"><![CDATA[<h1 id="Go语言初学记-（三）-踩坑篇"><a href="#Go语言初学记-（三）-踩坑篇" class="headerlink" title="Go语言初学记 （三）: 踩坑篇"></a>Go语言初学记 （三）: 踩坑篇</h1><h1 id="原文再续"><a href="#原文再续" class="headerlink" title="原文再续"></a>原文再续</h1><p>上一篇 <a href="http://antinomy.top/2020/05/19/Tech-2020-2020-05-19-FirstLearnOnGo2/">Go语言初学记 （二）: 实现篇</a> 实现了 task 包的基本功能和测试覆盖,是时候实现另外一个包 ban 了.</p><h1 id="目标与准备"><a href="#目标与准备" class="headerlink" title="目标与准备"></a>目标与准备</h1><p>ban 包需要实现和文件系统的操作, 以读取 02-doing 列的数据为例,需要实现 2 个步骤:</p><ol><li>读取目标目录下所有文件的名字</li><li>过滤符合格式的任务名字</li></ol><p>我预先准备单元测试所需要的数据,2个符合格式的任务文件和一个不符合格式的.</p><p><img src="/img/2020/go-3-1.png" alt="img]"></p><h1 id="步骤-1-读取目标目录下所有文件的名字"><a href="#步骤-1-读取目标目录下所有文件的名字" class="headerlink" title="步骤 1:读取目标目录下所有文件的名字"></a>步骤 1:读取目标目录下所有文件的名字</h1><p>期望的测试:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ban</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReadDir</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> folderPath = <span class="string">".././unittest/myTasks/02-doing"</span></span><br><span class="line"><span class="keyword">var</span> todoList []<span class="keyword">string</span> = readFileList(folderPath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> taskNum = <span class="built_in">len</span>(todoList)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> taskNum != <span class="number">3</span> &#123;</span><br><span class="line">t.Log(todoList)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体实现:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ban</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"io/ioutil"</span></span><br><span class="line"><span class="string">"log"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readFileList</span><span class="params">(folderPath <span class="keyword">string</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">files, err := ioutil.ReadDir(folderPath)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Fatal(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> filesLen = <span class="built_in">len</span>(files)</span><br><span class="line">fmt.Println(filesLen)</span><br><span class="line"><span class="keyword">var</span> result []<span class="keyword">string</span> = <span class="built_in">make</span>([]<span class="keyword">string</span>, filesLen)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, f := <span class="keyword">range</span> files &#123;</span><br><span class="line">fmt.Println(f.Name())</span><br><span class="line">result[index] = f.Name()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>debug 模式运行,打印日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">API server listening at: 127.0.0.1:22211</span><br><span class="line">3</span><br><span class="line">AY-M-ProjectB-0520-doSth.md</span><br><span class="line">GLW-H-ProjectB-0621-doSth.md</span><br><span class="line">GLW-H-ProjectB0621notCorrectTask.md</span><br><span class="line">PASS</span><br></pre></td></tr></table></figure><p>运行结果与期待一致,步骤 1 done.<br>只是没想到实现步骤 2 的时候,困扰了我很久.</p><h1 id="步骤2-过滤符合格式的任务名字"><a href="#步骤2-过滤符合格式的任务名字" class="headerlink" title="步骤2. 过滤符合格式的任务名字"></a>步骤2. 过滤符合格式的任务名字</h1><p>从步骤 2 开始,我需要引用 task 包里的接口与结构体了.</p><p>期望的测试:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ban</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"testing"</span></span><br><span class="line">    <span class="string">"kanban/task"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReadCorrectTask</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> folderPath = <span class="string">".././unittest/myTasks/02-doing"</span></span><br><span class="line"><span class="keyword">var</span> todoList []<span class="keyword">string</span> = readFileList(folderPath)</span><br><span class="line"><span class="keyword">var</span> todoTasks []Task = readCorrectTasks(todoList)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> taskNum = <span class="built_in">len</span>(todoTasks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> taskNum != <span class="number">2</span> &#123;</span><br><span class="line">t.Log(todoTasks)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体实现:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ban</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"kanban/task"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readCorrectTasks</span><span class="params">(filesList []<span class="keyword">string</span>)</span> []<span class="title">kt</span>.<span class="title">Task</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> result []Task</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ts TaskService = <span class="built_in">new</span>(FileWay)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, fileName := <span class="keyword">range</span> filesList &#123;</span><br><span class="line"><span class="keyword">if</span> ts.isATask(fileName) &#123;</span><br><span class="line">fmt.Println(fileName)</span><br><span class="line">result = <span class="built_in">append</span>(result, ts.createTask(fileName))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(result))</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果却并不理想<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Running tool: /usr/<span class="built_in">local</span>/go/bin/go <span class="built_in">test</span> -timeout 30s kanban/ban -run ^(TestReadCorrectTask)$</span><br><span class="line"></span><br><span class="line"><span class="comment"># kanban/ban [kanban/ban.test]</span></span><br><span class="line">/Users/Antinomy/Github/kanban/ban/KanbanService.go:7:45: undefined: kt</span><br><span class="line">/Users/Antinomy/Github/kanban/ban/KanbanService.go:8:15: undefined: Task</span><br><span class="line">/Users/Antinomy/Github/kanban/ban/KanbanService.go:10:9: undefined: TaskService</span><br><span class="line">/Users/Antinomy/Github/kanban/ban/KanbanService.go:10:27: undefined: FileWay</span><br><span class="line">/Users/Antinomy/Github/kanban/ban/Kanban_test.go:24:18: undefined: Task</span><br><span class="line">FAILkanban/ban [build failed]</span><br><span class="line">FAIL</span><br></pre></td></tr></table></figure></p><p>很明显ban包的代码无法识别的task包里的对象,导致无法运行. </p><p>后来发现,编辑器会自动去掉 import 里的 “kanban/task”,经过一番折腾,修改  “kanban/task” 为 kt “kanban/task”,<br>task 包才被成功识别. 看来 go 的包引用并没有我想象中那么智能.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">kt <span class="string">"kanban/task"</span></span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>修改完毕,运行结果:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/Users/Antinomy/Github/kanban/ban/KanbanService.go:14:8: ts.isATask undefined (cannot refer to unexported field or method isATask)</span><br><span class="line">/Users/Antinomy/Github/kanban/ban/KanbanService.go:16:30: ts.createTask undefined (cannot refer to unexported field or method createTask)</span><br></pre></td></tr></table></figure><p>原来go 接口里,方法名小写开头代表包内可见,方法名大写开头才能包外可见. (我在上一篇文章埋的坑,在这里就踩到了,囧 )</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TaskService interface e</span></span><br><span class="line"><span class="keyword">type</span> TaskService <span class="keyword">interface</span> &#123;</span><br><span class="line">CreateTask(taskName <span class="keyword">string</span>) Task</span><br><span class="line">IsATask(taskName <span class="keyword">string</span>) <span class="keyword">bool</span></span><br><span class="line">ChangeTask(changingTask ToChangeTask) Task</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改完毕, 运行测试, 通过!</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Running tool: /usr/<span class="built_in">local</span>/go/bin/go <span class="built_in">test</span> -timeout 30s -coverprofile=/var/folders/yn/h224dtzx2bq3pdhhgv4jt93r0000gn/T/vscode-gocVUxCQ/go-code-cover kanban/ban</span><br><span class="line"></span><br><span class="line">ok  kanban/ban0.015scoverage: 94.4% of statements</span><br></pre></td></tr></table></figure><h1 id="To-be-continue"><a href="#To-be-continue" class="headerlink" title="To be continue"></a>To be continue</h1><p>到此为止,我学到了:</p><ol><li>引用别的包的时候需要显式指定包内对象</li><li>开发给包外使用的接口需要大写开头</li></ol>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>First Learn on Go Language 2  implement</title>
      <link href="/2020/05/19/Tech-2020-2020-05-19-FirstLearnOnGo2/"/>
      <url>/2020/05/19/Tech-2020-2020-05-19-FirstLearnOnGo2/</url>
      <content type="html"><![CDATA[<h1 id="Go语言初学记-（二）-实现篇"><a href="#Go语言初学记-（二）-实现篇" class="headerlink" title="Go语言初学记 （二）: 实现篇"></a>Go语言初学记 （二）: 实现篇</h1><h1 id="原文再续"><a href="#原文再续" class="headerlink" title="原文再续"></a>原文再续</h1><p>上一篇 <a href="http://antinomy.top/2020/05/15/Tech-2020-2020-05-15-FirstLearnOnGo/">Go语言初学记 （一）: 启动篇</a> 介绍了准备开发环境的步骤, 可以开始实行我的 kanban 项目了 !</p><h1 id="初步设计"><a href="#初步设计" class="headerlink" title="初步设计"></a>初步设计</h1><p>kanban 项目要通过命令行来实现经典的看板管理, 初步的设计如下:</p><p><img src="/img/2020/go-2-1.png" alt="ddd]"></p><h1 id="测试驱动开发"><a href="#测试驱动开发" class="headerlink" title="测试驱动开发"></a>测试驱动开发</h1><pre><code>Test Not GOOD X , TDD GOOD √</code></pre><p>有了设计就可以开始编码了, 作为一个 TDD 理念的实践者,我第一个要实现是实体 task 的测试.</p><p>go 的测试文件需以_test 结尾, new file : <em>task/Task_test.go</em></p><h2 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h2><ol><li>声明包 task</li><li>引入测试包 testing</li><li>测试方法 Test 开头,固定参数(t *testing.T)</li><li>运行测试,失败</li><li>实现代码</li><li>循环 4~5,直至测试完成</li></ol><h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> task</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestTask</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> task1 Task</span><br><span class="line"></span><br><span class="line">task1.owner = <span class="string">"AY"</span></span><br><span class="line">task1.priority = <span class="string">"M"</span></span><br><span class="line">task1.project = <span class="string">"ProjectA"</span></span><br><span class="line">task1.deadline = <span class="string">"20200512"</span></span><br><span class="line">task1.tittle = <span class="string">"WriteKanbanCode.md"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> task1.owner != <span class="string">"AY"</span> &#123;</span><br><span class="line">t.Log(task1)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="实现代码"><a href="#实现代码" class="headerlink" title="实现代码"></a>实现代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> task</span><br><span class="line"></span><br><span class="line"><span class="comment">// Task entiy</span></span><br><span class="line"><span class="keyword">type</span> Task <span class="keyword">struct</span> &#123;</span><br><span class="line">fullName <span class="keyword">string</span></span><br><span class="line">owner    <span class="keyword">string</span></span><br><span class="line">priority <span class="keyword">string</span></span><br><span class="line">project  <span class="keyword">string</span></span><br><span class="line">deadline <span class="keyword">string</span></span><br><span class="line">tittle   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="方法测试"><a href="#方法测试" class="headerlink" title="方法测试"></a>方法测试</h2><p>通过 IDE 可以很方便测试单个方法<br><img src="/img/2020/go-2-2.png" alt="img]"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Running tool: /usr/<span class="built_in">local</span>/go/bin/go <span class="built_in">test</span> -timeout 30s kanban/task -run ^(TestTask)$</span><br><span class="line"></span><br><span class="line">ok  kanban/task(cached)</span><br></pre></td></tr></table></figure><h2 id="包测试"><a href="#包测试" class="headerlink" title="包测试"></a>包测试</h2><p>完成一堆测试用例的时候,可以运行包测试,从结果上可以看到测试的覆盖率</p><p><img src="/img/2020/go-2-3.png" alt="img]"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Running tool: /usr/<span class="built_in">local</span>/go/bin/go <span class="built_in">test</span> -timeout 30s -coverprofile=/var/folders/yn/h224dtzx2bq3pdhhgv4jt93r0000gn/T/vscode-gocVUxCQ/go-code-cover kanban/task</span><br><span class="line"></span><br><span class="line">ok  kanban/task0.007scoverage: 100.0% of statements</span><br></pre></td></tr></table></figure><h1 id="接口-interface"><a href="#接口-interface" class="headerlink" title="接口 : interface"></a>接口 : interface</h1><p>go没有类<em>class</em>的设定,函数<em>func</em>是一等公民,想要实现类似封装的功能需要靠接口<em>interface</em>来实现.<br>我把操作task 相关的操作封装在 TaskService 里,定义如下:</p><h2 id="定义接口"><a href="#定义接口" class="headerlink" title="定义接口"></a>定义接口</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//TaskService interface </span></span><br><span class="line"><span class="keyword">type</span> TaskService <span class="keyword">interface</span> &#123;</span><br><span class="line">createTask(taskName <span class="keyword">string</span>) Task</span><br><span class="line">isATask(taskName <span class="keyword">string</span>) <span class="keyword">bool</span></span><br><span class="line">changeTask(changingTask ToChangeTask) Task</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="定义实现方式"><a href="#定义实现方式" class="headerlink" title="定义实现方式"></a>定义实现方式</h2><p>定义了接口,就会有有多种实现方式.<br>为了实现其中一种实现方式,先定义实现方式,本项目以文件的形式来存储任务,所以定义:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FileWay desc</span></span><br><span class="line"><span class="keyword">type</span> FileWay <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h2><p>具体实现里在 func里加入(t *FileWay)来声明具体实现那种方式.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *FileWay)</span> <span class="title">createTask</span><span class="params">(taskName <span class="keyword">string</span>)</span> <span class="title">Task</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> arrs = strings.Split(taskName, <span class="string">"-"</span>)</span><br><span class="line"><span class="keyword">var</span> result Task</span><br><span class="line">result.owner = arrs[<span class="number">0</span>]</span><br><span class="line">result.priority = arrs[<span class="number">1</span>]</span><br><span class="line">result.project = arrs[<span class="number">2</span>]</span><br><span class="line">result.deadline = arrs[<span class="number">3</span>]</span><br><span class="line">result.tittle = arrs[<span class="number">4</span>]</span><br><span class="line">result.fullName = taskName</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *FileWay)</span> <span class="title">isATask</span><span class="params">(taskName <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> result <span class="keyword">bool</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arrs = strings.Split(taskName, <span class="string">"-"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(arrs) == <span class="number">5</span> &#123;</span><br><span class="line">result = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *FileWay)</span> <span class="title">changeTask</span><span class="params">(changingTask ToChangeTask)</span> <span class="title">Task</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> origin = changingTask.origin</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> result Task = origin</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> changingTask.changeItem == OWNER &#123;</span><br><span class="line">result.owner = changingTask.changeContent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> changingTask.changeItem == PRIORITY &#123;</span><br><span class="line">result.priority = changingTask.changeContent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> changingTask.changeItem == DEADLINE &#123;</span><br><span class="line">result.deadline = changingTask.changeContent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="具体调用"><a href="#具体调用" class="headerlink" title="具体调用"></a>具体调用</h2><p>测试用例已经包含了具体的调用代码,测试即文档还是有点道理的.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCreateTask</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> taskService TaskService = <span class="built_in">new</span>(FileWay)</span><br><span class="line"><span class="keyword">var</span> task1 Task = taskService.createTask(<span class="string">"AY-M-ProjectA-20200512-WriteKanbanCode.md"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> task1.project != <span class="string">"ProjectA"</span> &#123;</span><br><span class="line">t.Log(task1)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> task1.fullName != <span class="string">"AY-M-ProjectA-20200512-WriteKanbanCode.md"</span> &#123;</span><br><span class="line">t.Log(task1)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestIsATask</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> taskService TaskService = <span class="built_in">new</span>(FileWay)</span><br><span class="line"><span class="keyword">var</span> task1 <span class="keyword">bool</span> = taskService.isATask(<span class="string">"AY-M-ProjectA-20200512-WriteKanbanCode.md"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> task1 == <span class="literal">false</span> &#123;</span><br><span class="line">t.Log(task1)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> task2 = taskService.isATask(<span class="string">"whatever"</span>)</span><br><span class="line"><span class="keyword">if</span> task2 == <span class="literal">true</span> &#123;</span><br><span class="line">t.Log(task2)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestChangeTaskOwner</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> taskService TaskService = <span class="built_in">new</span>(FileWay)</span><br><span class="line"><span class="keyword">var</span> originTask Task = taskService.createTask(<span class="string">"AY-M-ProjectA-20200512-WriteKanbanCode.md"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// change owner</span></span><br><span class="line">changingTask := ToChangeTask&#123;</span><br><span class="line">origin:        originTask,</span><br><span class="line">changeItem:    OWNER,</span><br><span class="line">changeContent: <span class="string">"WGL"</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> changedTask Task = taskService.changeTask(changingTask)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> changedTask.owner != <span class="string">"WGL"</span> &#123;</span><br><span class="line">t.Log(changedTask)</span><br><span class="line">t.Errorf(<span class="string">"Failed"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="To-be-continue"><a href="#To-be-continue" class="headerlink" title="To be continue"></a>To be continue</h1><p>在学习接口的时候,我经历了种种不适应, 比起java的接口,go的接口要复杂一点.</p><p>在完成 task 包里的种种测试之后,我开始有点小得意了,殊不知已经给自己后面的工作埋了个大坑…..</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>First Learn on Go Language 1  init</title>
      <link href="/2020/05/15/Tech-2020-2020-05-15-FirstLearnOnGo/"/>
      <url>/2020/05/15/Tech-2020-2020-05-15-FirstLearnOnGo/</url>
      <content type="html"><![CDATA[<h1 id="Go语言初学记-（一）-启动篇"><a href="#Go语言初学记-（一）-启动篇" class="headerlink" title="Go语言初学记 （一）: 启动篇"></a>Go语言初学记 （一）: 启动篇</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>如果你读过《程序员修炼之道》，就会知道每年投资学习一门新语言是有益的。（虽然我断更好久了。。。：）</p><p>近期而言，go是性价比最高的语言之一，也是我今年的目标。作为懒人来说，我不喜欢慢慢看砖头书，而喜欢直接用来做一些小工具，编学编做。</p><p>上一次学ruby的时候是帮小盆友做毕业设计，这次选择做一个基于命令行的kanban工具。</p><p>用习惯java转go会有很多不适应。我尝试把这些”坑“记下来。</p><p>这次选择的IDE是现在流行的vscode，作为一个免费而强大的工具，还是有很多需要地方需要配置的：</p><h1 id="go安装"><a href="#go安装" class="headerlink" title="go安装"></a>go安装</h1><p>mac版的安装可以直接去 <a href="https://golang.org/dl/]" target="_blank" rel="noopener">官网</a>下载安装包，so easy。<br>安装后验证：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$go</span> version</span><br><span class="line">go version go1.14.2 darwin/amd64</span><br></pre></td></tr></table></figure></p><p>然后需要在环境变量设置$GOPATH等 ,具体参考 <a href="https://www.jianshu.com/p/4e699ff478a5" target="_blank" rel="noopener">go环境变量配置 (GOROOT和GOPATH)</a></p><h1 id="vscode-go插件安装"><a href="#vscode-go插件安装" class="headerlink" title="vscode go插件安装"></a>vscode go插件安装</h1><p><img src="/img/2020/go-1-1.png" alt="img"></p><p>vscode插件库选择go插件，插件安装完毕之后，还需要设置插件的代理，详情参考 <a href="https://goproxy.io/zh/" target="_blank" rel="noopener">goproxy.io</a><br>这里会折腾一段时间，没办法 囧<br>代理设置完成之后，重启vscode，ide会提醒你是否安装缺失的工具。</p><p>如果全部安装成功了，会在你设置的GOPATH/bin 下找到已经安装的go包： </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ll /Users/Antinomy/go/bin/</span><br><span class="line">total 121424</span><br><span class="line">drwxr-xr-x  9 Antinomy  staff       288  5 12 14:40 ./</span><br><span class="line">drwxr-xr-x  5 Antinomy  staff       160  5 12 11:40 ../</span><br><span class="line">-rwxr-xr-x  1 root      wheel  17914876  5 12 14:40 dlv*</span><br><span class="line">-rwxr-xr-x  1 root      wheel   4588168  5 12 14:38 go-outline*</span><br><span class="line">-rwxr-xr-x  1 root      wheel  12777788  5 12 14:39 gocode*</span><br><span class="line">-rwxr-xr-x  1 root      wheel   9168808  5 12 14:39 godef*</span><br><span class="line">-rwxr-xr-x  1 root      wheel   5846888  5 12 14:39 goimports*</span><br><span class="line">-rwxr-xr-x  1 root      wheel   6232808  5 12 14:39 golint*</span><br><span class="line">-rwxr-xr-x  1 root      wheel   5448568  5 12 14:38 gopkgs*</span><br></pre></td></tr></table></figure><h1 id="成功标志-：-hello-world"><a href="#成功标志-：-hello-world" class="headerlink" title="成功标志 ： hello world"></a>成功标志 ： hello world</h1><p>新建文件 hello.go</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"hello, world\n"</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">API server listening at: 127.0.0.1:5682</span><br><span class="line">hello, world</span><br><span class="line">Process exiting with code: 0</span><br></pre></td></tr></table></figure><h1 id="Other-tips"><a href="#Other-tips" class="headerlink" title="Other tips"></a>Other tips</h1><p>默认的代码检查golint十分啰嗦，个人推荐切换成GolangCI-Lint<br><img src="/img/2020/go-1-2.jpg" alt="img"></p><h1 id="To-be-continue"><a href="#To-be-continue" class="headerlink" title="To be continue"></a>To be continue</h1><p>千里之行始于足下，折腾完开发环境之后，终于可以敲代码了，然后我又遇到了头疼的问题。。。。</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Jenkins Tips , About Artifact 2</title>
      <link href="/2020/05/08/Tech-2020-2020-05-08-JenkinsTips5/"/>
      <url>/2020/05/08/Tech-2020-2020-05-08-JenkinsTips5/</url>
      <content type="html"><![CDATA[<h1 id="Jenkins插件小贴士-五-About-Artifact-2"><a href="#Jenkins插件小贴士-五-About-Artifact-2" class="headerlink" title="Jenkins插件小贴士 (五)  About Artifact 2"></a>Jenkins插件小贴士 (五)  About Artifact 2</h1><h1 id="历史问题"><a href="#历史问题" class="headerlink" title="历史问题"></a>历史问题</h1><p>上一篇&lt;&lt;<a href="http://antinomy.top/2020/03/25/Tech-2020-2020-03-25-JenkinsTips4/">Jenkins插件小贴士 (四)  About Artifact</a>&gt;&gt;<br>介绍了如何将构建完的二进制物(JAR/WAR)上传到Maven私库,但还是有可以改进的地方.</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">environment &#123;</span><br><span class="line">     NEXUS_URL=<span class="string">"nexus.xxx.com"</span></span><br><span class="line">     NEXUS_REPOSITOR=<span class="string">"maven-xxx"</span></span><br><span class="line">     GROUP_ID=<span class="string">"org.life-easier"</span></span><br><span class="line">     VERSION=<span class="string">"1.0.0"</span></span><br><span class="line"></span><br><span class="line">     FILE_PATH = <span class="string">"target"</span></span><br><span class="line">     FILE_NAME = <span class="string">"iptools-$&#123;VERSION&#125;.jar"</span></span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>比如:</p><ul><li><p>GROUP ID和ARTIFACT ID这些都是硬编码的</p><p>  每次发布新版本都需要修改Jenkinsfile</p></li><li><p>上传到Maven私服的JAR需要多一个POM文件来描述才能顺利被客户端的Maven识别和下载.</p><p>  如果不是通过mvn deploy的方式是不会自动产生pom文件的,但采用mvn deploy的方式又需要在maven setting暴露私库账号和密码.</p></li></ul><h1 id="新思路"><a href="#新思路" class="headerlink" title="新思路"></a>新思路</h1><p>  参考了 github上的<a href="https://github.com/zeyangli/springboot-helloworld.git" target="_blank" rel="noopener">Jenkins集成Nexus demo项目</a>, 有了新的想法:</p><ul><li>利用Jenkins ci 读取项目里的POM.xml文件</li><li>代码生成对应的xx.pom文件</li><li>上传到私库</li></ul><h1 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h1><ul><li><p>安装插件 ：Pipeline Utility Steps<br>通过插件<a href="https://www.jenkins.io/doc/pipeline/steps/pipeline-utility-steps/" target="_blank" rel="noopener">Pipeline Utility Steps</a><br>可以很方便地使用readMavenPom命令读取pom文件</p></li><li><p>设置Jenkins权限 scriptApproval : 允许Approval<br>Jenkins执行groovy脚本的时候会出错,是因为权限问题,需要设置对应的权限才能让脚本顺利写文件到硬盘里.</p><h1 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h1><ul><li>定义POM文件所需变量</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">environment &#123;</span><br><span class="line">       NEXUS_URL=<span class="string">"nexus.xxx.com"</span></span><br><span class="line">       NEXUS_REPOSITOR=<span class="string">"maven-xxx"</span></span><br><span class="line"></span><br><span class="line">       GROUP_ID = <span class="string">""</span></span><br><span class="line">       VERSION = <span class="string">""</span></span><br><span class="line">       ARTIFACT_ID = <span class="string">""</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ul><li>使用readMavenPom命令读取POM.xml文件</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">script &#123;</span><br><span class="line">     <span class="keyword">def</span> pom = readMavenPom <span class="string">file:</span> <span class="string">'pom.xml'</span></span><br><span class="line">     echo pom.toString()</span><br><span class="line"></span><br><span class="line">     GROUP_ID = pom.groupId</span><br><span class="line">     VERSION = pom.version</span><br><span class="line">     ARTIFACT_ID = pom.artifactId</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li><li><p>定义xx.pom文件模板和替换变量,生成xx.pom文件</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">script &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">def</span> pomContent = <span class="string">"""</span></span><br><span class="line"><span class="string"> &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="string"> &lt;project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd" xmlns="http://maven.apache.org/POM/4.0.0"</span></span><br><span class="line"><span class="string">   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;</span></span><br><span class="line"><span class="string">     &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span></span><br><span class="line"><span class="string">     &lt;groupId&gt;$&#123;GROUP_ID&#125;&lt;/groupId&gt;</span></span><br><span class="line"><span class="string">     &lt;artifactId&gt;$&#123;ARTIFACT_ID&#125;&lt;/artifactId&gt;</span></span><br><span class="line"><span class="string">     &lt;version&gt;$&#123;VERSION&#125;&lt;/version&gt;</span></span><br><span class="line"><span class="string">     &lt;description&gt;POM was created from jenkins-ci&lt;/description&gt;</span></span><br><span class="line"><span class="string"> &lt;/project&gt;</span></span><br><span class="line"><span class="string">   """</span></span><br><span class="line"></span><br><span class="line">   writeFile <span class="string">file:</span> <span class="string">"target/$&#123;ARTIFACT_ID&#125;-$&#123;VERSION&#125;.pom"</span>, <span class="string">text:</span> pomContent</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h1 id="完整DSL"><a href="#完整DSL" class="headerlink" title="完整DSL"></a>完整DSL</h1><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    environment &#123;</span><br><span class="line">        NEXUS_URL=<span class="string">"nexus.xxx.com"</span></span><br><span class="line">        NEXUS_REPOSITOR=<span class="string">"maven-xxx"</span></span><br><span class="line"></span><br><span class="line">        GROUP_ID = <span class="string">""</span></span><br><span class="line">        VERSION = <span class="string">""</span></span><br><span class="line">        ARTIFACT_ID = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Get Code'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                git <span class="string">branch:</span> <span class="string">"master"</span>, <span class="string">credentialsId:</span> <span class="string">'xxx'</span>, <span class="string">url:</span> <span class="string">"https://gitlab.xxx.com/life-easier/iptools.git"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Build JAR'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">'mvn clean package'</span></span><br><span class="line">                sh <span class="string">'ls -l target/'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Publish JAR'</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    steps &#123;</span><br><span class="line">                        script &#123;</span><br><span class="line">                            <span class="keyword">def</span> pom = readMavenPom <span class="string">file:</span> <span class="string">'pom.xml'</span></span><br><span class="line">                            echo pom.toString()</span><br><span class="line"></span><br><span class="line">                            GROUP_ID = pom.groupId</span><br><span class="line">                            VERSION = pom.version</span><br><span class="line">                            ARTIFACT_ID = pom.artifactId</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        script &#123;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">def</span> pomContent = <span class="string">"""</span></span><br><span class="line"><span class="string">        &lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="string">        &lt;project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd" xmlns="http://maven.apache.org/POM/4.0.0"</span></span><br><span class="line"><span class="string">          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt;</span></span><br><span class="line"><span class="string">            &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span></span><br><span class="line"><span class="string">            &lt;groupId&gt;$&#123;GROUP_ID&#125;&lt;/groupId&gt;</span></span><br><span class="line"><span class="string">            &lt;artifactId&gt;$&#123;ARTIFACT_ID&#125;&lt;/artifactId&gt;</span></span><br><span class="line"><span class="string">            &lt;version&gt;$&#123;VERSION&#125;&lt;/version&gt;</span></span><br><span class="line"><span class="string">            &lt;description&gt;POM was created from jenkins-ci&lt;/description&gt;</span></span><br><span class="line"><span class="string">        &lt;/project&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            """</span></span><br><span class="line"></span><br><span class="line">                            writeFile <span class="string">file:</span> <span class="string">"target/$&#123;ARTIFACT_ID&#125;-$&#123;VERSION&#125;.pom"</span>, <span class="string">text:</span> pomContent</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        nexusArtifactUploader(</span><br><span class="line"><span class="symbol">                                nexusVersion:</span> <span class="string">'nexus3'</span>,</span><br><span class="line"><span class="symbol">                                protocol:</span> <span class="string">'https'</span>,</span><br><span class="line"><span class="symbol">                                nexusUrl:</span> NEXUS_URL,</span><br><span class="line"><span class="symbol">                                groupId:</span> <span class="string">"$&#123;GROUP_ID&#125;"</span>,</span><br><span class="line"><span class="symbol">                                version:</span> <span class="string">"$&#123;VERSION&#125;"</span>,</span><br><span class="line"><span class="symbol">                                repository:</span> NEXUS_REPOSITOR,</span><br><span class="line"><span class="symbol">                                credentialsId:</span> <span class="string">'nexus-cre-id'</span>,</span><br><span class="line"><span class="symbol">                                artifacts:</span> [</span><br><span class="line">                                        [<span class="string">artifactId:</span> <span class="string">"$&#123;ARTIFACT_ID&#125;"</span>,</span><br><span class="line"><span class="symbol">                                         classifier:</span> <span class="string">''</span>,</span><br><span class="line">                                         <span class="string">file      :</span> <span class="string">"target/$&#123;ARTIFACT_ID&#125;-$&#123;VERSION&#125;.jar"</span>,</span><br><span class="line">                                         <span class="string">type      :</span> <span class="string">'jar'</span>],</span><br><span class="line">                                        [<span class="string">artifactId:</span> <span class="string">"$&#123;ARTIFACT_ID&#125;"</span>,</span><br><span class="line"><span class="symbol">                                         classifier:</span> <span class="string">''</span>,</span><br><span class="line">                                         <span class="string">file      :</span> <span class="string">"target/$&#123;ARTIFACT_ID&#125;-$&#123;VERSION&#125;.pom"</span>,</span><br><span class="line">                                         <span class="string">type      :</span> <span class="string">'pom'</span>]</span><br><span class="line">                                ]</span><br><span class="line">                        )</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1 id="权限问题"><a href="#权限问题" class="headerlink" title="权限问题"></a>权限问题</h1><p>执行job的时候会遇到错误: Scripts not permitted to use method xxx<br><img src="/img/2020/Jenkins-5-1.png" alt="img"></p><p>这个时候需要管理员去  Jenkins &gt;&gt; ScriptApproval 去approval对应的脚本.</p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><ul><li>此过程需要不断调试直至Job顺利完成</li><li>自此就可以把项目把maven构建和上传私库2个动作分开,降低开发人员的入手难度.</li></ul>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Jenkins Tips , About Artifact</title>
      <link href="/2020/03/25/Tech-2020-2020-03-25-JenkinsTips4/"/>
      <url>/2020/03/25/Tech-2020-2020-03-25-JenkinsTips4/</url>
      <content type="html"><![CDATA[<h1 id="Jenkins插件小贴士-四-About-Artifact"><a href="#Jenkins插件小贴士-四-About-Artifact" class="headerlink" title="Jenkins插件小贴士 (四)  About Artifact"></a>Jenkins插件小贴士 (四)  About Artifact</h1><p>前3篇介绍了如何用Jenkins来实现日常的CI和测试,本篇来介绍一下制品相关的.</p><p>项目构建的时候会产生各种制品,像JAR包,WAR包等. 简单的项目直接部署上去服务器就行了.<br>复杂一点的项目,如采用微服务架构的项目,通常后有许多的子项目,有些项目会成为公用的包.<br>这里会涉及到公用包的管理.如果人肉拷贝到各个下游项目,会引发很多同步的问题,通过maven私服来管理会是比较方便的做法.</p><h1 id="公用包上传Maven私库"><a href="#公用包上传Maven私库" class="headerlink" title="公用包上传Maven私库"></a>公用包上传Maven私库</h1><p>NEXUS是比较常见的maven私服,本文假设你的私服是现成的,并有了可以上传文件的账号.<br>下面会介绍如何通过Jenkins的插件来实现自动构建并上传到NEXUS私服.</p><h2 id="安装插件Nexus-Artifact-Uploader"><a href="#安装插件Nexus-Artifact-Uploader" class="headerlink" title="安装插件Nexus Artifact Uploader"></a>安装插件Nexus Artifact Uploader</h2><p>首先确保Jenkins已经安装了插件  <a href="https://plugins.jenkins.io/nexus-artifact-uploader/" target="_blank" rel="noopener">Nexus Artifact Uploader</a></p><p><img src="/img/2020/Jenkins-4-1.png" alt="img"></p><h2 id="编写Pipeline-DSL"><a href="#编写Pipeline-DSL" class="headerlink" title="编写Pipeline DSL"></a>编写Pipeline DSL</h2><p>本文以一个Java ip分析工具的maven项目为例,介绍如何通过编写pipeline,一步步实现JAR上传到私库.</p><p><img src="/img/2020/Jenkins-4-2.png" alt="img"></p><p>项目构建完之后,需要把JAR文件和POM文件上传到私服上去.</p><h3 id="在Pipeline定义好环境变量"><a href="#在Pipeline定义好环境变量" class="headerlink" title="在Pipeline定义好环境变量"></a>在Pipeline定义好环境变量</h3><p>配置好nexus的地址,仓库,以及项目的group id,文件名等.</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">environment &#123;</span><br><span class="line">     NEXUS_URL=<span class="string">"nexus.xxx.com"</span></span><br><span class="line">     NEXUS_REPOSITOR=<span class="string">"maven-xxx"</span></span><br><span class="line">     GROUP_ID=<span class="string">"org.life-easier"</span></span><br><span class="line">     VERSION=<span class="string">"1.0.0"</span></span><br><span class="line"></span><br><span class="line">     FILE_PATH = <span class="string">"target"</span></span><br><span class="line">     FILE_NAME = <span class="string">"iptools-$&#123;VERSION&#125;.jar"</span></span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="拉取代码-Get-Code"><a href="#拉取代码-Get-Code" class="headerlink" title="拉取代码(Get Code)"></a>拉取代码(Get Code)</h3><p>拉取Git上master分支代码,credentialsId是预先配置好在Jenkins上的凭据Id.</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">stage(<span class="string">'Get Code'</span>) &#123;</span><br><span class="line">       steps &#123;</span><br><span class="line">           git <span class="string">branch:</span> <span class="string">"master"</span>, <span class="string">credentialsId:</span> <span class="string">'xxx'</span>, <span class="string">url:</span> <span class="string">"https://gitlab.xxx.com/life-easier/iptools.git"</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="构建JAR-Build-JAR"><a href="#构建JAR-Build-JAR" class="headerlink" title="构建JAR(Build JAR)"></a>构建JAR(Build JAR)</h3><p>通过maven命令构建JAR</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">stage(<span class="string">'Build JAR'</span>) &#123;</span><br><span class="line">       steps &#123;</span><br><span class="line">           sh <span class="string">'mvn clean package'</span></span><br><span class="line">           sh <span class="string">'ls -l $&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;'</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="发布JAR到NEXUS-Publish-JAR"><a href="#发布JAR到NEXUS-Publish-JAR" class="headerlink" title="发布JAR到NEXUS (Publish JAR)"></a>发布JAR到NEXUS (Publish JAR)</h3><p>构建完成之后上传JAR到NEXUS上. 这里需注意的是:</p><ul><li>credentialsId需要预先配置在Jenkins的凭证上,方式和增加Git账号凭证一样.</li><li>artifacts 可以配置多个上传文件,例如jar和pom文件, 在file里定义了本地路径 .</li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">stage(<span class="string">'Publish JAR'</span>) &#123;</span><br><span class="line"></span><br><span class="line">             steps &#123;</span><br><span class="line">                 nexusArtifactUploader(</span><br><span class="line"><span class="symbol">                         nexusVersion:</span> <span class="string">'nexus3'</span>,</span><br><span class="line"><span class="symbol">                         protocol:</span> <span class="string">'https'</span>,</span><br><span class="line"><span class="symbol">                         nexusUrl:</span> NEXUS_URL,</span><br><span class="line"><span class="symbol">                         groupId:</span> GROUP_ID,</span><br><span class="line"><span class="symbol">                         version:</span> VERSION,</span><br><span class="line"><span class="symbol">                         repository:</span> NEXUS_REPOSITOR,</span><br><span class="line"><span class="symbol">                         credentialsId:</span> <span class="string">'nexus-cre-id'</span>,</span><br><span class="line"><span class="symbol">                         artifacts:</span> [</span><br><span class="line">                                 [<span class="string">artifactId:</span> <span class="string">'iptools'</span>,</span><br><span class="line"><span class="symbol">                                  classifier:</span> <span class="string">''</span>,</span><br><span class="line">                                  <span class="string">file      :</span> <span class="string">'target/iptools-'</span> + version + <span class="string">'.jar'</span>,</span><br><span class="line">                                  <span class="string">type      :</span> <span class="string">'jar'</span>],</span><br><span class="line">                                 [<span class="string">artifactId:</span> <span class="string">'iptools'</span>,</span><br><span class="line"><span class="symbol">                                  classifier:</span> <span class="string">''</span>,</span><br><span class="line">                                  <span class="string">file      :</span> <span class="string">'target/classes/iptools-'</span> + version + <span class="string">'.pom'</span>,</span><br><span class="line">                                  <span class="string">type      :</span> <span class="string">'pom'</span>]</span><br><span class="line">                         ]</span><br><span class="line">                 )</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure><p>完整DSL如下</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">    agent any</span><br><span class="line"></span><br><span class="line">    environment &#123;</span><br><span class="line">        NEXUS_URL=<span class="string">"nexus.xxx.com"</span></span><br><span class="line">        NEXUS_REPOSITOR=<span class="string">"maven-xxx"</span></span><br><span class="line">        GROUP_ID=<span class="string">"org.life-easier"</span></span><br><span class="line">        VERSION=<span class="string">"1.0.0"</span></span><br><span class="line"></span><br><span class="line">        FILE_PATH = <span class="string">"target"</span></span><br><span class="line">        FILE_NAME = <span class="string">"iptools-$&#123;VERSION&#125;.jar"</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stages &#123;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Get Code'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                git <span class="string">branch:</span> <span class="string">"master"</span>, <span class="string">credentialsId:</span> <span class="string">'xxx'</span>, <span class="string">url:</span> <span class="string">"https://gitlab.xxx.com/life-easier/iptools.git"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Build JAR'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sh <span class="string">'mvn clean package'</span></span><br><span class="line">                sh <span class="string">'ls -l $&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Publish JAR'</span>) &#123;</span><br><span class="line"></span><br><span class="line">            steps &#123;</span><br><span class="line">                nexusArtifactUploader(</span><br><span class="line"><span class="symbol">                        nexusVersion:</span> <span class="string">'nexus3'</span>,</span><br><span class="line"><span class="symbol">                        protocol:</span> <span class="string">'https'</span>,</span><br><span class="line"><span class="symbol">                        nexusUrl:</span> NEXUS_URL,</span><br><span class="line"><span class="symbol">                        groupId:</span> GROUP_ID,</span><br><span class="line"><span class="symbol">                        version:</span> VERSION,</span><br><span class="line"><span class="symbol">                        repository:</span> NEXUS_REPOSITOR,</span><br><span class="line"><span class="symbol">                        credentialsId:</span> <span class="string">'nexus-cre-id'</span>,</span><br><span class="line"><span class="symbol">                        artifacts:</span> [</span><br><span class="line">                                [<span class="string">artifactId:</span> <span class="string">'iptools'</span>,</span><br><span class="line"><span class="symbol">                                 classifier:</span> <span class="string">''</span>,</span><br><span class="line">                                 <span class="string">file      :</span> <span class="string">'target/iptools-'</span> + version + <span class="string">'.jar'</span>,</span><br><span class="line">                                 <span class="string">type      :</span> <span class="string">'jar'</span>],</span><br><span class="line">                                [<span class="string">artifactId:</span> <span class="string">'iptools'</span>,</span><br><span class="line"><span class="symbol">                                 classifier:</span> <span class="string">''</span>,</span><br><span class="line">                                 <span class="string">file      :</span> <span class="string">'target/classes/iptools-'</span> + version + <span class="string">'.pom'</span>,</span><br><span class="line">                                 <span class="string">type      :</span> <span class="string">'pom'</span>]</span><br><span class="line">                        ]</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="通过Jenkins的构建调试Job"><a href="#通过Jenkins的构建调试Job" class="headerlink" title="通过Jenkins的构建调试Job"></a>通过Jenkins的构建调试Job</h1><p>刚开始编写pipeline可能遇到很多小问题,通常是语法问题和配置问题居多.</p><p> <img src="/img/2020/Jenkins-4-3.png" alt="img"></p><p> 调试成功之后,检查NEXUS私服仓库 ,done.</p><p> <img src="/img/2020/Jenkins-4-4.png" alt="img"></p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>很多项目是通过Maven deploy的方式来实现制品上传, 这样需要把nexus的配置(服务器地址,账号,密码等)写在POM文件里.</p><p>本文提供了另外一种方式,通过pipeline的方式解耦了构建和发布,也更容易推广到别的项目里.</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Jenkins Tips , About Test</title>
      <link href="/2020/03/17/Tech-2020-2020-03-17-JenkinsTips3/"/>
      <url>/2020/03/17/Tech-2020-2020-03-17-JenkinsTips3/</url>
      <content type="html"><![CDATA[<h1 id="Jenkins插件小贴士-三-About-Test"><a href="#Jenkins插件小贴士-三-About-Test" class="headerlink" title="Jenkins插件小贴士 (三)  About Test"></a>Jenkins插件小贴士 (三)  About Test</h1><p>前2篇介绍了如何用Jenkins来实现日常的CI,本篇来介绍一下测试相关的实现.</p><h1 id="测试的类型"><a href="#测试的类型" class="headerlink" title="测试的类型"></a>测试的类型</h1><p>测试的类型有很多种,大致分为4个象限:</p><p><img src="/img/2020/Jenkins-10.jpeg" alt="img"></p><p>下面就常见的单元测试和压力测试,介绍一下如何在jenkins的构建里实现.</p><h1 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h1><p>Java项目常用的单元测试工具就是JUnit.</p><p>按照Maven的项目结构去创建测试:<br><img src="/img/2020/Jenkins-10.png" alt="img"></p><p>Maven构建的时候会去跑单元测试.<br><img src="/img/2020/Jenkins-12.png" alt="img"></p><p>单元测试的结果趋势会显示Job构建界面上.<br><img src="/img/2020/Jenkins-11.png" alt="img"></p><p>也可以去看明细的单元测试结果:<br><img src="/img/2020/Jenkins-13.png" alt="img"></p><p><em>单元测试最重要的是什么?</em><br>当然是 快 !!!</p><p>要做到快必须做到3点:</p><ol><li>no DB</li><li>no IO</li><li>no Network</li></ol><p><a href="https://github.com/Antinomy/aboutTest" target="_blank" rel="noopener">相关demo代码</a></p><h1 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h1><p>压力测试也叫性能测试,是指系统功能正常的情况,能够承载的容量测试.</p><p>Java的项目最常见的压力测试就是关于接口的测试,常见的工具有Jmeter,gatling 等.</p><p>个人推荐使用gatling来进行接口的压测,具体可以参考我以前的一遍文章:</p><p><a href="http://antinomy.top/2015/09/28/Tech-2015-2015-09-28-FirstTryOfGatling/">Gatling初体验</a></p><p>也可以从官方的Maven Demo开始学习如何使用gatling.</p><p><a href="https://github.com/gatling/gatling-maven-plugin-demo" target="_blank" rel="noopener">官方Demo</a></p><p>Demo代码是用Scala的语法编写的,模拟了一个用户通过http get 和 http post的方式去调用接口.</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> computerdatabase</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.gatling.core.<span class="type">Predef</span>._</span><br><span class="line"><span class="keyword">import</span> io.gatling.http.<span class="type">Predef</span>._</span><br><span class="line"><span class="keyword">import</span> scala.concurrent.duration._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicSimulation</span> <span class="keyword">extends</span> <span class="title">Simulation</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> httpProtocol = http</span><br><span class="line">    .baseUrl(<span class="string">"http://computer-database.gatling.io"</span>) <span class="comment">// Here is the root for all relative URLs</span></span><br><span class="line">    .acceptHeader(<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>) <span class="comment">// Here are the common headers</span></span><br><span class="line">    .acceptEncodingHeader(<span class="string">"gzip, deflate"</span>)</span><br><span class="line">    .acceptLanguageHeader(<span class="string">"en-US,en;q=0.5"</span>)</span><br><span class="line">    .userAgentHeader(<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:16.0) Gecko/20100101 Firefox/16.0"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> scn = scenario(<span class="string">"Scenario Name"</span>) <span class="comment">// A scenario is a chain of requests and pauses</span></span><br><span class="line">    .exec(http(<span class="string">"request_1"</span>)</span><br><span class="line">      .get(<span class="string">"/"</span>))</span><br><span class="line">    .pause(<span class="number">7</span>) <span class="comment">// Note that Gatling has recorder real time pauses</span></span><br><span class="line">    .exec(http(<span class="string">"request_2"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?f=macbook"</span>))</span><br><span class="line">    .pause(<span class="number">2</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_3"</span>)</span><br><span class="line">      .get(<span class="string">"/computers/6"</span>))</span><br><span class="line">    .pause(<span class="number">3</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_4"</span>)</span><br><span class="line">      .get(<span class="string">"/"</span>))</span><br><span class="line">    .pause(<span class="number">2</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_5"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=1"</span>))</span><br><span class="line">    .pause(<span class="number">670</span> milliseconds)</span><br><span class="line">    .exec(http(<span class="string">"request_6"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=2"</span>))</span><br><span class="line">    .pause(<span class="number">629</span> milliseconds)</span><br><span class="line">    .exec(http(<span class="string">"request_7"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=3"</span>))</span><br><span class="line">    .pause(<span class="number">734</span> milliseconds)</span><br><span class="line">    .exec(http(<span class="string">"request_8"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=4"</span>))</span><br><span class="line">    .pause(<span class="number">5</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_9"</span>)</span><br><span class="line">      .get(<span class="string">"/computers/new"</span>))</span><br><span class="line">    .pause(<span class="number">1</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_10"</span>) <span class="comment">// Here's an example of a POST request</span></span><br><span class="line">      .post(<span class="string">"/computers"</span>)</span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"name"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"Beautiful Computer"</span><span class="string">""</span>) <span class="comment">// Note the triple double quotes: used in Scala for protecting a whole chain of characters (no need for backslash)</span></span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"introduced"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"2012-05-30"</span><span class="string">""</span>)</span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"discontinued"</span><span class="string">""</span>, <span class="string">""</span><span class="string">""</span><span class="string">""</span>)</span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"company"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"37"</span><span class="string">""</span>))</span><br><span class="line"></span><br><span class="line">  setUp(scn.inject(atOnceUsers(<span class="number">1</span>)).protocols(httpProtocol))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>确保Jenkins已经安装了gatling的插件:<br><img src="/img/2020/Jenkins-14.png" alt="img"></p><p>Job配置上Track a Gatling load simulation<br><img src="/img/2020/Jenkins-15.png" alt="img"></p><p>构建完成之后就能看到详细的测试报告<br><img src="/img/2020/Jenkins-16.png" alt="img"></p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>通过Jenkins本身和安装的插件, 可以很方便实现单元测试与压力测试,<br>更多的难点是在测试用例的设计与编写上,集成进来反倒简单.</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Jenkins Tips , CI with Pipeline</title>
      <link href="/2020/03/11/Tech-2020-2020-03-11-JenkinsTips2/"/>
      <url>/2020/03/11/Tech-2020-2020-03-11-JenkinsTips2/</url>
      <content type="html"><![CDATA[<h1 id="Jenkins插件小贴士-二-CI-with-Pipeline"><a href="#Jenkins插件小贴士-二-CI-with-Pipeline" class="headerlink" title="Jenkins插件小贴士 (二) CI with Pipeline"></a>Jenkins插件小贴士 (二) CI with Pipeline</h1><p><img src="/img/2020/Jenkins-6.png" alt="img"></p><p>上篇简单介绍了如果通过jenkins ui来构建一个java web的过程来实现CI,</p><p>Jenkins后面提供了一个新的方式来实现同样的功能: Pipeline</p><p>Pipeline 是通过DSL的方式是编写Job的, 某种意义来说,是通过写代码的方式来实现Job,而不是UI操作.<br>这样的方式比UI更复杂,有一点的学习曲线去学习DSL的语法, 引入复杂性之后的好处就是,可以通过代码管理的方式来管理Job,<br>通过参数化,逻辑结构等应用,可以写成更加强大和多功能的Job,也带来多人协作的可能性.</p><h1 id="无论通过UI还是Pipeline-CI的流程都是一样"><a href="#无论通过UI还是Pipeline-CI的流程都是一样" class="headerlink" title="无论通过UI还是Pipeline,CI的流程都是一样."></a>无论通过UI还是Pipeline,CI的流程都是一样.</h1><p>持续集成的常见的流程如下:</p><ol><li>代码拉取</li><li>代码自动化构建</li><li>发布构建后的包到目标服务器</li><li>在目标服务器执行发布流程</li></ol><h1 id="创建Pipeline工程"><a href="#创建Pipeline工程" class="headerlink" title="创建Pipeline工程"></a>创建Pipeline工程</h1><p><img src="/img/2020/Jenkins-7.png" alt="img"></p><p>Pipeline工程不同UI工程,只能新创建的时候选择.<br>让一个脚本更加通用的方式就是把所有需要变化的地方都有参数去控制,例如控制拉取代码的分支.</p><p><img src="/img/2020/Jenkins-8.png" alt="img"></p><h1 id="编写Pipeline-DSL"><a href="#编写Pipeline-DSL" class="headerlink" title="编写Pipeline DSL"></a>编写Pipeline DSL</h1><p>然后就是Pipeline的编写了,方式有2种:</p><ol><li>直接在UI上写脚本</li><li>拉取代码库的文件</li></ol><p>方式1不推荐,因为这样和直接通过UI的方式差别不大.<br>推荐用方式2, 这样的方式需要单独创建一个代码库来放Pipeline的脚本,这样就可以进行版本控制了.</p><p><img src="/img/2020/Jenkins-9.png" alt="img"></p><p>在代码库创建一个文件叫 Jenkinsfile,编写DSL如下:</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">pipeline &#123;</span><br><span class="line">   agent any</span><br><span class="line"></span><br><span class="line">       environment &#123;</span><br><span class="line">        FILE_NAME = <span class="string">"yourProject.war"</span></span><br><span class="line">        FILE_PATH = <span class="string">"target"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   stages &#123;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Get Code'</span>)&#123;</span><br><span class="line">         steps &#123;</span><br><span class="line">            git <span class="string">branch:</span> <span class="string">"$&#123;BRANCH&#125;"</span>,<span class="string">credentialsId:</span> <span class="string">'yourGitCid'</span>, <span class="string">url:</span> <span class="string">"https://yourgitlab.com/yourProject.git"</span></span><br><span class="line">         &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Maven Build'</span>) &#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">            sh <span class="string">'mvn clean package -DskipTests'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        stage(<span class="string">'Deploy WAR'</span>)&#123;</span><br><span class="line">            steps &#123;</span><br><span class="line">                sshPublisher(</span><br><span class="line"><span class="symbol">                    continueOnError:</span> <span class="literal">false</span>,</span><br><span class="line"><span class="symbol">                    failOnError:</span> <span class="literal">true</span>,</span><br><span class="line"><span class="symbol">                    publishers:</span> [</span><br><span class="line">                        sshPublisherDesc(</span><br><span class="line"><span class="symbol">                        configName:</span> <span class="string">"$&#123;SERVER_CONFIG&#125;"</span>,</span><br><span class="line"><span class="symbol">                        verbose:</span> <span class="literal">true</span>,</span><br><span class="line"><span class="symbol">                        transfers:</span> [</span><br><span class="line">                            sshTransfer(</span><br><span class="line"><span class="symbol">                                sourceFiles:</span> <span class="string">"$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;"</span>,</span><br><span class="line"><span class="symbol">                                removePrefix:</span> <span class="string">"$&#123;FILE_PATH&#125;/"</span>,</span><br><span class="line"><span class="symbol">                                remoteDirectory:</span> <span class="string">"tomcat/deployment"</span>,</span><br><span class="line"><span class="symbol">                                execCommand:</span> <span class="string">"""</span></span><br><span class="line"><span class="string">                                    cd /app/tomcat &amp;&amp;</span></span><br><span class="line"><span class="string">                                    chmod 757 deployment/$&#123;FILE_NAME&#125; &amp;&amp;</span></span><br><span class="line"><span class="string">                                    sh ./stopTomcat.sh &amp;&amp;</span></span><br><span class="line"><span class="string">                                    sleep 10 &amp;&amp;</span></span><br><span class="line"><span class="string">                                    sh deployWAR.sh yourProject dev &amp;&amp;</span></span><br><span class="line"><span class="string">                                    sh bin/startup.sh &amp;&amp;</span></span><br><span class="line"><span class="string">                                    sh bin/catalina.sh version</span></span><br><span class="line"><span class="string">                                """</span></span><br><span class="line">                            )</span><br><span class="line">                        ])</span><br><span class="line">                    ]</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体实现步骤和方式与上一篇UI实现的是一样的, 唯一的区别就是需要学习Pipeline的语法.<br>例如通过:</p><pre><code>environment来实现环境变量stage来实现步骤sh 执行命令,maven构建,文件操作等sshPublisher 上传二进制包和执行部署脚本${xxx} 实现参数化</code></pre><p>等等 ,更多的功能随之学习内容的增加而解锁.</p><p>这样的方式更复杂,也更灵活.<br>编写不方便,调试不方便,移植方便,回溯也方便.</p><p>选择的时候需根据个人情况去权衡,个人而言更倾向Pipeline的方式,<br>通过Pipeline的UI也很直观的可以看出各个步骤所需要时间和变化.</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Jenkins Tips , CI with UI</title>
      <link href="/2020/03/11/Tech-2020-2020-03-02-JenkinsTips/"/>
      <url>/2020/03/11/Tech-2020-2020-03-02-JenkinsTips/</url>
      <content type="html"><![CDATA[<h1 id="Jenkins插件小贴士-一-CI-with-UI"><a href="#Jenkins插件小贴士-一-CI-with-UI" class="headerlink" title="Jenkins插件小贴士 (一) CI with UI"></a>Jenkins插件小贴士 (一) CI with UI</h1><p><img src="/img/2020/Jenkins-1.png" alt="img"></p><p>Jenkins是CI/CD最常见的一个工具,通过丰富的插件,可以实现很多实用的功能.<br>本文以Java Web的应用一键部署为例, 简单介绍常用的插件.</p><h1 id="CI的流程"><a href="#CI的流程" class="headerlink" title="CI的流程"></a>CI的流程</h1><p>持续集成的常见的流程如下:</p><ol><li>代码拉取</li><li>代码自动化构建</li><li>发布构建后的包到目标服务器</li><li>在目标服务器执行发布流程</li></ol><h1 id="代码拉取"><a href="#代码拉取" class="headerlink" title="代码拉取"></a>代码拉取</h1><p>首先的插件是Jenkins默认自动的Git插件,所以你的代码仓库建议是Git,而不是CVS之类的老旧代码管理工具.<br>Git在分支管理要比CVS先进很多,具体差别请自行google.</p><h1 id="Git-plug-in-tips"><a href="#Git-plug-in-tips" class="headerlink" title="Git plug-in tips"></a>Git plug-in tips</h1><p><img src="/img/2020/Jenkins-2.png" alt="img"></p><ol><li>Repository URL 配置代码的Git地址</li><li>Credentials 配置Git账号,推荐创建团队账号,避免因为个人账号问题导致拉取失败.</li><li>Branch Specifier 配置对应的分支或标签.</li></ol><blockquote><p>通过适当的分支管理,可以区分生产,测试,开发环境.<br>项目结构需做到支持多环境配置,能做到一个包可以发布到任何环境是实现CI的主要条件.<br>通过合理的使用标签,可以很方便做到应用的发布与回滚,<br>每次生产发布完成就在分支上打上tag,下次生产发布如果遇到问题就可以很方便利用tag回滚.</p></blockquote><h1 id="代码自动化构建"><a href="#代码自动化构建" class="headerlink" title="代码自动化构建"></a>代码自动化构建</h1><p><img src="/img/2020/Jenkins-3.png" alt="img"></p><p>Java应用最普遍的构建工具就是maven了,Jenkins也是首先maven插件来完成自动化构建<br>maven插件配置也很简单, Goals里写的都是maven本身的命令.<br>例如: clean清除旧包,package重新打包,-DskipTests可以跳过集成的测试(不推荐 :))</p><h1 id="发布构建后的包到目标服务器-amp-在目标服务器执行发布流程"><a href="#发布构建后的包到目标服务器-amp-在目标服务器执行发布流程" class="headerlink" title="发布构建后的包到目标服务器 &amp; 在目标服务器执行发布流程"></a>发布构建后的包到目标服务器 &amp; 在目标服务器执行发布流程</h1><p>通过Maven构建的war包,jar包一般是通过ssh发布对应的liunx服务器上去.<br>每一个应用都有其特殊的发布脚本,这些脚本需要有一定的运维能力去编写.</p><p>常用的插件有    “Publish Over SSH” 可以很方便地实现.<br><img src="/img/2020/Jenkins-4.png" alt="img"></p><p>以常见的tomcat为例,一般会在对应的服务器上创建几个文件夹和编写几个shell脚本.</p><p>SSH Server Name: 对应的Linux服务器名,具体ip和账号都在Jenkins的管理后台配置<br>Source files : 为Jenkins本地workspace的的文件,按照maven的结构,构建好的二进制包位于target目录之下.<br>Remove prefix : 去掉本地路径前缀<br>Remote directory : 对应目标服务器的相对路径,起始目录是配置好的账号默认登陆目录.<br>Exec command :当二进制包发送完毕之后需要之下的命令,部署的具体步骤在这里执行.</p><p>部署的步骤包括:</p><ol><li>停掉tomcat</li><li>备份当前的二进制包</li><li>更新最新的二进制包</li><li>启动tomcat</li></ol><p>至此一个部署流程就完毕了,部署的脚本因具体应用而异,如有中间件,需要在脚本做对应控制.</p><h1 id="通过定时任务完成CI"><a href="#通过定时任务完成CI" class="headerlink" title="通过定时任务完成CI"></a>通过定时任务完成CI</h1><p><img src="/img/2020/Jenkins-5.png" alt="img"></p><p>通过定时任务和团队约定,可以在每一天的约定时间定时进行构建,便可完成日常的CI.<br>定时的规则参考Linux的cronjob.</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Service Mesh,下一代的微服务架构</title>
      <link href="/2019/05/17/Tech-2019-2019-05-17-NextMicroService/"/>
      <url>/2019/05/17/Tech-2019-2019-05-17-NextMicroService/</url>
      <content type="html"><![CDATA[<h1 id="侵入式开发框架"><a href="#侵入式开发框架" class="headerlink" title="侵入式开发框架"></a>侵入式开发框架</h1><p>人们对分布式架构的追求从未停止,从十几年前以SSH为首的单体架构,到现在以SpringCloud为主流的微服务架构.</p><p>SpringCloud为我们带来不少好处:</p><ol><li>服务发现（Eureka）</li><li>智能路由（Zuul）</li><li>客户端负载均衡（Ribbon）</li><li>……</li></ol><p><img src="/img/2019/istio1.jpg" alt="img"></p><p>在为我们带来不少微服务架构的福利的同时,也带来了不少的挑战.</p><p>SpringCloud和Dubbo一样,都属于传统基于SDK的侵入式开发框架.</p><p>如果从零开始的项目,使用SpringCloud会很舒服.但是如果你的业务正跑着一个历史悠久的SSH架构上,侵入式开发框架带来了改造的复杂性.</p><p>笔者经历过这样的项目,一个跑在Struts2的金融项目,每天都有几千万左右的交易量,同时还在不断迭代新功能.把它慢慢拆分,迁移到SpringCloud架构,花了差不多2年的时间.</p><pre><code>人生又有多少个2年呢?</code></pre><p>运气不好遇到非Java技术栈的项目,改造的成本就更让人难以接受了!</p><p>直到我听说了Service Mesh,事情才有了新的转机…</p><h1 id="非侵入式开发框架"><a href="#非侵入式开发框架" class="headerlink" title="非侵入式开发框架"></a>非侵入式开发框架</h1><pre><code>直到 2017 年年底，当非侵入式的 Service Mesh 技术终于从萌芽到走向了成熟，当 Istio/Linkerd 横空出世，人们才惊觉：微服务并非只有侵入式一种玩法，更不是 Spring Cloud 的独角戏！</code></pre><p><img src="/img/2019/istio2.png" alt="img"></p><p>Service Mesh架构通过SideCar模式来实现非侵入式,就好比给一个传统的摩托车加入一个边车,不影响摩托车原有的内部构造前提下,增加新的功能.</p><p><img src="/img/2019/istio4.png" alt="img"></p><p>原来的业务继续跑在单独的进程里,与微服务相关的功能(服务治理,流量控制,熔断等)放到SideCar里并注入到同一个的系统/容器里.</p><p>Service Mesh中分为控制平面和数据平面,以Istio架构为例:</p><pre><code>Istio 是由 Google、IBM、Lyft 等共同开源的 Service Mesh（服务网格）框架，于2017年初开始进入大众视野。</code></pre><p>Istio 服务网格逻辑上分为数据平面和控制平面。</p><ul><li><p>数据平面由一组以 sidecar 方式部署的智能代理（Envoy）组成。这些代理可以调节和控制微服务及 Mixer 之间所有的网络通信。</p></li><li><p>控制平面负责管理和配置代理来路由流量。此外控制平面配置 Mixer 以实施策略和收集遥测数据。</p></li></ul><p><img src="/img/2019/istio5.jpg" alt="img"></p><h1 id="跨语言技术栈"><a href="#跨语言技术栈" class="headerlink" title="跨语言技术栈"></a>跨语言技术栈</h1><p>业务服务与SideCar的通讯可以通过HTTP、gRPC、WebSocket 和 TCP等通用方式,因此也带来不同语言技术栈,可以联合起来组成一个服务网格的可能性.</p><p>如下图的官方实例,3个语言技术栈可以组合起来,实现了在线书店的功能.</p><p><img src="/img/2019/istio3.png" alt="img"></p><h1 id="难点与挑战"><a href="#难点与挑战" class="headerlink" title="难点与挑战"></a>难点与挑战</h1><p>新的技术带来机遇的同时,总会带来新的挑战</p><ol><li><p>Istio与K8s更搭,所以容器化是一个很重要的前提,改造成本也是有的.</p></li><li><p>Istio目前性能不是特别理想,而且处于高速发展阶段,坑还是有的.</p></li><li><p>新的技术适合小范围使用,等待成熟再大规模推广.</p></li></ol><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献:"></a>参考文献:</h1><p>================</p><p><a href="https://www.infoq.cn/article/2017-service-mesh" target="_blank" rel="noopener">解读 2017 之 Service Mesh：群雄逐鹿烽烟起</a></p><p><a href="https://istio.io/zh/docs/examples/bookinfo/" target="_blank" rel="noopener">istio.io示例</a></p><p><a href="http://www.servicemesher.com/istio-handbook/concepts-and-principle/sidecar-pattern.html" target="_blank" rel="noopener">Sidecar 模式</a></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>微服务与DDD(领域驱动设计)</title>
      <link href="/2018/04/27/Art-2018-2018-04-27-MircoServiceWithDDD/"/>
      <url>/2018/04/27/Art-2018-2018-04-27-MircoServiceWithDDD/</url>
      <content type="html"><![CDATA[<h1 id="先说结论"><a href="#先说结论" class="headerlink" title="先说结论"></a>先说结论</h1><pre><code>搞微服务架构不晓得DDD的,项目实际落地的时候很容易会跑偏.</code></pre><p>微服务相关的内容看多的时候,或多或少见过DDD这个概念.它不是无关紧要的,而是必不可少的.<br>如果一个系统的架构不能帮助一线的员工解决业务上的困难,那么,它是难以落地的.</p><h1 id="架构很重要-但不是真空存在的"><a href="#架构很重要-但不是真空存在的" class="headerlink" title="架构很重要,但不是真空存在的"></a>架构很重要,但不是真空存在的</h1><p>谈起微服务架构,服务治理,流量控制,全栈监控等等.内容实在很多,但这些只是基础架构.</p><p>如果你有听说过康威定律,就会知道,系统的架构不能脱离组织的架构,服务的拆分不能脱离实际的业务.</p><p><img src="/img/2018/mircoservie-ddd-3.png" alt="img"></p><h1 id="DDD用于指导服务拆分"><a href="#DDD用于指导服务拆分" class="headerlink" title="DDD用于指导服务拆分"></a>DDD用于指导服务拆分</h1><p>DDD的战略设计部分,如核心域,上下文映射图等,恰恰就是指导服务拆分的良药.</p><h2 id="核心域"><a href="#核心域" class="headerlink" title="核心域"></a>核心域</h2><p>核心域与子域的寻找能帮助你定位关键业务,区分那些服务适合外包,那些必须自己做.</p><h2 id="上下文映射图"><a href="#上下文映射图" class="headerlink" title="上下文映射图"></a>上下文映射图</h2><p>上下文映射图目的在于建立服务与服务之间的地图,从组织的角度去看待服务之间上下游的关系.</p><pre><code>有了上下文映射图,就知道如何去服务拆分,每一个限界上下文就是一个微服务.</code></pre><p><img src="/img/2018/mircoservie-ddd-1.png" alt="img"></p><h1 id="事件风暴"><a href="#事件风暴" class="headerlink" title="事件风暴"></a>事件风暴</h1><p>上下文映射图的困难在于寻找服务的边界,有边界的上下文才叫限界上下文.</p><p>定义正确的上下文映射图是困难的,幸运的是,业界提供了一种叫事件风暴的实践方法来降低困难度.</p><pre><code>事件风暴是一种建模的方法,是一种反向的思考方式,从寻找关键业务事件结果为起点,一步步推论出上下文映射图.</code></pre><p> <img src="/img/2018/mircoservie-ddd-2.png" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>如何向别人介绍DDD</title>
      <link href="/2018/04/24/Art-2018-2018-04-24-sell-DDD/"/>
      <url>/2018/04/24/Art-2018-2018-04-24-sell-DDD/</url>
      <content type="html"><![CDATA[<p>近日有人问过我一个问题,如何给人介绍DDD(领域驱动设计)?</p><p>我答得不是很好,因为我从未的考虑过在没PPT的情况下,该如何有效地让人短时间内理解DDD的理念.</p><p>是阿,这么复杂的理念,该如何让人在短时间内建立印象呢?</p><h1 id="DDD有学习曲线的"><a href="#DDD有学习曲线的" class="headerlink" title="DDD有学习曲线的"></a>DDD有学习曲线的</h1><p>DDD是有学习曲线的,而且可能很陡.</p><p>它是对传统的以数据为中心建模方式的反思结果,是关于”OO Done Right”.</p><p>如果你的业务很简单,CURD就能满足的话,那没必要改造成的DDD的方式,但这并不妨碍你去了解一下什么是DDD.</p><h1 id="DDD不适合我们"><a href="#DDD不适合我们" class="headerlink" title="DDD不适合我们?"></a>DDD不适合我们?</h1><pre><code>Q: DDD不适合我们这样的公司,我们的软件开发都是交给外包团队来做的,通用语言没必要.</code></pre><p>这个问题我答得不好,因为我在前面的介绍里漏掉了”通用语言”,我陷入了先介绍战术细节的泥潭之中了.</p><p>是的,战术部分不一定适合所有的场景,但是战略部分还是很值得一试的.</p><h1 id="战术与战略"><a href="#战术与战略" class="headerlink" title="战术与战略"></a>战术与战略</h1><pre><code>战术是具体的,它是关于对象设计,程序架构,持久化策略等等.</code></pre><p><img src="/img/2018/sell-DDD-3.png" alt="img"></p><pre><code>战略是抽象的,关于问题领域分解,通用语言,上下文映射关系等等.</code></pre><p>通过对问题域的拆分,才能分辨出那些是核心域,那些是子域(包括支持子域和普通子域).<br>通常来说,子域部分适合外包出去,核心域处于自己控制的范围较好.</p><p>通用语言的最大作用是降低不同团队之间的沟通成本,如果业务逻辑沟通不顺畅的话,很大概率上会带来项目计划的延期.<br><img src="/img/2018/sell-DDD-2.png" alt="img"></p><p>上下文映射关系反映的是团队之间的关系,也适用己方与外包团队的关系.<br>认清正确的团队关系,能够更好的做系统架构上的决策.<br><img src="/img/2018/sell-DDD-1.png" alt="img"></p><h1 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h1><p>思考问题的时候,要从大局出发,先战略再战术.</p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>事件风暴工作坊初体验</title>
      <link href="/2018/03/29/Art-2018-2018-03-29-event-storming/"/>
      <url>/2018/03/29/Art-2018-2018-03-29-event-storming/</url>
      <content type="html"><![CDATA[<h1 id="工作坊初体验"><a href="#工作坊初体验" class="headerlink" title="工作坊初体验"></a>工作坊初体验</h1><p><img src="/img/2018/event-storming-workshop.png" alt="img"></p><p> 本月有幸参加DDD中国在广州举办的【微服务时代的领域驱动设计实战工作坊——广州站】，在参加之前就好奇，什么叫做工作坊？<br>一天的活动下来之后，对工作坊的工作方式有了初步的体验，我尝试把它写下来。</p><h1 id="什么是DDD？"><a href="#什么是DDD？" class="headerlink" title="什么是DDD？"></a>什么是DDD？</h1><p> 实战工作坊的核心理念是基于DDD（领域驱动设计）的，它本身并不是什么新理念，<br> 早在十几年前由Eric Evans在《领域驱动设计》提出来。</p><p> 软件设计发展历程中，首先是面向过程设计、然后再是面向对象设计（OO）。<br> 简单的业务用面向过程的方式实现是没毛病的，但是遇到复杂的业务逻辑的时候，面向过程就有心无力了。<br> 所以有了面向对象的设计，封装、继承、多态是OO的基本理念，大多数实现OO的语言都有的特性。</p><p> 但是，知道什么是OO并不等于知道如何去做到OO，有没有什么套路让我们更加有效去实现一个OO的设计呢？<br> 答案就是DDD，DDD给予我们设计OO的方向，它解决的核心问题是业务架构与系统架构如何去保持一致。</p><pre><code>领域驱动设计是一种设计方法, 试图解决的问题是软件的难以理解, 难以演化. 领域驱动设计试图分离技术实现的复杂性, 用围绕业务概念来构建领域模型的方式来控制业务的复杂性。</code></pre><h2 id="DDD三原则"><a href="#DDD三原则" class="headerlink" title="DDD三原则"></a>DDD三原则</h2><ul><li>关注核心域  </li><li>通过协助迭代探索模型  </li><li>在同个限界上下文内使用通用语言  </li></ul><h1 id="什么是事件风暴？"><a href="#什么是事件风暴？" class="headerlink" title="什么是事件风暴？"></a>什么是事件风暴？</h1><p>实现DDD的方式也是多样的，事件风暴是其中的一种。它是由Alberto Brandolini所创建的一种专注于事件的设计过程。</p><pre><code>事件风暴就是把所有的关键参与者都召集到一个很宽敞的屋子里来开会，并且使用便利贴来描述系统中发生的事情。一张桔黄色的便利贴代表一个领域事件，在上面用一句过去时的话描述曾经发生过什么事情。为了让自己关注最终目标，经常从结束时的最后一个事件开始，然后把第一个事件加上来，就有了一个从开始到结束的完整时间表。</code></pre><p><img src="/img/2018/event-storming-1.png" alt="img"></p><p>工作坊给了我们一个贴近实际的业务场景，让我们按照事件风暴的实践步骤，从事件的角度，一步步去设计业务模型。<br>经历过一天的切身体会，事件风暴是一种简单高效的建模方式，它没有UML那么复杂的条条框框，<br>也能让非技术的关键业务角色参与进来核心架构的设计过程之中，从而让系统架构和业务架构高度一致。</p><h1 id="事件风暴实践步骤"><a href="#事件风暴实践步骤" class="headerlink" title="事件风暴实践步骤"></a>事件风暴实践步骤</h1><p> 事件风暴的实践步骤主要有以下4点：</p><p><img src="/img/2018/event-storming-2.png" alt="img"></p><h2 id="事件风暴"><a href="#事件风暴" class="headerlink" title="事件风暴"></a>事件风暴</h2><p>  事件风暴的概念是来自于<a href="https://baike.baidu.com/item/%E5%A4%B4%E8%84%91%E9%A3%8E%E6%9A%B4/68278" target="_blank" rel="noopener">头脑风暴</a>  </p><p>  首先需要把项目相关的所有关键参与者都召集到一个很宽敞的屋子里来开会。 </p><p>  业务专家先介绍核心业务与主要的业务场景，参与者参与讨论。  </p><p>  参与者按照自己对业务的理解，寻找业务过程中发生过有业务价值的事件，写在橙色的即时贴上。<br> （一个事件一个即时贴，采用 “xx已xx”的格式，比如”订单已创建” ）</p><p>  每个参与者把自己的事件贴到白版上，最后按照事件时间顺序从左到右排序，去重。 </p><h2 id="命令风暴"><a href="#命令风暴" class="headerlink" title="命令风暴"></a>命令风暴</h2><p>  事件是由某些决策产生的命令触发的。决策的类型有3种：用户指令、外部系统触发、定时任务。</p><p>  从已发现的事件里倒推出相关的命令，把发出命令的决策写在蓝色的即时贴上。<br>  决策贴在事件的左边，有些决策可能触发多个事件。</p><p>  从决策出发，发现决策参考的读模型（紫色即时贴）、和触发决策的角色（黄色即时贴）。 </p><p>  <img src="/img/2018/event-storming-3.png" alt="img"></p><p>  整个流程下来，基本上所有关键的业务事件、角色、决策都可视化了。</p><h2 id="寻找聚合"><a href="#寻找聚合" class="headerlink" title="寻找聚合"></a>寻找聚合</h2><p>  从命令风暴的结果里寻找聚合（用大的黄色即时贴），保留相关的决策和事件。   </p><p>  划出边界，找出限界上下文。上下文之间建立地图，用U／D标出上游／下游的关系。</p><p>  <img src="/img/2018/event-storming-4.png" alt="img"></p><h2 id="持续探索"><a href="#持续探索" class="headerlink" title="持续探索"></a>持续探索</h2><p>  持续讨论，演进上下文映射图。<br>  从上下文出发，自然而然的做到微服务划分。   </p><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>通过工作坊的方式，可以产生很多有价值的领域模型。</p><p>微服务如何划分一直是个难点，从事件风暴出发直到画出限界上下文，服务划分自然而然。</p><p>从事件的模型出发，去实现EDA和CQRS架构也有了很好的起步了。</p><h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><ul><li><a href="http://www.infoq.com/cn/news/2016/07/event-storming-ddd" target="_blank" rel="noopener">http://www.infoq.com/cn/news/2016/07/event-storming-ddd</a>  </li><li><a href="http://www.imspender.com/articles/bu-yong-ddd-na-ni-de-wei-fu-wu" target="_blank" rel="noopener">http://www.imspender.com/articles/bu-yong-ddd-na-ni-de-wei-fu-wu</a>  </li></ul>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>One Issue Cause By Id</title>
      <link href="/2018/02/27/Tech-2018-2018-02-27-One-Issue-Cause-By-Id/"/>
      <url>/2018/02/27/Tech-2018-2018-02-27-One-Issue-Cause-By-Id/</url>
      <content type="html"><![CDATA[<h1 id="一个ID引起的血案"><a href="#一个ID引起的血案" class="headerlink" title="一个ID引起的血案"></a>一个ID引起的血案</h1><h2 id="一个少见的丢单问题"><a href="#一个少见的丢单问题" class="headerlink" title="一个少见的丢单问题"></a>一个少见的丢单问题</h2><p>最近遇到一个少见的丢单问题:</p><pre><code>2个订单在同一秒下单,产生的订单ID居然是一样的!</code></pre><p> 经过一番查找,问题的原因在生产ID的工具类实现算法有漏洞,关键方法源码如下:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LongId</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Long&gt; recentRandoms = <span class="keyword">new</span> HashSet&lt;Long&gt;(<span class="number">5000</span>);</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Generates a Twitter Snowflake compatible id utilizing randomness for the right most 22 bits and</span></span><br><span class="line"><span class="comment">     * the Twitter standard EPOCH</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> long</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">long</span> <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> currentTimestamp = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (lastTimestamp &gt; currentTimestamp) &#123;</span><br><span class="line">            <span class="comment">// Clock is running backwards so wait until it isn't</span></span><br><span class="line">            currentTimestamp = System.currentTimeMillis();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentTimestamp &lt; EPOCH || currentTimestamp &gt; MAX_SIGNED_LONG) &#123;</span><br><span class="line">            <span class="comment">// The current time cannot be less than the EPOCH</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Invalid System Clock was "</span> + <span class="keyword">new</span> Date(currentTimestamp));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> customTimestamp = currentTimestamp - EPOCH;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> shiftedTimestamp = customTimestamp &lt;&lt; TIME_SHIFT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> random = nextRandomPart();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lastTimestamp != currentTimestamp) &#123;</span><br><span class="line">            <span class="comment">// timestamp has advanced so reset it and clear the previous cache</span></span><br><span class="line">            lastTimestamp = currentTimestamp;</span><br><span class="line">            recentRandoms.clear();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Same timestamp as previous keep generating randoms till new is found</span></span><br><span class="line">            <span class="keyword">while</span> (recentRandoms.contains(random)) &#123;</span><br><span class="line">                random = nextRandomPart();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        recentRandoms.add(random);</span><br><span class="line">        <span class="keyword">return</span> shiftedTimestamp | random;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">nextRandomPart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ThreadLocalRandom.current().nextLong() &gt;&gt;&gt; RANDOM_SHIFT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个方法是参考Twitter Snowflake(一个来自Twitter的分布式ID算法)的java实现.</p><p>确定问题的方法是重现问题,幸好这个工具类是孤独的,:) ,所以写个单元测试还是比较简单的.</p><p>测试代码如下,简单来说就是模拟同一时间有多少生产ID的并发请求,当出现重复ID的时候测试失败.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LongIdTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testId_100</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        paralletTestThread(getMockTimes(<span class="number">100</span>), <span class="keyword">this</span>::getId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">paralletTestThread</span><span class="params">(List&lt;Integer&gt; list, Supplier&lt;Long&gt; method)</span> </span>&#123;</span><br><span class="line">        Map idMap = <span class="keyword">new</span> ConcurrentHashMap();</span><br><span class="line"></span><br><span class="line">        list.parallelStream().forEach(t -&gt; &#123;</span><br><span class="line">            Long id = method.get();</span><br><span class="line"></span><br><span class="line">            assertNull(id.toString(), idMap.get(id));</span><br><span class="line"></span><br><span class="line">            idMap.put(id, System.nanoTime());</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LongId.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">getMockTimes</span><span class="params">(<span class="keyword">int</span> maxTime)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; maxTime; i++)</span><br><span class="line">            list.add(i);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 测试结果,当并发次数为1000次的时候,很容易重现问题.</p><p> <img src="/img/2018/Id-Issue-1.png" alt="img"></p><p> 虽然源码通过 <em>shiftedTimestamp | random</em> 来保证每次产生的ID是不一样的,但是实验结果表面尽管shiftedTimestamp和random每次都是不一样的,</p><p> 但是与运算的结果却可能是一样的,知道问题原因就好处理了.</p><p> 重新写了一个新的ID生产算法工具类如下,在规定的时间内缓存生产的ID,如果出现重复就重新生成.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LongIdThreadSafety</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">private</span> Set&lt;Long&gt; recentRandoms = ConcurrentHashMap.&lt;Long&gt;newKeySet();</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">long</span> <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> currentTimestamp = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (lastTimestamp.get() &gt; currentTimestamp) &#123;</span><br><span class="line">            <span class="comment">// Clock is running backwards so wait until it isn't</span></span><br><span class="line">            currentTimestamp = System.currentTimeMillis();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lastTimestamp.get() != currentTimestamp) &#123;</span><br><span class="line">            <span class="comment">// timestamp has advanced so reset it and clear the previous cache</span></span><br><span class="line">            lastTimestamp.lazySet(currentTimestamp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (lastTimestamp.get() - currentTimestamp &gt; MAX_TIME_MILLIS_CHANGE) &#123;</span><br><span class="line">            recentRandoms.clear();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (currentTimestamp &lt; EPOCH || currentTimestamp &gt; MAX_SIGNED_LONG) &#123;</span><br><span class="line">            <span class="comment">// The current time cannot be less than the EPOCH</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Invalid System Clock was "</span> + <span class="keyword">new</span> Date(currentTimestamp));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> customTimestamp = currentTimestamp - EPOCH;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> shiftedTimestamp = customTimestamp &lt;&lt; TIME_SHIFT;</span><br><span class="line"></span><br><span class="line">        AtomicReference&lt;Long&gt; result = <span class="keyword">new</span> AtomicReference&lt;&gt;(<span class="keyword">null</span>);</span><br><span class="line">        AtomicReference&lt;Long&gt; random = <span class="keyword">new</span> AtomicReference&lt;&gt;(nextRandomPart());</span><br><span class="line"></span><br><span class="line">        makeUniqueId(shiftedTimestamp, result, random);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//        System.out.println(result.get() + " is build by " + shiftedTimestamp + " and " + random.get()</span></span><br><span class="line">        <span class="comment">//                + " on time " + new Date(currentTimestamp));</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">makeUniqueId</span><span class="params">(<span class="keyword">long</span> shiftedTimestamp, AtomicReference&lt;Long&gt; result, AtomicReference&lt;Long&gt; random)</span> </span>&#123;</span><br><span class="line">        result.set(shiftedTimestamp | random.get());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (recentRandoms.contains(result.get())) &#123;</span><br><span class="line">            random.set(nextRandomPart());</span><br><span class="line">            result.set(shiftedTimestamp | random.get());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!recentRandoms.contains(result.get())) &#123;</span><br><span class="line">            recentRandoms.add(result.get());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">nextRandomPart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ThreadLocalRandom.current().nextLong() &gt;&gt;&gt; RANDOM_SHIFT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  同样用相同的测试代码来测试,测试1000,10000次都通过测试,Issue Fixed !</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIdThreadSafety_1000</span><span class="params">()</span><span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        paralletTestThread(getMockTimes(<span class="number">1000</span>),<span class="keyword">this</span>::getIdThreadSafety);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIdThreadSafety_10000</span><span class="params">()</span><span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        paralletTestThread(getMockTimes(<span class="number">10000</span>),<span class="keyword">this</span>::getIdThreadSafety);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">long</span> <span class="title">getIdThreadSafety</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LongIdThreadSafety.get();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>   <img src="/img/2018/Id-Issue-2.png" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Resin 3 With JavaEE8</title>
      <link href="/2016/11/09/Tech-2016-2016-11-09-resinWithJavaEE8/"/>
      <url>/2016/11/09/Tech-2016-2016-11-09-resinWithJavaEE8/</url>
      <content type="html"><![CDATA[<h1 id="Resin-3-With-JavaEE-8"><a href="#Resin-3-With-JavaEE-8" class="headerlink" title="Resin 3 With JavaEE 8"></a>Resin 3 With JavaEE 8</h1><p><img src="/img/2016/resin.png" alt="img"></p><p>Resin 3 本身只支持JavaEE 6，要让它能允许JavaEE 8的应用是需要踩一些坑的。 ：）</p><h1 id="NoSuchMethodError-javax-persistence-Table-indexes-Ljavax-persistence-Index"><a href="#NoSuchMethodError-javax-persistence-Table-indexes-Ljavax-persistence-Index" class="headerlink" title="NoSuchMethodError: javax.persistence.Table.indexes()[Ljavax/persistence/Index"></a>NoSuchMethodError: javax.persistence.Table.indexes()[Ljavax/persistence/Index</h1><p>Resin 3 支持JavaEE 6的规范， 对应的JPA版本是JPA 2， 而Hibernate 4.3开始使用JPA 2.1。</p><p>运行时的会默认用resin/lib下的JPA 2，因为JPA 2的@Table不支持indexes属性，所以初始化Hibernate 4.3以上版本的时候会抛出javax.persistence.Table.indexes()错误。</p><p><em>解决方案</em></p><pre><code>简单粗暴的做法，就是禁止掉resin/lib/jpa-15.jar， 重命名成jpa-15.jar_bak之类，应用在运行的时候会用回Hibernate本身自带的JPA版本。</code></pre><h1 id="Unsupported-major-minor-version-52-0"><a href="#Unsupported-major-minor-version-52-0" class="headerlink" title="Unsupported major.minor version 52.0"></a>Unsupported major.minor version 52.0</h1><p>某些Resin 3的运行环境里会默认使用较低的JDK版本，比如Open JDK 7之类，所以运行JDK8编译过的类的时候会抛出Unsupported major.minor version。<br>查看resin的启动脚本/bin/httpd.sh  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -n <span class="string">"<span class="variable">$&#123;JAVA_HOME&#125;</span>"</span>; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$&#123;JAVA_EXE&#125;</span>"</span>; <span class="keyword">then</span></span><br><span class="line">    JAVA_EXE=<span class="variable">$JAVA_HOME</span>/bin/java</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -z <span class="string">"<span class="variable">$&#123;JAVA_EXE&#125;</span>"</span>; <span class="keyword">then</span></span><br><span class="line">  JAVA_EXE=java</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> <span class="variable">$JAVA_EXE</span>  -jar <span class="variable">$&#123;RESIN_HOME&#125;</span>/lib/resin.jar $*</span><br></pre></td></tr></table></figure><p>一般情况下设置${JAVA_HOME} 的环境变量为JDK8就好，我遇到一个比较坑的情况是Jenkins远程调用的时候，${JAVA_HOME}被变成了JDK7.</p><p><em>解决方案</em></p><pre><code>在启动脚本里指定指定${JAVA\_HOME}，并且export JAVA_HOME到环境变量 </code></pre><h1 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h1><p>＊ <a href="http://stackoverflow.com/questions/20734540/nosuchmethoderror-in-javax-persistence-table-indexesljavax-persistence-index" target="_blank" rel="noopener">http://stackoverflow.com/questions/20734540/nosuchmethoderror-in-javax-persistence-table-indexesljavax-persistence-index</a></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Spring MVC</title>
      <link href="/2016/09/19/Tech-2016-2016-09-19-SpringMVC/"/>
      <url>/2016/09/19/Tech-2016-2016-09-19-SpringMVC/</url>
      <content type="html"><![CDATA[<h1 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h1><p>MVC模型有很多种实现，Spring MVC是其中较经典的一种。</p><h1 id="Spring-MVC-is-a-Servlet"><a href="#Spring-MVC-is-a-Servlet" class="headerlink" title="Spring MVC is a Servlet"></a>Spring MVC is a Servlet</h1><p>本质上，Spring MVC是一个Servlet，它需要一个Servlet容器（Tomcat、WAS等）。</p><p><img src="/img/2016/SpringMVC-Servlet.png" width="800"></p><p>它提供了3个层次的Servlet：</p><ul><li><p>HttpServletBean<br>直接继承Java的HttpServlet，将Servlet中配置的参数设置到对应的属性中。</p></li><li><p>FrameworkServlet<br>初始化了WebApplication－Context和对应的组件。</p></li><li><p>DispatherServlet<br>Spring MVC最核心的类，入口方法是doService，但具体的处理在doDispath里实现，<br>doService在调用doDispatch的前后做了相应的请求处理。</p></li></ul><h2 id="doDispatch"><a href="#doDispatch" class="headerlink" title="doDispatch"></a>doDispatch</h2><p>doDispatch的主要任务有4个：</p><ol><li>根据request找到Hanlder</li><li>根据Handler找到对应的HanlderAdapter</li><li>用HanlderAdapter处理Handler</li><li>调用processDispathResult方法处理结果，并找到View渲染给用户。</li></ol><h1 id="A-Http-Request-life-cycle"><a href="#A-Http-Request-life-cycle" class="headerlink" title="A Http Request life cycle"></a>A Http Request life cycle</h1><p>一个Http请求到MVC的处理的主要步骤如下图：</p><p><img src="/img/2016/SpringMVC-Dispatch.png" width="800"></p><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul><li>《看透Spring MVC》  </li></ul><p><img src="https://img1.doubanio.com/lpic/s28824099.jpg" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Java Concurrency</title>
      <link href="/2016/09/13/Tech-2016-2016-09-13-JavaConcurrency/"/>
      <url>/2016/09/13/Tech-2016-2016-09-13-JavaConcurrency/</url>
      <content type="html"><![CDATA[<h1 id="Java-并发"><a href="#Java-并发" class="headerlink" title="Java 并发"></a>Java 并发</h1><p>一谈起并发，就离开不了同步机制、线程安全。</p><h1 id="同步机制"><a href="#同步机制" class="headerlink" title="同步机制"></a>同步机制</h1><p>Java常用的同步机制有： volatile , synchronized</p><h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><p>用volatile修饰的变量就拥有2个特性： <em>可见性、禁止指令重排序优化。</em></p><h3 id="可见性"><a href="#可见性" class="headerlink" title="可见性"></a>可见性</h3><p>保证变量对所有线程的的可见性，普通变量无法做到这点，只能通过主内存来传递。  </p><p><img src="/img/2016/JavaCurrentMem.png" width="400"></p><p>Java里的运算并非原子操作，导致volatile变量的运算在并发下也是不安全的。</p><p>从内存可见性的角度，读取volatile变量等于进入同步代码块，写入volatile等于推出同步代码块。</p><h3 id="禁止指令重排序优化"><a href="#禁止指令重排序优化" class="headerlink" title="禁止指令重排序优化"></a>禁止指令重排序优化</h3><p>指令重排序是指CPU允许多条指令不按程序规定的顺序分开发送给各相应电路单元处理。<br>volatile能保证处理器不发生乱序执行。</p><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><p>synchronized是最基本的互斥同步手段。</p><p>synchronized关键字经过编译之后，会在同步块前后形成monitorenter 和monitorexit 2个字节码指令。根据虚拟机规范，执行monitorenter会尝试加锁， 执行monitorexit会释放锁。</p><p>synchronized中的锁是非公平的，java.util.concurrent包下的ReentrantLock也有类似功能，但可以通过构造函数来实现公平锁。</p><h2 id="volatile-vs-synchronized"><a href="#volatile-vs-synchronized" class="headerlink" title="volatile vs. synchronized"></a>volatile vs. synchronized</h2><p>|———–+————|<br>|volatile   | synchronized |<br>|:———|——-:|<br>|最轻量级   | 较重（悲观并发策略）|<br>|线程不安全 | 线程安全|<br>{: rules=”groups”}</p><h1 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h1><pre><code>当多个线程访问一个对象时，如果不用考虑这些线程在运行时环境下的调度和交替执行，也不需要进行额外的同步，或者在调用方进行任何其它的协调操作，调用这个对象的行为都可以获得正确的结果，那这个对象是线程安全的。  </code></pre><ul><li>无状态对象一定是线程安全的。</li><li>不可变对象一定是线程安全的。</li></ul><p>Immutable对象一定是线程安全的，final关键字可以保证它是不变的。</p><p>  java.util.concurrent包下的对象也都是线程安全的。</p><table><thead><tr><th style="text-align:left">线程安全</th><th style="text-align:right">线程不安全</th></tr></thead><tbody><tr><td style="text-align:left">Vector、CopyOnWriteArrayList</td><td style="text-align:right">ArrayList</td></tr><tr><td style="text-align:left">HashTable、ConcurrentHashMap</td><td style="text-align:right">HashMap</td></tr></tbody></table><p>{: rules=”groups”}</p><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul><li>《深入浅出Java虚拟机》  </li></ul><p><img src="https://img3.doubanio.com/lpic/s27458236.jpg" alt="img"></p><ul><li>《Java并发编程实战》  </li></ul><p><img src="https://img3.doubanio.com/lpic/s7663093.jpg" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Java Memory Model</title>
      <link href="/2016/09/12/Tech-2016-2016-09-12-JavaMemModel/"/>
      <url>/2016/09/12/Tech-2016-2016-09-12-JavaMemModel/</url>
      <content type="html"><![CDATA[<h1 id="Java-内存模型"><a href="#Java-内存模型" class="headerlink" title="Java 内存模型"></a>Java 内存模型</h1><p>Java不像C＋＋由程序员直接管理内存，而是由虚拟机内存管理机制管理。</p><p>以JDK1.7为例子，内存模型如下：</p><h1 id="内存模型"><a href="#内存模型" class="headerlink" title="内存模型"></a>内存模型</h1><p><img src="/img/2016/JMM.png" width="600"></p><ul><li>程序计数器 （Program Counter Register）</li><li>Java虚拟机栈 （Java Virtual Machine Stacks）</li><li>本地方法栈 （Native Method Stack）</li><li>Java堆 （Java Heap）</li><li>方法区 （Method Area）</li><li>运行时常量池 （Runtime Constant Pool）</li><li>直接内存 （Direct Memory）</li></ul><h2 id="程序计数器-（Program-Counter-Register）"><a href="#程序计数器-（Program-Counter-Register）" class="headerlink" title="程序计数器 （Program Counter Register）"></a>程序计数器 （Program Counter Register）</h2><p>程序计数器是一块较小的线程私有的内存空间，用了记录正在执行的虚拟机字节码指令的地址。<br>通过改变这个计数器的值来选取下一条字节码指令，分支、循环、跳转、异常处理、线程恢复等功能都需要依靠它来实现。</p><p>执行Native方法的时候，其值为空（Undefined）。</p><p>此内存区域是虚拟机规范唯一没有规定任何OutOfMemoryError的区域。</p><h2 id="Java虚拟机栈-（Java-Virtual-Machine-Stacks）"><a href="#Java虚拟机栈-（Java-Virtual-Machine-Stacks）" class="headerlink" title="Java虚拟机栈 （Java Virtual Machine Stacks）"></a>Java虚拟机栈 （Java Virtual Machine Stacks）</h2><p>Java虚拟机栈也是线程私有的内存空间，它的生命周期和线程一样。</p><p>它是描述Java方法执行的内存模型：</p><pre><code>每个方法在执行的同时都会创建一个栈桢（Stack Frame），用于存储局部变量表、操作数栈、动态链接、方法出口等信息。</code></pre><p>每个方法从调用到结束，就对应一个栈桢在虚拟机栈中入栈到出栈的过程。</p><h2 id="本地方法栈-（Native-Method-Stack）"><a href="#本地方法栈-（Native-Method-Stack）" class="headerlink" title="本地方法栈 （Native Method Stack）"></a>本地方法栈 （Native Method Stack）</h2><p>本地方法栈 （Native Method Stack）与Java虚拟机栈的作用非常相似，其区别是：</p><pre><code>虚拟机栈为Java方法服务，本地方法栈为虚拟机用到的Native方法服务。</code></pre><h2 id="Java堆-（Java-Heap）"><a href="#Java堆-（Java-Heap）" class="headerlink" title="Java堆 （Java Heap）"></a>Java堆 （Java Heap）</h2><p>Java堆是所有线程共享的内存区域，是最大的一块。</p><p>其唯一目的就是存放对象实例，也是GC管理的主要区域。</p><p>从内存回收的角度，还可以细分为： 新生代（Young Generation）和老年代（Old Generation）等。</p><p><img src="http://cdn1.infoqstatic.com/statics_s2_20160914-0333/resource/news/2016/09/APM-jClarity-jvm-heap-oldgen/zh/resources/2.png" alt="img"></p><p>年轻代为创建的短期对象，失效之后很快会被垃圾回收。该区又被划分为Eden和两个Survivor区域。</p><p>老年代存放的多数为存活时间较长的对象。</p><p>垃圾回收GC分为两种Minor GC、Full GC；</p><p>Minor GC发生频繁，但是仅针对年轻代。</p><h3 id="Full-GC-触发条件"><a href="#Full-GC-触发条件" class="headerlink" title="Full GC 触发条件"></a>Full GC 触发条件</h3><ul><li>调用System.gc()</li><li>老年代空间不足</li><li>永久代空间不足</li><li>空间分配担保失败</li><li>Cocurrent mode failure</li></ul><h2 id="方法区-（Method-Area）"><a href="#方法区-（Method-Area）" class="headerlink" title="方法区 （Method Area）"></a>方法区 （Method Area）</h2><p>方法区用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。</p><p>虽然和Java堆一样是各个线程共享的内存区域，却有一个别名 Non－Heap （非堆）</p><p>在HotSpot虚拟机上“方法区”被更多人称为“永久代” （Permanent Generation），但对其它虚拟机并不存在这样的概念。</p><p><img src="/img/2016/Java7MM.png" width="800"></p><p>而且在JDK8里，永久代也被Metaspace所替代，位置也移到native memory里。</p><p>这样做的好处在于：简化GC的算法，full gc的时候更高效率。</p><p><img src="/img/2016/Java8MM.png" width="800"></p><h2 id="运行时常量池-（Runtime-Constant-Pool）"><a href="#运行时常量池-（Runtime-Constant-Pool）" class="headerlink" title="运行时常量池 （Runtime Constant Pool）"></a>运行时常量池 （Runtime Constant Pool）</h2><p>运行时常量池 是方法区的一部分，用于存储编译期生成的各种字面量和符号引用，在类加载后进入方法区的运行时常量池中。</p><h2 id="直接内存-（Direct-Memory）"><a href="#直接内存-（Direct-Memory）" class="headerlink" title="直接内存 （Direct Memory）"></a>直接内存 （Direct Memory）</h2><p>直接内存不是虚拟机运行时数据区的一部分，也不是Java虚拟机规范中定义的内存区域。<br>它属于堆外内存，受到本机内存大小、寻址空间的限制。</p><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul><li>《深入浅出Java虚拟机》  </li></ul><p><img src="https://img3.doubanio.com/lpic/s27458236.jpg" alt="img"></p><ul><li><a href="http://www.infoq.com/cn/news/2016/09/APM-jClarity-jvm-heap-oldgen" target="_blank" rel="noopener">JVM堆内存监测的一种方式，性能调优依旧任重道远</a></li></ul>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>JVM Class Loader</title>
      <link href="/2016/09/09/Tech-2016-2016-09-09-jvm-classloader/"/>
      <url>/2016/09/09/Tech-2016-2016-09-09-jvm-classloader/</url>
      <content type="html"><![CDATA[<h1 id="浅谈类加载机制"><a href="#浅谈类加载机制" class="headerlink" title="浅谈类加载机制"></a>浅谈类加载机制</h1><p>本文以JDK1.7为例子，简单地介绍一下类加载的原理。</p><h1 id="类生命周期"><a href="#类生命周期" class="headerlink" title="类生命周期"></a>类生命周期</h1><p>说起类加载，就不得不先谈一下类的生命周期。<br>主要有以下7个阶段：</p><ul><li>加载（Loading）</li><li>连接 （Linking）<ul><li>验证 （Verification）</li><li>准备 （Preparation）</li><li>解析 （Resolution）</li></ul></li><li>初始化 （Initialization）</li><li>使用 （Using）</li><li>卸载 （Unloading）</li></ul><p><img src="/img/2016/Jvm-ClassLife.png" width="800">  </p><p>验证、准备、解析3部分统称连接。  </p><h2 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h2><p>在加载阶段，虚拟机需要完成以下3件事情：  </p><ul><li>通过一个类的全限定名来获取定义此类的二进制字节流。</li><li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。</li><li>在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据的访问接口。</li></ul><h2 id="初始化时机"><a href="#初始化时机" class="headerlink" title="初始化时机"></a>初始化时机</h2><p>虚拟机规范严格规定 <em>有且只有</em> 5种情况必须立即对类进行初始化：  </p><ul><li>使用关键字new实例化一个对象、读取或设置静态字段的时候  </li><li>使用java.lang.reflect包进行反射调用的时候</li><li>初始化一个子类的时候，如果其父类为初始化，需要先触发。</li><li>虚拟机启动，用户指定的一个包含main（）方法的执行主类的时候。</li><li>使用动态语言，一个java.lang.invoke.MethodHandle实例，<br>最后解析结果”REF_getStatic, REF_putStatic,REF_invokeStatic”句柄所对应的未进行过初始化的类。</li></ul><h1 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h1><p>类加载器的主要作用：就是实现“通过一个类的全限定名来获取定义此类的二进制字节流” 这个动作的。</p><p>类加载器主要有3种：</p><ul><li><p>启动类加载器 （Bootstrap ClassLoader）:  C＋＋实现，负责加载&lt;JAVA_HOME&gt;\lib目录下（或-Xbootclasspath指定路径）的类库。<br>无法被Java程序直接引用。</p></li><li><p>扩张类加载器 （Extension ClassLoader）:  sun.misc.Launcher$ExtClassLoader实现，负责加载&lt;JAVA_HOME&gt;\lib\ext目录下(或java.ext.dirs指定路径)的类库。<br>开发者可以直接使用。</p></li><li><p>应用程序类加载器（Application ClassLoader）: sun.misc.Launcher$ClassLoader实现，负责加载用户类路径（ClassPath）下的类库。<br>开发者可以直接使用。</p></li></ul><h2 id="双亲委托模型-（Parents-Delegation-Model）"><a href="#双亲委托模型-（Parents-Delegation-Model）" class="headerlink" title="双亲委托模型 （Parents Delegation Model）"></a>双亲委托模型 （Parents Delegation Model）</h2><p><img src="/img/2016/Jvm-ClassLoader.png" width="800">  </p><p>除了顶层启动类加载器之外，其余的类加载器都有自己的父类加载器，他们的父子关系一般不会以继承（Inheritance）的关系来实现，而是通过组合（Composition）关系来复用。  </p><p>双亲委托模型的原理是：</p><ul><li>当收到类加载请求，不会自己去加载，而是委托给父类加载器。</li><li>每一层都一样，最终都到达顶层的启动类加载器中。</li><li>只有父加载器无法加载，子加载器才会尝试自己加载。</li></ul><p>好处：  </p><pre><code>Java类有顶级优先级，保证了Java程序的稳定运作。（例如rt.jar里的java.lang.Object,无论哪一个类加载器加载，最终都会委派给启动类加载器加载）</code></pre><p>双亲委托模型并不是强制性的约束模型，某些情况下也有例外：</p><ul><li>JDK1.2之后才引入“双亲委托” ，向前兼容JDK1.0的用户自定义ClassLoader。</li><li>涉及SPI的加载方式： JNDI、JDBC、JCE、JAXB、JBI等。</li><li>OSGi环境下，类加载器不再是双亲委托模型的树状结构，而是更加复杂的网状结构。</li></ul><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul><li>《深入浅出Java虚拟机》  </li></ul><p><img src="https://img3.doubanio.com/lpic/s27458236.jpg" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Four-quadrant diagram and ROI</title>
      <link href="/2016/09/02/Art-2016-2016-09-02-AgileTest/"/>
      <url>/2016/09/02/Art-2016-2016-09-02-AgileTest/</url>
      <content type="html"><![CDATA[<h1 id="四象限图与ROI"><a href="#四象限图与ROI" class="headerlink" title="四象限图与ROI"></a>四象限图与ROI</h1><p>读完这本《敏捷软件测试》，印象最深刻莫过于测试的象限图。  </p><h1 id="四象限图"><a href="#四象限图" class="headerlink" title="四象限图"></a>四象限图</h1><p><img src="/img/2016/AgileTest1.png" width="800"></p><p>从象限图里，可以知道测试的类型有多少种，什么时候应该执行那种测试。<br>什么样的时候应该自动化，什么样的时候不应该测试。  </p><h1 id="ROI-（投资回报率）"><a href="#ROI-（投资回报率）" class="headerlink" title="ROI （投资回报率）"></a>ROI （投资回报率）</h1><p>衡量某种测试是否值得去做自动化的关键指标就是ROI （投资回报率）。<br>API接口和核心业务属于相对较稳定的部分，实现自动化测试的回报率也高。  </p><h1 id="自动化"><a href="#自动化" class="headerlink" title="自动化"></a>自动化</h1><p>敏捷项目依赖于自动化，离开自动化的项目不能称之为敏捷项目。<br>自动化单元测试的基石是TDD，离开TDD的方式去实现自动化单元测试，ROI也是低下的。  </p><p><img src="/img/2016/AgileTest2.png" width="800"></p><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>*《敏捷软件测试》  </p><p><img src="https://img3.doubanio.com/lpic/s22778583.jpg" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>NoSQL Distilled</title>
      <link href="/2016/02/15/Tech-2016-2016-02-15-NoDQLDistilled/"/>
      <url>/2016/02/15/Tech-2016-2016-02-15-NoDQLDistilled/</url>
      <content type="html"><![CDATA[<h1 id="NoSQL-精粹"><a href="#NoSQL-精粹" class="headerlink" title="NoSQL 精粹"></a>NoSQL 精粹</h1><p><img src="http://img3.douban.com/lpic/s27174573.jpg" alt="img"><br>Martin Fowler和Pramond（《数据库重构》作者）联合出品的这本书，为了我们如何看待、使用NoSQL数据库，提供了一个很好的起点。  </p><h1 id="为什么要用NoSQL？"><a href="#为什么要用NoSQL？" class="headerlink" title="为什么要用NoSQL？"></a>为什么要用NoSQL？</h1><p>关系型数据库有很多优势，但绝非完美。对开发者来说，最令他们失望的就是：<br>    关系模型和内存中的数据结构存在差异，即 “阻抗失谐”  </p><p>另外，关系型数据库在集群的环境中使用的成本较高，不适用于21世纪的互联网公司。<br>NoSQL作为无模式、非关系数据库而出现，有效的解决以上问题。<br>为关系型数据库做了有益的补充，让混合持久化成为了当今的趋势。  </p><h1 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h1><p><img src="/img/2016/NoDQL1.png" alt="img"></p><p>NoSQL数据库的数据模型有2种：面向聚合的数据模型、面向复杂关系的数据模型。<br>键值、文档、列族类型的NoSQL数据库都属于面向聚合的数据模型。<br>而“图”数据库则是一个异类，它比关系型数据库更擅长处理复杂的关系，补充了关系型数据库的另外一个不足之处。   </p><p>它们都是无模式的数据库，可以随意新增字段，然而用户在使用数据时，通常还是要遵循一套隐式模式。  </p><p>面向聚合的数据库对于复杂查询的支持比不上关系型数据库，它通常是用不同的方式重组主聚合的数据，以计算出各种“物化视图”。计算过程一般通过“map－reduce”来实现。</p><h1 id="分布式模型"><a href="#分布式模型" class="headerlink" title="分布式模型"></a>分布式模型</h1><pre><code>在不需要分布数据就能应对时，总应选用“单一服务器”方案。</code></pre><p>数据分布的路径有2种：复制（replication）、分片（sharding） 。<br>2者是“正交的” ，可单独使用，也可以结合使用。  </p><p>由简至繁的顺序如下：  </p><ul><li>单一服务器</li><li>分片</li><li>主从复制</li><li>对等复制</li></ul><h2 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h2><p>把数据分部分存放在不同服务器中，以此实现横向扩张，这种技术就叫“分片”。<br>分片同时提高来读取和写入的效率，但也有可能降低数据库的错误恢复能力。</p><p><img src="/img/2016/NoDQL2.png" width="800"></p><h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><p>主持复制通常是经过“投票”的方法来选定一个“主节点”，“主节点”负责写入数据，通过复制的方式把数据同步到“从节点”，“从节点”复制数据的读取。  </p><p>主从复制适合需要频繁读取数据的情况，它增强来读取操作的故障恢复能力。<br>但其缺点是，在数据同步的过程中，容易带来数据的不一致性.  </p><h2 id="对等复制"><a href="#对等复制" class="headerlink" title="对等复制"></a>对等复制</h2><p>对等复制没有“主节点”的概念，所有的节点对等的写入和读取。<br>但它也存在数据的不一致性的问题。</p><h1 id="版本戳"><a href="#版本戳" class="headerlink" title="版本戳"></a>版本戳</h1><p>版本戳可以由计数器、GUID、内容哈希码、时间戳来实现，或者组合其中几种来实现。<br>通过版本戳可以有效的检测并发冲突问题。  </p><h1 id="映射-从简"><a href="#映射-从简" class="headerlink" title="映射-从简"></a>映射-从简</h1><pre><code>map-reduce是一种集群上执行并发计算的模式</code></pre><p>“映射”任务从聚合中读取数据，将之缩减为相关键值对。<br>“从简”任务将“映射”任务生成的许多相同关键字的值简化为一个输出值。<br>它们之间可以通过“管道”的方式来组合，通过“物化视图”来存储招的计算结果。  </p><h1 id="键值数据库"><a href="#键值数据库" class="headerlink" title="键值数据库"></a>键值数据库</h1><p>键值数据库（key－value）是一张简单的哈希表，所有数据库访问都通过主键来操作。  </p><p>流行的键值数据库有：Riak，Redis、Memcached等。。  </p><h2 id="适用场合"><a href="#适用场合" class="headerlink" title="适用场合"></a>适用场合</h2><ul><li>session信息</li><li>用户配置信息</li><li>购物车数据</li></ul><h2 id="不适用场合"><a href="#不适用场合" class="headerlink" title="不适用场合"></a>不适用场合</h2><ul><li>数据间关系</li><li>含有多项操作的事务</li><li>查询数据</li><li>操作关键字集合</li></ul><h1 id="文档数据库"><a href="#文档数据库" class="headerlink" title="文档数据库"></a>文档数据库</h1><p>文档数据库以“文档”为主要概念，存储格式可以是XML、JSON、BSON等。  </p><p>流行的文档数据库有： MongoDB、CouchDB等  </p><p>它有一个键值数据库没有的好处： 可以直接查询文档中的数据，不需要先根据关键字获取整个文档。  </p><h2 id="适用场合-1"><a href="#适用场合-1" class="headerlink" title="适用场合"></a>适用场合</h2><ul><li>事件记录</li><li>CMS与Blog</li><li>网站分析与实时分析</li><li>电子商务</li></ul><h2 id="不适用场合-1"><a href="#不适用场合-1" class="headerlink" title="不适用场合"></a>不适用场合</h2><ul><li>包含多项操作的复杂事务</li><li>查询持续变化的聚合结构</li></ul><h1 id="列族数据库"><a href="#列族数据库" class="headerlink" title="列族数据库"></a>列族数据库</h1><p>列族数据库可以存储关键字及其映射值，并且可以把值分成多个列族，让每个列族代表一张数据映射表。  </p><p>流行的列族数据库有： Cassandra、HBase等</p><h2 id="适用场合-2"><a href="#适用场合-2" class="headerlink" title="适用场合"></a>适用场合</h2><ul><li>事件记录</li><li>CMS与Blog</li><li>计数器</li><li>限期使用</li></ul><h2 id="不适用场合-2"><a href="#不适用场合-2" class="headerlink" title="不适用场合"></a>不适用场合</h2><ul><li>查询模式多变的场景</li></ul><h1 id="图数据库"><a href="#图数据库" class="headerlink" title="图数据库"></a>图数据库</h1><p>图数据库可以存放实体及实体间的关系，实体也叫“节点”，它们之间的关系也叫“边”。</p><p>流行的图数据库有：Neo4J、HyperGraphDB 等</p><h2 id="适用场合-3"><a href="#适用场合-3" class="headerlink" title="适用场合"></a>适用场合</h2><ul><li>互联数据</li><li>基于位置的服务</li><li>推荐引擎</li></ul><h2 id="不适用场合-3"><a href="#不适用场合-3" class="headerlink" title="不适用场合"></a>不适用场合</h2><ul><li>属性多变的场景</li></ul><h1 id="混合持久化"><a href="#混合持久化" class="headerlink" title="混合持久化"></a>混合持久化</h1><pre><code>不同的数据库用来解决不同的问题，只用一种数据库引擎的时代已经过去。</code></pre><p><img src="/img/2016/NoDQL3.png" width="800"></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Building MicroService</title>
      <link href="/2015/11/24/Art-2015-2015-11-24-buildingMicroService/"/>
      <url>/2015/11/24/Art-2015-2015-11-24-buildingMicroService/</url>
      <content type="html"><![CDATA[<h1 id="构建微服务"><a href="#构建微服务" class="headerlink" title="构建微服务"></a>构建微服务</h1><p><img src="http://ec4.images-amazon.com/images/I/51gi3fUMdzL._SX379_BO1,204,203,200_.jpg" alt="img">  </p><p>微服务向来是我个人更倾向的一种架构风格，它具有更加开放的技术姿态。<br>通过阅读这本《Building MicroService》，让我对微服务有了更深入的了解，同时也发现了它与DDD、CD是完美契合的。  </p><h1 id="康威定律"><a href="#康威定律" class="headerlink" title="康威定律"></a>康威定律</h1><pre><code>任何设计系统的组织，最终产生的设计等同于组织之内、之间的沟通结构。系统架构的设计符合组织沟通结构取得的收益最大。</code></pre><p>组织的架构最终决定系统的架构，如果你存在一个等级森严、层层架构的组织，那么，微服务就不一定适合你的组织。</p><h1 id="什么是微服务？"><a href="#什么是微服务？" class="headerlink" title="什么是微服务？"></a>什么是微服务？</h1><pre><code>这个世界上既不存在银弹，也不会有免费的午餐。</code></pre><p>微服务作为一个新兴的分布式系统架构，它解决了如何实现低耦合、高内聚的问题，同时也带来了很多分布系统特有的复杂性。</p><pre><code>微服务是指：一些小而独立的服务联合起来一起工作。</code></pre><p><em>那么，多小算小？</em></p><p>给一个具体的代码行数是不靠谱的，不同的语言实现同样的功能，所需要的行数也是不同。<br>一般来说，一个team花2周的时间就能实现的功能大小比较合适。</p><h2 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h2><ul><li>技术多样性</li><li>容灾性</li><li>伸缩性</li><li>容易部署</li><li>与组织结构对应</li><li>组合性</li><li>可替换性</li></ul><h2 id="挑战"><a href="#挑战" class="headerlink" title="挑战"></a>挑战</h2><ul><li>切分</li><li>部署</li><li>监控</li><li>安全</li><li>集成</li></ul><p><img src="/img/2015/mircoService_1.png" alt="img"><br>（使用不同的技术栈来构建微服务）  </p><h2 id="MicroService-vs-SOA"><a href="#MicroService-vs-SOA" class="headerlink" title="MicroService vs SOA"></a>MicroService vs SOA</h2><p>微服务是一种特殊的SOA实现方式，就像XP ／ Scrum是敏捷开发的一种实现方式。</p><h1 id="进化的架构"><a href="#进化的架构" class="headerlink" title="进化的架构"></a>进化的架构</h1><p>构建微服务的过程中，架构师的角色更像是一个城市规划师，而不是一栋建筑的设计师。<br>架构师需要制定对应的：战略目标、规则、以及实践方式。  有统一标准的监控、接口实现方式和安全措施。  </p><h1 id="集成"><a href="#集成" class="headerlink" title="集成"></a>集成</h1><h2 id="服务集成"><a href="#服务集成" class="headerlink" title="服务集成"></a>服务集成</h2><p>理想的集成技术应该是：</p><ul><li>避免破坏性的改变  </li><li>保持API的技术无限性  </li><li>让消费者简单使用服务  </li><li>隐藏实现细节  </li></ul><h2 id="共享数据库"><a href="#共享数据库" class="headerlink" title="共享数据库"></a>共享数据库</h2><p>共享数据库的方式让数据更容易去共享，但对行为的共享没有任何帮助。</p><h2 id="同步-vs-异步"><a href="#同步-vs-异步" class="headerlink" title="同步 vs 异步"></a>同步 vs 异步</h2><p>同步没什么好说的。 ：）</p><p>异步的交流方式有2种 ：<br>request/response 或者 event-based</p><p><em>request/response</em>： 一问一答的方式比较传统，也可用于同步的方式。</p><p><em>event-based</em>： 事件驱动,这种方式是基于事物状态的变化，能够高度的解耦。</p><h2 id="RPC-（Remote-Procedure-Calls）"><a href="#RPC-（Remote-Procedure-Calls）" class="headerlink" title="RPC （Remote Procedure Calls）"></a>RPC （Remote Procedure Calls）</h2><p>RPC的技术能让本地环境方便去调用外部接口，同时也具有较高的性能。</p><p>但是它也存在一些特有的问题：</p><ul><li>技术耦合</li><li>本地调用不等于远程调用</li><li>易脆</li></ul><p>一些RPC的机制，例如Java RMI，会严重地去依赖某个特定的平台，限制服务器和客户端所使用的技术。  </p><p>RPC的核心理念是隐藏远程调用的复杂性，但是往往隐藏的过多，本地调用并不等于远程调用。  </p><p><em>分布式系统的第一谬误， “网络是稳定的”。</em>  </p><p>任何RPC机制的最大问题在于，无法分开部署客户端和服务器端。<br>如果你使用这项技术，未来的更新步骤是锁步的。  </p><h2 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h2><p>REST是基于HTTP本身特性的架构风格，它有三种成熟度模型，详情请查看 <a href="http://antinomy.github.io/art/2015/07/03/RichardsonMaturityModel.html" target="_blank" rel="noopener">Richardson Restful成熟度模型</a></p><h2 id="DRY"><a href="#DRY" class="headerlink" title="DRY"></a>DRY</h2><p>DRY原则更多的是：关于避免重复系统的行为和知识，而不是单单代码层面的重复。</p><h1 id="实践原则"><a href="#实践原则" class="headerlink" title="实践原则"></a>实践原则</h1><p><img src="/img/2015/mircoService_2.png" alt="img">  </p><h2 id="围绕业务内容建模"><a href="#围绕业务内容建模" class="headerlink" title="围绕业务内容建模"></a>围绕业务内容建模</h2><p>多年来的工作经验告诉我们：基于业务边界划分的结构，要远比基于技术内容划分的结构稳定。</p><p>《领域驱动设计》里面的限界上下文是一个很棒的出发点， 它提供了一个从业务的角度去划分模块的方式。 </p><h2 id="拥抱自动化的文化"><a href="#拥抱自动化的文化" class="headerlink" title="拥抱自动化的文化"></a>拥抱自动化的文化</h2><p>微服务带来了很多复杂性，克服这些困难的关键是要拥抱自动化开发的文化，如自动化测试，持续交付等等实践。</p><h2 id="隐藏实现细节"><a href="#隐藏实现细节" class="headerlink" title="隐藏实现细节"></a>隐藏实现细节</h2><p>采取无限技术的方式，例如REST，能够让你更自由地使用不同的技术栈。<br>尽量隐藏实现的细节，服务的消费者不需要知道服务是用什么语言实现，是用什么样的数据库。  </p><h2 id="去中心化所有东西"><a href="#去中心化所有东西" class="headerlink" title="去中心化所有东西"></a>去中心化所有东西</h2><p>为了让每一个微服务尽可能的独立，去中心化所有的东西能够避免把所有的鸡蛋都放在一起。</p><h2 id="独立部署"><a href="#独立部署" class="headerlink" title="独立部署"></a>独立部署</h2><p>通过蓝绿或者金丝雀部署方式，可以降低部署的风险。<br>采用消费者驱动契约的方式能够尽早的发现问题。</p><h2 id="隔离失败"><a href="#隔离失败" class="headerlink" title="隔离失败"></a>隔离失败</h2><p>理解和计划失败是分布式系统的一部分，通过Bulkheads或者Circuit breakers模式能够有效的控制失败带来的影响。</p><h2 id="高度可视化"><a href="#高度可视化" class="headerlink" title="高度可视化"></a>高度可视化</h2><p>聚合所有的日志和状态，通过语义监控来观察系统是否正常。 使用correlation IDs可以方便地跟踪系统调用的痕迹。</p><h1 id="分布式领域CAP理论"><a href="#分布式领域CAP理论" class="headerlink" title="分布式领域CAP理论"></a>分布式领域CAP理论</h1><p><img src="/img/2015/mircoService_3.png" alt="img">  </p><p>Consistency(一致性),  数据一性<br>Availability(可用性), 好的响应性能<br>Partition tolerance(分区容错性) 可靠性  </p><p>定理：任何分布式系统只可同时满足二点，没法三者兼顾。<br>CA不属于分布式系统，所以只考虑AP和CP。<br>AP要比CP容易实现，具体用哪一种要看具体业务。  </p><h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1><p>这么多年来，我们不断地找到更好的方式去开发系统：<br>Eric Evans‘s 《领域驱动设计》 帮助我们去了解让代码去呈现真实世界的重要性。<br>《持续交付》告诉我们如何更加有效率的发布软件到生产环境。<br>Alistair Cockburn的 <a href="http://antinomy.github.io/art/2014/11/20/HexArchitecture.html" target="_blank" rel="noopener">六边形架构</a> 告诉我们如何避免把业务逻辑四分五裂的隐藏在各层的架构上。<br>各种虚拟化平台，如Amazon云、阿里云，允许我们去定制自己所需要的机器。<br>最近，Netflix公司跟我们分享来一种 <a href="http://www.infoq.com/cn/news/2015/11/ScaleScale-MaxCDN-NetFlix" target="_blank" rel="noopener">高扩展性的架构风格</a> ，<br>既微服务架构，这种架构在十年前很难实现，幸运地是，今时不同往日。 ：）</p>]]></content>
      
      <categories>
          
          <category> Tao </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>First Try of Gatling</title>
      <link href="/2015/09/28/Tech-2015-2015-09-28-FirstTryOfGatling/"/>
      <url>/2015/09/28/Tech-2015-2015-09-28-FirstTryOfGatling/</url>
      <content type="html"><![CDATA[<h1 id="次时代压力测试工具：Gatling初体验"><a href="#次时代压力测试工具：Gatling初体验" class="headerlink" title="次时代压力测试工具：Gatling初体验"></a>次时代压力测试工具：Gatling初体验</h1><p><img src="/img/2015/gatling1.png" width="800"></p><h1 id="为什么用Gatling？"><a href="#为什么用Gatling？" class="headerlink" title="为什么用Gatling？"></a>为什么用Gatling？</h1><p>因工作需要，要对HTTP接口进行专门的压力测试。<br>经过一番考虑，我选择了 <a href="http://gatling.io/" target="_blank" rel="noopener">Gatling</a> 。</p><pre><code>Gatling 作为次时代的压力测试工具，具有高性能，结果报表友好，支持DSL等特点。</code></pre><p>不同于它的前辈JMeter， Gatling 是基于Scala、Akka、Netty的。<br>优点在于它对多并发测试有着强力的性能表现，缺点自然是学习曲线稍微高一点。  </p><p><em>所以在性能上，Gatling的表现是优于JMeter的，这也是我为什么选择它的原因。</em><br><img src="/img/2015/gatling2.png" alt="img"></p><h1 id="怎么用Gatling？"><a href="#怎么用Gatling？" class="headerlink" title="怎么用Gatling？"></a>怎么用Gatling？</h1><p>既然它是基于Scala的，一门新语言对很多固守成规的人的来说，有着不小的心里成本。<br>但还是可以有某些技巧可以减少学习成本，例如，可以直接从官方的例子来学习：</p><p><a href="https://github.com/gatling/gatling-maven-plugin-demo" target="_blank" rel="noopener">gatling-maven-plugin-demo</a></p><p>我选择了和maven相关的例子，这样是为了以后方便和CI服务器集成。<br><img src="/img/2015/gatling3.png" alt="img"></p><p>首页就介绍了如何用maven去运行gatling，从运行入口BasicSimulation.scala 就可以学习基本的用法。</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> computerdatabase</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.gatling.core.<span class="type">Predef</span>._</span><br><span class="line"><span class="keyword">import</span> io.gatling.http.<span class="type">Predef</span>._</span><br><span class="line"><span class="keyword">import</span> scala.concurrent.duration._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicSimulation</span> <span class="keyword">extends</span> <span class="title">Simulation</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> httpConf = http</span><br><span class="line">    .baseURL(<span class="string">"http://computer-database.gatling.io"</span>) <span class="comment">// Here is the root for all relative URLs</span></span><br><span class="line">    .acceptHeader(<span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>) <span class="comment">// Here are the common headers</span></span><br><span class="line">    .doNotTrackHeader(<span class="string">"1"</span>)</span><br><span class="line">    .acceptLanguageHeader(<span class="string">"en-US,en;q=0.5"</span>)</span><br><span class="line">    .acceptEncodingHeader(<span class="string">"gzip, deflate"</span>)</span><br><span class="line">    .userAgentHeader(<span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:16.0) Gecko/20100101 Firefox/16.0"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> headers_10 = <span class="type">Map</span>(<span class="string">"Content-Type"</span> -&gt; <span class="string">""</span><span class="string">"application/x-www-form-urlencoded"</span><span class="string">""</span>) <span class="comment">// Note the headers specific to a given request</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> scn = scenario(<span class="string">"Scenario Name"</span>) <span class="comment">// A scenario is a chain of requests and pauses</span></span><br><span class="line">    .exec(http(<span class="string">"request_1"</span>)</span><br><span class="line">      .get(<span class="string">"/"</span>))</span><br><span class="line">    .pause(<span class="number">7</span>) <span class="comment">// Note that Gatling has recorder real time pauses</span></span><br><span class="line">    .exec(http(<span class="string">"request_2"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?f=macbook"</span>))</span><br><span class="line">    .pause(<span class="number">2</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_3"</span>)</span><br><span class="line">      .get(<span class="string">"/computers/6"</span>))</span><br><span class="line">    .pause(<span class="number">3</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_4"</span>)</span><br><span class="line">      .get(<span class="string">"/"</span>))</span><br><span class="line">    .pause(<span class="number">2</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_5"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=1"</span>))</span><br><span class="line">    .pause(<span class="number">670</span> milliseconds)</span><br><span class="line">    .exec(http(<span class="string">"request_6"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=2"</span>))</span><br><span class="line">    .pause(<span class="number">629</span> milliseconds)</span><br><span class="line">    .exec(http(<span class="string">"request_7"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=3"</span>))</span><br><span class="line">    .pause(<span class="number">734</span> milliseconds)</span><br><span class="line">    .exec(http(<span class="string">"request_8"</span>)</span><br><span class="line">      .get(<span class="string">"/computers?p=4"</span>))</span><br><span class="line">    .pause(<span class="number">5</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_9"</span>)</span><br><span class="line">      .get(<span class="string">"/computers/new"</span>))</span><br><span class="line">    .pause(<span class="number">1</span>)</span><br><span class="line">    .exec(http(<span class="string">"request_10"</span>) <span class="comment">// Here's an example of a POST request</span></span><br><span class="line">      .post(<span class="string">"/computers"</span>)</span><br><span class="line">      .headers(headers_10)</span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"name"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"Beautiful Computer"</span><span class="string">""</span>) <span class="comment">// Note the triple double quotes: used in Scala for protecting a whole chain of characters (no need for backslash)</span></span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"introduced"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"2012-05-30"</span><span class="string">""</span>)</span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"discontinued"</span><span class="string">""</span>, <span class="string">""</span><span class="string">""</span><span class="string">""</span>)</span><br><span class="line">      .formParam(<span class="string">""</span><span class="string">"company"</span><span class="string">""</span>, <span class="string">""</span><span class="string">"37"</span><span class="string">""</span>))</span><br><span class="line"></span><br><span class="line">  setUp(scn.inject(atOnceUsers(<span class="number">1</span>)).protocols(httpConf))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个是一个很好的例子，从源码里我们可以轻易知道怎样去测试一个HTTP接口，无论是通过HTTP GET ，还是HTTP POST。  </p><h1 id="进阶使用Gatling"><a href="#进阶使用Gatling" class="headerlink" title="进阶使用Gatling"></a>进阶使用Gatling</h1><p>从官方的文档中，得知Gatling支持读取csv格式的数据，这样进一步的方便我对测试数据的准备，为了测试简单，我采取了HTTP GET的方式。  </p><p>我通过一个csv文件配置测试所需要的的数据：</p><p><img src="/img/2015/gatling4.png" alt="img"></p><p>然后改写测试代码来支持读取csv，这里采取了随即读取的方式：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> httpConf = http</span><br><span class="line">    .baseURL(<span class="string">"http://computer-database.gatling.io"</span>) <span class="comment">// Here is the root for all relative URLs</span></span><br><span class="line"></span><br><span class="line"> ......</span><br><span class="line"></span><br><span class="line"> <span class="keyword">val</span> records = csv(<span class="string">"api_scenario.csv"</span>, rawSplit = <span class="literal">true</span>).random</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> scn = scenario(<span class="string">"API Performance Test"</span>) <span class="comment">// A scenario is a chain of requests and pauses</span></span><br><span class="line">  <span class="comment">// inject project</span></span><br><span class="line">    .feed(records)</span><br><span class="line"></span><br><span class="line">    .exec(http(<span class="string">"$&#123;scenario&#125;"</span>)</span><br><span class="line">    .get(<span class="string">"$&#123;api&#125;"</span>)</span><br><span class="line">    .check(status.is(<span class="number">200</span>))</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">val</span> runUsers = <span class="type">Integer</span>.getInteger(<span class="string">"users"</span>, <span class="number">1</span>)</span><br><span class="line">  setUp(scn.inject(atOnceUsers(runUsers)).protocols(httpConf))</span><br></pre></td></tr></table></figure><p>baseURL(“<a href="http://xxx&quot;)方法决定的测试的URL，" target="_blank" rel="noopener">http://xxx&quot;)方法决定的测试的URL，</a> records定义测试的数据源。<br>通过feed方法读取数据，exe方法执行，get方法采取HTTP GET方式，check方法检查返回结果（HTTP CODE）  </p><p>变量runUsers则是定义一个外部传入的参数，代表测试的并发数。  </p><h1 id="运行Gatling"><a href="#运行Gatling" class="headerlink" title="运行Gatling"></a>运行Gatling</h1><p>一切就绪之后就可以运行测试了，以Intellij为例：<br><img src="/img/2015/gatling5.png" alt="img"></p><pre><code>gatling:execute -Dgatling.simulationClass=computerdatabase.API_Simulation -X -Dusers=10</code></pre><p>gatling:execute 执行测试， 参数-Dgatling.simulationClass指定入口， －X 打开Maven的调试日志，-Dusers用户并发数。</p><p>运行之后日志如下：<br><img src="/img/2015/gatling6.png" alt="img"></p><p>打开结果报表 （../target/gatling/results/api-simulation-xxx/index.html）<br>拉风的报表就出现了！<br><img src="/img/2015/gatling7.png" alt="img"></p><h1 id="CI集成"><a href="#CI集成" class="headerlink" title="CI集成"></a>CI集成</h1><p>由于之前采取了Maven的命令行模式，所以把Gatling集成到Hudson／Jeskin也非常简单。</p><p><img src="/img/2015/gatling8.png" alt="img"></p><h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>通过上面的步骤，一个简单而完整Gatling测试环境就搭建起来。  </p><p>我的结论是， Gatling， 你值得拥有。 ：）</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Speak like TED</title>
      <link href="/2015/08/20/Other-2015-2015-08-20-SpeakLikeTED/"/>
      <url>/2015/08/20/Other-2015-2015-08-20-SpeakLikeTED/</url>
      <content type="html"><![CDATA[<h1 id="像TED一样演讲"><a href="#像TED一样演讲" class="headerlink" title="像TED一样演讲"></a>像TED一样演讲</h1><p><img src="http://img3.douban.com/lpic/s27999310.jpg" alt="img">  </p><p>《像TED一样演讲》是属于提升软技能技巧的书，遵循其中的技巧能让你的演讲别具一格。  </p><pre><code>一个让人难忘的演讲，是有情感的，让你感到新奇和难忘的。</code></pre><p>#情感</p><pre><code>有情感的演讲，是有热情的，融入一个故事里的，又像跟好友交谈一样自然。</code></pre><p>##热情<br>热情将帮助你最大限度地施展自己的才能。  </p><p>有热情的故事是有感染力的，要感染别人，先要感染自己，让自己的心灵歌唱。  </p><p>一切都源自于你的动机，如果你的动机是分享你的热情，那很可能就不会那么紧张。  </p><p>要成就伟业，就需要热爱自己的工作。获得真正的满足感。  </p><p>热情是自我认同的核心，人们无法把他们的追求和他们自身分开，热情是他们存在的核心。  </p><p>演讲越多，脑部结构变化越大，脑部的语言区域也越发达。  </p><p>你的热情可以感染观众和员工，给追随者带来积极的情感体验。<br>热情是一种领袖气质，能够引起观众的共鸣。  </p><p>##故事<br>    故事是有灵魂的数据</p><p>通过故事，能把思想和情感植入观众的大脑，推倒人与人之间的一堵墙。  </p><p>故事能给我一个我想要支持的人物，提高在商场中的竟争力。  </p><p>简单却有效的三类故事：  </p><ul><li>个人故事</li><li>其他人的故事</li><li>产品／品牌的成败的故事</li></ul><p>故事是有说服力的，说服力的三个要素是：  </p><ul><li>喻德</li><li>喻理</li><li>喻情</li></ul><p>##自然<br>    确保非语言表达－－手势、表情和肢体语言，与语言协调</p><h3 id="完善演讲"><a href="#完善演讲" class="headerlink" title="完善演讲"></a>完善演讲</h3><ul><li>征求他人意见</li><li>早期反馈</li><li>练习、练习、还是练习            </li></ul><h3 id="语言表达"><a href="#语言表达" class="headerlink" title="语言表达"></a>语言表达</h3><ul><li>语速<br>（每分钟150～160个单词）</li><li>音量</li><li>声调</li><li>停顿</li></ul><h3 id="肢体语言"><a href="#肢体语言" class="headerlink" title="肢体语言"></a>肢体语言</h3><pre><code>像领导者一样讲话、走路和着装</code></pre><h4 id="手势能让有力的观点更加有力"><a href="#手势能让有力的观点更加有力" class="headerlink" title="手势能让有力的观点更加有力"></a>手势能让有力的观点更加有力</h4><p>关键时刻使用，上不高眼睛、下不低肚脐 、 左右不超过双臂伸展、后不过眼睛。</p><h3 id="纠正小动作"><a href="#纠正小动作" class="headerlink" title="纠正小动作"></a>纠正小动作</h3><p>纠正某些烦人的小动作如：坐立不安，原地不动，手插口袋等。<br>有目的地做动作，不要一直站在观众面前。<br>不要手插口袋，把手拿出来做手势，假装自信直到自信满满。  </p><p>#新奇</p><h2 id="新视角"><a href="#新视角" class="headerlink" title="新视角"></a>新视角</h2><h3 id="大脑喜欢新奇"><a href="#大脑喜欢新奇" class="headerlink" title="大脑喜欢新奇"></a>大脑喜欢新奇</h3><p><em>给人们一个看世界的新视角</em></p><p>人是天生的探险,我们都是探险“瘾君子”。<br>换个视角看世界,探索你未知的领域  </p><p>学习是一种快乐，快乐的时候大脑会产生多巴胺。多巴胺能够帮助记忆，是大脑中天然的“保存按钮”。  </p><h2 id="惊奇"><a href="#惊奇" class="headerlink" title="惊奇"></a>惊奇</h2><h3 id="别用你惯用的手段糊弄群众"><a href="#别用你惯用的手段糊弄群众" class="headerlink" title="别用你惯用的手段糊弄群众"></a>别用你惯用的手段糊弄群众</h3><p>设计让观众惊掉下巴的环节，调动多种感官——视觉、触觉、感觉来讲故事。<br>抽象的信息需要具体的解释，如果观众无法理解你的信息，你就无法让他们“惊掉下巴”。  </p><h2 id="幽默"><a href="#幽默" class="headerlink" title="幽默"></a>幽默</h2><p>别把自己看得太严肃。大脑喜欢幽默，你可以说下让群众发笑的话。但前提是你必须学会创造性，自然地把幽默融入你的演讲。  </p><p>幽默是一种“取悦策略”，让人更容易被接纳。  </p><p><em>5种制造幽默的方式</em>：</p><ul><li>趣闻、见解和个人故事</li><li>类比和比喻</li><li>引用</li><li>视频</li><li>照片</li></ul><p>#难忘<br>    你必须勇敢地表达自己的直觉和思想，不然那些本可以让人铭记的东西也会消失不见。</p><h2 id="时间规则"><a href="#时间规则" class="headerlink" title="时间规则"></a>时间规则</h2><p>演讲时间越长，听众越焦虑。<br>思考是个苦差事，听是一项让人疲惫不堪的活动。  </p><p>听者会不断给大脑添加需要记忆和提取的信息，这就是“认知积压”。  </p><p>一个乏味且漫长的演讲让听众的大脑不断地消耗能量，即大脑内大量的葡萄糖，<br>而时长18分钟的演讲不会。  </p><pre><code>有约束才能激发创造力</code></pre><p>对一个复杂的问题，如果演讲者能给出简单的解释，观众就会相信他精通这一学科。</p><pre><code>如果你不能用简单的话把问题解释清楚，说明你还没有真正理解这个问题。 ——爱因斯坦</code></pre><p>###“三”的法则</p><pre><code>简单是终极的复杂，事不过三。</code></pre><p>人脑的短时记忆或工作记忆只能同时记住三个信息片段。</p><h2 id="多感官体验"><a href="#多感官体验" class="headerlink" title="多感官体验"></a>多感官体验</h2><pre><code>解释某个想法时，图文并茂好过单纯的文字。</code></pre><p>抓住观众吸引力的魔法是： 多感官体验  </p><p>优秀的演讲通常以调动观众的某一个感官为主，同时也会刺激观众的至少一种其他感官：视觉、听觉、触觉、嗅觉和味觉。</p><ul><li>视觉技巧： 多图，少字</li><li>听觉技巧： 用语言绘制一幅画</li><li>触觉技巧： 让观众“感同身受”</li></ul><h2 id="真实"><a href="#真实" class="headerlink" title="真实"></a>真实</h2><pre><code>表现最真实的自己</code></pre><p><img src="/img/2015/SpeakLikeTED.png" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>The Art of Unit Testing</title>
      <link href="/2015/08/03/Art-2015-2015-08-03-TheArtOfUnitTesting/"/>
      <url>/2015/08/03/Art-2015-2015-08-03-TheArtOfUnitTesting/</url>
      <content type="html"><![CDATA[<h1 id="单元测试的艺术"><a href="#单元测试的艺术" class="headerlink" title="单元测试的艺术"></a>单元测试的艺术</h1><p><img src="http://img3.douban.com/lpic/s27346585.jpg" alt="img">  </p><pre><code>所有程序员都知道应该做单元测试！</code></pre><p>然而很多人却没有做，原因是各式各样的。<br>就如Uncle Bob之前提到过的 <a href="http://antinomy.github.io/art/2014/10/14/TheLittleMocker.html" target="_blank" rel="noopener">The Little Mocker</a> 中介绍Mock和Stub的关系一样, 这本书对一些容易混淆的概念作出了解释，也解释了实现的单元测试的难度和好处。</p><h1 id="优秀单元测试的特质"><a href="#优秀单元测试的特质" class="headerlink" title="优秀单元测试的特质"></a>优秀单元测试的特质</h1><ul><li>自动化的代码</li><li>用自动化测试框架编写</li><li>容易编写</li><li>运行快速</li><li>能由开发团队里的任何人重复运行</li></ul><h2 id="三大支柱"><a href="#三大支柱" class="headerlink" title="三大支柱"></a>三大支柱</h2><ul><li>可读性</li><li>可维护性</li><li>可靠性</li></ul><p>用TDD的开发方式比较容易实现优秀的单元测试。  </p><h1 id="测试命名的规范"><a href="#测试命名的规范" class="headerlink" title="测试命名的规范"></a>测试命名的规范</h1><pre><code>[UnitOfWork]_[Scenario]_[ExpectedBehavior]</code></pre><p>尽量不用［Setup］/ @Before 和 ［Teardown］/ @After ,用工厂方法代替。</p><h1 id="用存根（Stub）破除依赖"><a href="#用存根（Stub）破除依赖" class="headerlink" title="用存根（Stub）破除依赖"></a>用存根（Stub）破除依赖</h1><p>找到或者创造合适的中间层，在运行代码中注入存根。</p><h1 id="存根（Stub）-vs-模拟对象（Mock）"><a href="#存根（Stub）-vs-模拟对象（Mock）" class="headerlink" title="存根（Stub） vs 模拟对象（Mock）"></a>存根（Stub） vs 模拟对象（Mock）</h1><p>存根不会让测试失败，不会在里面写断言，仅仅用来模拟各种场景。  </p><p>模拟对象类似存根，但它能进行断言。 一个测试不能有多个模拟对象，它之外的伪对象都应该是存根。</p><h1 id="隔离框架"><a href="#隔离框架" class="headerlink" title="隔离框架"></a>隔离框架</h1><p>隔离框架很酷，关键在于如何自如地使用它们。  </p><p>如果超过5%的测试使用模拟对象（而非存根），那就可能“过度指定”了，会导致代码既不可读，又容易失败。   </p><p>隔离框架分2种：</p><ul><li>受限</li><li>不受限</li></ul><p>选择框架时要理解一个框架的能力和局限，大多数的受限框架在运行时生成和编译代码。</p><h1 id="测试层次和组织"><a href="#测试层次和组织" class="headerlink" title="测试层次和组织"></a>测试层次和组织</h1><ul><li>无论何种测试，都应该自动化</li><li>把集成测试和单元测试分开<br>（慢和快测试分开，创造绿色安全区）</li><li>按项目和类型组织测试</li><li>使用测试类层次</li><li>把API介绍给队友</li></ul><h1 id="在组织中引入单元测试"><a href="#在组织中引入单元测试" class="headerlink" title="在组织中引入单元测试"></a>在组织中引入单元测试</h1><p>不要疏远可能帮助自己的人，准备好进行一场艰难的战斗： 理解影响力的力量。</p><h1 id="遗留代码"><a href="#遗留代码" class="headerlink" title="遗留代码"></a>遗留代码</h1><p>要了解各个组件的依赖数、逻辑量以及在项目中的优先级，从简单的开始。  </p><p>处理遗留代码的时候，带上一瓶好伏特加也是个不错的主意。 （=_=）  </p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Cucumber-BDD</title>
      <link href="/2015/07/15/Tech-2015-2015-07-15-Cucumber-BDD/"/>
      <url>/2015/07/15/Tech-2015-2015-07-15-Cucumber-BDD/</url>
      <content type="html"><![CDATA[<h1 id="Cucumber-行为驱动指南"><a href="#Cucumber-行为驱动指南" class="headerlink" title="Cucumber : 行为驱动指南"></a>Cucumber : 行为驱动指南</h1><p><img src="http://img3.douban.com/lpic/s26814749.jpg" alt="img"></p><h1 id="为什么要用Cucumber？"><a href="#为什么要用Cucumber？" class="headerlink" title="为什么要用Cucumber？"></a>为什么要用Cucumber？</h1><p>Cucumber是一个实现BDD（行为驱动指南）的工具，为什么要使用它呢？  </p><p>软件始于一个想法。  </p><p>但是，如果一个开发人员误解的一个想法，然后花了2周的一次迭代实现了它，那么他不仅仅浪费了2周的时间，还引入一些误解最初想法的概念和功能，破坏了代码的完整性。  </p><p>这就是cucumber要解决的问题，作为一种过滤器，过滤那些被误解的想法。  </p><h2 id="自动化验收测试"><a href="#自动化验收测试" class="headerlink" title="自动化验收测试"></a>自动化验收测试</h2><p>单元测试确保你正确地编写软件，验收测试确保你编写正确地软件。</p><h2 id="通用语言"><a href="#通用语言" class="headerlink" title="通用语言"></a>通用语言</h2><p>Cucumber为存在语言分歧的双方，提供可以发现和使用通用语言的场所。</p><h2 id="活的文档"><a href="#活的文档" class="headerlink" title="活的文档"></a>活的文档</h2><p>用Cucumber编写的文档，是可执行的规格说明（executable specification），</p><p><em>Overview</em><br><img src="/img/2015/cucumber-overview.png" alt="img">  </p><h1 id="Gherkin基础"><a href="#Gherkin基础" class="headerlink" title="Gherkin基础"></a>Gherkin基础</h1><p><img src="/img/2015/cucumber-feature.png" alt="img">  </p><p>Gherkin是一种DSL，是可执行的规格说明。它以.feature为后缀名，以简单文本格式保存。</p><h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><ul><li>Feature</li><li>Background</li><li>Scenario</li><li>Scenario outline</li><li>Scenarios (or examples)</li><li>Given</li><li>When</li><li>Then</li><li>And (or But)</li><li>| (用来定义表格)</li><li>“”” (定义多行字符串)</li><li><h1 id="注释"><a href="#注释" class="headerlink" title="(注释)"></a>(注释)</h1></li></ul><h2 id="模拟运行"><a href="#模拟运行" class="headerlink" title="模拟运行"></a>模拟运行</h2><pre><code>$ cucumber test.feature --dry-run</code></pre><p>解析不执行</p><h2 id="Feature"><a href="#Feature" class="headerlink" title="Feature"></a>Feature</h2><p>每一个Gherkin文件都以Feature关键字开头。<br>它只是提供一个地方，放置与测试相关的摘要文档。  </p><p>合法的Gherkin必须包含以下其中一个元素：  </p><ul><li>Scenario </li><li>Background</li><li>Scenario outline</li></ul><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>场景是特定情形下有关系统行为的具体实例，所有的场景会和起来就是这个特性期望的行为。</p><h3 id="无状态"><a href="#无状态" class="headerlink" title="无状态"></a>无状态</h3><pre><code>每个场景都必须有独立的意义，且能够不依赖其他场景独立运行。</code></pre><h3 id="多语言支持"><a href="#多语言支持" class="headerlink" title="多语言支持"></a>多语言支持</h3><p>Cucumber支持多国语言来编写 , 以下目录显示所有支持的语言  </p><pre><code>$ cucumber --i18n help</code></pre><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><p>场景中的每一行都是一个步骤</p><h3 id="Given、When、Then"><a href="#Given、When、Then" class="headerlink" title="Given、When、Then"></a>Given、When、Then</h3><p>Given 用来建立场景发生的上下文<br>When 以某种方式与系统交互<br>Then 检查交互的结果是否符合预期  </p><h3 id="And、But"><a href="#And、But" class="headerlink" title="And、But"></a>And、But</h3><p>使用And／But 可以为Given、When、Then增加更多的步骤。</p><h3 id="星号（＊）"><a href="#星号（＊）" class="headerlink" title="星号（＊）"></a>星号（＊）</h3><p>不想用Given、When、Then的时候，每一行都是＊开始就行。</p><h3 id="注释（＃）"><a href="#注释（＃）" class="headerlink" title="注释（＃）"></a>注释（＃）</h3><pre><code>#comment sth</code></pre><h1 id="步骤定义"><a href="#步骤定义" class="headerlink" title="步骤定义"></a>步骤定义</h1><p><img src="/img/2015/cucumber-step.png" alt="img">  </p><p>步骤定义在业务领域和编程领域的边界上。  </p><h2 id="两面"><a href="#两面" class="headerlink" title="两面"></a>两面</h2><p>对外把普通语言翻译成程序，对内使用自动化代码告诉系统做什么。</p><h2 id="步骤与步骤定义"><a href="#步骤与步骤定义" class="headerlink" title="步骤与步骤定义"></a>步骤与步骤定义</h2><p>步骤只是用普通语言编写的文档，步骤定义赋予其生命。</p><h2 id="匹配步骤"><a href="#匹配步骤" class="headerlink" title="匹配步骤"></a>匹配步骤</h2><p>Cucumber扫描每个步骤的文本，通过<em>正则表达式</em>来寻找对应的步骤定义。</p><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Feature</span>: 网页搜索</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: 在百度里搜索谷歌</span><br><span class="line">    <span class="keyword">Given</span> 打开浏览器到baidu.com</span><br><span class="line">    <span class="keyword">And</span> 输入 <span class="string">"google"</span></span><br><span class="line">    <span class="keyword">When</span> 点击百度一下</span><br><span class="line">    <span class="keyword">Then</span> 见到搜索结果</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/6/10.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cucumber.api.CucumberOptions;</span><br><span class="line"><span class="keyword">import</span> cucumber.api.java.en.*;</span><br><span class="line"><span class="keyword">import</span> cucumber.api.junit.Cucumber;</span><br><span class="line"><span class="keyword">import</span> domian.driver.Brower;</span><br><span class="line"><span class="keyword">import</span> domian.lifeCycle.PageConfRepository;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.openqa.selenium.By;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.MatcherAssert.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.core.Is.is;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith</span>(Cucumber.class)</span><br><span class="line"><span class="meta">@CucumberOptions</span>(plugin = &#123;<span class="string">"pretty"</span>, <span class="string">"html:target/cucumber"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaiduExample_Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Brower brower;</span><br><span class="line">    <span class="keyword">private</span> PageConfRepository page;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = Logger.getLogger(Brower.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaiduExample_Test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        page = <span class="keyword">new</span> PageConfRepository(<span class="string">"baiduExample.yaml"</span>);</span><br><span class="line"></span><br><span class="line">        brower = Brower.getInstance();</span><br><span class="line">        brower.open();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Given</span>(<span class="string">"打开浏览器到baidu.com"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go_to_baidu_com</span><span class="params">()</span> <span class="keyword">throws</span> MalformedURLException </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"打开浏览器到baidu.com"</span>);</span><br><span class="line"></span><br><span class="line">        brower.go(page.getConf(<span class="string">"baiduPage"</span>, <span class="string">"url"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@And</span>(<span class="string">"^输入 \"(.*?)\"$"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">input_in_text</span><span class="params">(String keyWord)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"输入 "</span> + keyWord);</span><br><span class="line"></span><br><span class="line">        brower.inputText(page.getId(<span class="string">"baiduPage"</span>, <span class="string">"input_id"</span>), keyWord);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@When</span>(<span class="string">"^点击百度一下$"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">he_click_the_search_buttom</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"点击百度一下"</span>);</span><br><span class="line"></span><br><span class="line">        brower.click(page.getId(<span class="string">"baiduPage"</span>, <span class="string">"searchBtn_id"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Then</span>(<span class="string">"^见到搜索结果$"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">he_should_be_see_search_result</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        logger.debug(<span class="string">"见到搜索结果"</span>);</span><br><span class="line"></span><br><span class="line">        assertThat(brower.getTitle(), is(<span class="string">"google_百度搜索"</span>));</span><br><span class="line">        brower.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@And</span>(<span class="string">"^输入 \"(.*?)\"$"</span>)</span><br></pre></td></tr></table></figure><pre><code>捕获组（A｜B）：  用（）包围的那部分，加上｜可多选分支 点号（.）:  匹配单个任意字符星号（＊）： 任意多次加号（＋）： 至少一次问号（？）： 0或1次字符组：\d 代表数字，［0-9］\w 代表单词字符 ［A－Za－z0-9］\s 代表空白字符 ［\t\r\n］\b 代表单词边界，任何不是单词字符的都是单词边界大写则是代表相反结果，如\D表示任意非数字字符</code></pre><p>非捕获组就是正则表达式之外的那部分。如例子里的“输入”。    </p><h3 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h3><p>步骤 以 ^开头 $结尾 ，保持紧凑。</p><h2 id="Given、When、Then是相等的"><a href="#Given、When、Then是相等的" class="headerlink" title="Given、When、Then是相等的"></a>Given、When、Then是相等的</h2><pre><code>Cucumber在匹配步骤的时候是忽略这几个关键字的。</code></pre><h2 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h2><ul><li>未定义 (undefined)</li><li>待定 (pending)</li><li>失败 (failed)</li><li>通过 (passed)</li></ul><p><img src="/img/2015/cucumber-result.png" alt="img">  </p><h1 id="富有表现力的场景"><a href="#富有表现力的场景" class="headerlink" title="富有表现力的场景"></a>富有表现力的场景</h1><h2 id="背景-（Background）"><a href="#背景-（Background）" class="headerlink" title="背景 （Background）"></a>背景 （Background）</h2><p>背景： 指定一组所有场景的公共步骤，相当于Junit里的@Before</p><ul><li>不设置复杂状态</li><li>保持简短</li><li>鲜明生动</li><li>避免技术细节</li></ul><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Feature</span>: Multiple site support</span><br><span class="line">  As a Mephisto site owner</span><br><span class="line">  I want to host blogs for different people</span><br><span class="line">  In order to make gigantic piles of money</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Background</span>:</span><br><span class="line">    <span class="keyword">Given</span> a global administrator named <span class="string">"Greg"</span></span><br><span class="line">    <span class="keyword">And</span> a blog named <span class="string">"Greg's anti-tax rants"</span></span><br><span class="line">    <span class="keyword">And</span> a customer named <span class="string">"Dr. Bill"</span></span><br><span class="line">    <span class="keyword">And</span> a blog named <span class="string">"Expensive Therapy"</span> owned by <span class="string">"Dr. Bill"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: Dr. Bill posts to his own blog</span><br><span class="line">    <span class="keyword">Given</span> I am logged in as Dr. Bill</span><br><span class="line">    <span class="keyword">When</span> I try to post to <span class="string">"Expensive Therapy"</span></span><br><span class="line">    <span class="keyword">Then</span> I should see <span class="string">"Your article was published."</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: Dr. Bill tries to post to somebody else's blog, and fails</span><br><span class="line">    <span class="keyword">Given</span> I am logged in as Dr. Bill</span><br><span class="line">    <span class="keyword">When</span> I try to post to <span class="string">"Greg's anti-tax rants"</span></span><br><span class="line">    <span class="keyword">Then</span> I should see <span class="string">"Hey! That's not your blog!"</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">Scenario</span>: Greg posts to a client's blog</span><br><span class="line">    <span class="keyword">Given</span> I am logged in as Greg</span><br><span class="line">    <span class="keyword">When</span> I try to post to <span class="string">"Expensive Therapy"</span></span><br><span class="line">    <span class="keyword">Then</span> I should see <span class="string">"Your article was published."</span></span><br></pre></td></tr></table></figure><h2 id="数据表-data-table"><a href="#数据表-data-table" class="headerlink" title="数据表 (data table)"></a>数据表 (data table)</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|<span class="string"> start </span>|<span class="string"> eat </span>|<span class="string"> left </span>|</span><br><span class="line">|<span class="string">  12   </span>|<span class="string">  5  </span>|<span class="string">  7   </span>|</span><br><span class="line">|<span class="string">  20   </span>|<span class="string">  5  </span>|<span class="string">  15  </span>|</span><br></pre></td></tr></table></figure><p>数据表本质上是一个二维数组，是Gherkin的一个重要特性。<br>使用raw()方法可以获取原始格式，使用diff！可以比较数据表。</p><h2 id="场景轮廓-（Scenario-Outline）"><a href="#场景轮廓-（Scenario-Outline）" class="headerlink" title="场景轮廓 （Scenario Outline）"></a>场景轮廓 （Scenario Outline）</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Scenario</span> <span class="keyword">Outline</span>: eating</span><br><span class="line">  <span class="keyword">Given</span> there are <span class="variable">&lt;start&gt;</span> cucumbers</span><br><span class="line">  <span class="keyword">When</span> I eat <span class="variable">&lt;eat&gt;</span> cucumbers</span><br><span class="line">  <span class="keyword">Then</span> I should have <span class="variable">&lt;left&gt;</span> cucumbers</span><br><span class="line"></span><br><span class="line">  <span class="keyword">Examples</span>:</span><br><span class="line">    |<span class="string"> start </span>|<span class="string"> eat </span>|<span class="string"> left </span>|</span><br><span class="line">    |<span class="string">  12   </span>|<span class="string">  5  </span>|<span class="string">  7   </span>|</span><br><span class="line">    |<span class="string">  20   </span>|<span class="string">  5  </span>|<span class="string">  15  </span>|</span><br></pre></td></tr></table></figure><p>场景轮廓用于遵循同样步骤的场景，使用它的前提是要有一个实例表（Examples，可以用Scenarios代替），通过它的占位符是尖括号 (&lt;..&gt;)，<br>将实例表的每一行转换成一个场景再执行。  </p><p>其中一个优点就是：你能够清楚地看到实例中遗漏的东西。<br>通过使用更大的占位符，可以有效地减少重复的内容。<br>但是这一切的底线是不能影响可读性，最终目的是为了能够解释自己。  </p><h2 id="嵌套步骤"><a href="#嵌套步骤" class="headerlink" title="嵌套步骤"></a>嵌套步骤</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">When</span> /^I make all my stuff shiny$/</span><br><span class="line">  step <span class="string">"I polish my first thing"</span></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">When</span> /^I make all my stuff shiny$/</span><br><span class="line">  steps %&#123;</span><br><span class="line">    <span class="keyword">When</span> I polish my first thing</span><br><span class="line">    <span class="keyword">When</span> I shine my second thing</span><br><span class="line">  &#125;</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>通过steps %{}可以把一些步骤归纳成更抽象的步骤，但过度使用就会带来不必要的复杂性。</p><h2 id="文档字符串"><a href="#文档字符串" class="headerlink" title="文档字符串"></a>文档字符串</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""  </span></span><br><span class="line"><span class="string">many word ... together  </span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure><p>1对的三个双引号”””之间，可以把一大堆文本(html/json/*)放置在内。  </p><h2 id="保持条理性"><a href="#保持条理性" class="headerlink" title="保持条理性"></a>保持条理性</h2><p>使用子文件夹和标签可以更有条理的管理特性，标签用@开头，可以通过命令行运行某个子文件夹或标签里的内容。</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@billing</span></span><br><span class="line"><span class="keyword">Feature</span>: Verify billing</span><br><span class="line"></span><br><span class="line">  <span class="meta">@important</span></span><br><span class="line">  <span class="keyword">Scenario</span>: Missing product description</span><br><span class="line"></span><br><span class="line"><span class="keyword">Scenario</span>: Several products</span><br></pre></td></tr></table></figure><h1 id="常见问题及解决之道"><a href="#常见问题及解决之道" class="headerlink" title="常见问题及解决之道"></a>常见问题及解决之道</h1><h2 id="感受痛苦"><a href="#感受痛苦" class="headerlink" title="感受痛苦"></a>感受痛苦</h2><h3 id="闪烁的场景"><a href="#闪烁的场景" class="headerlink" title="闪烁的场景　"></a>闪烁的场景　</h3><pre><code>偶尔失败，随机失败的场景为闪烁的场景。  </code></pre><p>解决它需要研究代码，弄清为什么会发生。<br>通常有以下问题所导致：</p><ul><li>共享的环境</li><li>渗露的场景</li><li>竞争条件和打瞌睡的步骤</li></ul><h3 id="脆弱的特性"><a href="#脆弱的特性" class="headerlink" title="脆弱的特性　"></a>脆弱的特性　</h3><pre><code>脆弱的特性极易被破坏。特性脆弱时，在测试套件或主代码库的某个部分做些必要的修改会破坏明显不相关的场景。</code></pre><p>脆弱的特性通常由以下问题之一所引发。</p><ul><li>固件数据</li><li>重复</li><li>渗露的场景</li><li>被隔离的测试人员</li></ul><h3 id="缓慢的特性"><a href="#缓慢的特性" class="headerlink" title="缓慢的特性"></a>缓慢的特性</h3><p>缓慢的特性通常由下列问题的某种组合引发。</p><ul><li>竞争条件和打瞌睡的步骤</li><li>大量场景              </li><li>大泥球                </li></ul><h3 id="厌倦的利益相关人"><a href="#厌倦的利益相关人" class="headerlink" title="厌倦的利益相关人"></a>厌倦的利益相关人</h3><p>一开始就同业务利益相关人建立正确的协作关系。如果他们觉得自己太忙，没时间帮你准确理解他们想要的东西，那么你面对的是一个更深层的团队问题，Cucumber爱莫能助。</p><p>但另一方面，许多团队开始时倒是有热心主动的利益相关人，可团队却浪费了Cucumber带来的建立这种协作关系的机会。如果测试人员或开发人员独自编写特性，他们就难免使用技术术语，这样利益相关人在阅读的时候会觉得自己被边缘化了。</p><p>这会变成恶性循环：利益相关人本来可以帮助你使用对他们有意义的语言编写特性，但随着兴趣渐失，他们花在这上面的时间会越来越少。不知不觉中，特性就沦为纯粹的测试工具了。</p><p>这一痛苦症状通常由下列问题的某种组合引发。</p><ul><li>偶然细节        </li><li>命令式步骤      </li><li>重复            </li><li>语言不通用      </li><li>闭门造车式的特性</li></ul><h2 id="同心协力"><a href="#同心协力" class="headerlink" title="同心协力"></a>同心协力</h2><p>Cucumber的特性正是Gojko Adzic 所说的活文档（living documentation）。这一术语恰如其分地总结了使用Cucumber的两大好处。</p><p>活的：能自动测试系统，以便你可以安全地工作。</p><p>文档：便于大家有效地沟通系统的当前行为和预期行为。</p><h3 id="偶然细节"><a href="#偶然细节" class="headerlink" title="偶然细节"></a>偶然细节</h3><pre><code>像密码这种在场景中提及但实际上与场景的目标毫无关系的细节，我们称之为偶然细节（incidental detail） 。这种不相关的细节使得场景很难阅读，而这又会让利益相关人对阅读场景失去兴趣。</code></pre><p><em>避免偶然细节</em></p><p>编写场景的时候，尽力避免被已有的步骤定义所左右，只管用直白的语言把你希望发生的事情确切地写下来即可。</p><p>事实上，尽量不要让程序员或测试人员独自编写场景。让非技术的利益相关人或者分析师从纯粹以业务为中心的角度出发编写每个场景的初稿，或者最理想的情况是与程序员结对，从而分享他们的构思模型。</p><p>有了工程意义上设计精良的支持层，你便可以信心百倍地快速编写新的步骤定义来配合场景的表达方式。</p><h3 id="命令式步骤"><a href="#命令式步骤" class="headerlink" title="命令式步骤"></a>命令式步骤</h3><pre><code>命令式编程是指使用一个命令序列，让计算机按特定的次序执行它们。</code></pre><p>Ruby就是命令式语言的例子：你把程序写成一系列的语句，Ruby按顺序每次执行其中的一条语句。</p><pre><code>声明式编程则告诉计算机应该做什么（what），而并不精确指明如何（how）去做。</code></pre><p>CSS就是声明式语言的例子：你告诉计算机希望Web页面上的各种元素如何呈现，剩下的让计算机去处理。</p><p>Gherkin当然是命令式语言。Cucumber按照你编写的顺序依次执行场景中的每个步骤，每次执行一步。但这并不意味着这些指令读起来要像装配组合家具的说明书一样。</p><p>最严重的是，使用这样的泛化步骤定义写出的场景无法创建出场景的领域语言。</p><p>Gherkin特性中在命令式风格和声明式风格之间并没有明确的界线。</p><p>相反，这是一个连续的频谱，每个场景中每个步骤在频谱上的正确位置取决于许多方面：你所描述的系统领域，你所构建的应用类型，程序员的领域知识，以及非技术利益相关人对程序员的信任水平。</p><p>如果利益相关人希望在特性中看到许多细节，这或许表明你需要努力改善这一信任，但也可能说明你们开发的系统就是需要详述很多细 节的。</p><h3 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h3><pre><code>DRY原则 （Don&apos;t Repeat Yourself）指出，任何概念的定义应当在代码中出现且仅出现一次。</code></pre><p>这是一个了不起的目标，因为你如果必须对系统的行为做出修改，肯定希望只在一个地方修改，同时又对改动很有信心，相信它会一致地应用于整个代码库。如果那种行为散落在代码的多处定义中，不但你自己无法全部找到它们，很可能在你之前因为别人也不能全部找到，结果那些定义已经彼此不一致了，谁愿意这样呢？</p><p>然而，在你用实例驱动代码的时候，我相信有另外一个原则优于DRY：实例应当讲出一个好故事。实例是给未来的程序员（包括你自己，如果在3个月以后你会回来修改这段代码的话，那时你已经忘记它做的是什么了）提供指导的文档叙述。</p><p>假设你读这样一本书：里面所有的情节和人物都按照DRY原则给抽干了，一切只出现在脚注或附录中。所有的人物描述、情节元素、潜台词等都被仔细抽取出来，做成交叉引用的章节。如果你是在读百科全书，这非常好，但如果你想投入到故事流中，弄清楚发生的事情，这样就不太合适了。你会在书中无休止地来回翻阅，而且很快会忘记故事看到哪儿了。借用一个古老的玩笑，字典里面密密麻麻全是情节，但在”情节”的行进中，它们至少解释了所有的单词。</p><pre><code>有些人把这称为DAMP（Descriptive and Meaningful Phrases）原则：描述性且有意义的叙述。编写实例的时候，可读性压倒一切，于是DAMP高于DRY。</code></pre><h3 id="语言不通用"><a href="#语言不通用" class="headerlink" title="语言不通用"></a>语言不通用</h3><p>我们讨论的是开发一种通用语言，因为这是一个持续进行的过程。这一开发过程需要我们工作上的投入。真正做到彼此倾听并且就使用的词语达成一致是需要努力的，而坚持这种约定也是需要纪律的。</p><p>然而，回报是巨大的。使用通用语言的团队犯错更少，且更能享受工作的乐趣，因为他们能有效地沟通工作内容。</p><p>不重视通用语言价值的团队将会粗枝大叶地使用场景中的语汇，从而丧失在团队中专注技术和专注业务的双方之间构筑坚固桥梁的宝贵机会。那时，如果你试图纠正别人或澄清术语，带给人的感觉只会是吹毛求疵。</p><h3 id="闭门造车式的特性"><a href="#闭门造车式的特性" class="headerlink" title="闭门造车式的特性"></a>闭门造车式的特性</h3><p>人们会觉得Cucumber是一种技术性较强的工具。它从命令行运行，特性文件也被设计成需要与被测代码一道签入版本控制系统。然而它却以帮助提高团队的业务利益相关人对开发过程的控制感为目标。当测试和开发尽情把特性塞入版本控制的时候，团队中其他人会觉得他们的文档被锁进了柜子，而他们却没有钥匙。</p><p>你只需要坚持做到同业务利益相关人一起坐下来协作编写场景，就足以收获Cucumber至少一半的好处。这一过程所激发的交谈会解开太多太多的潜在bug或时间延误，即便你从不打算将特性自动化，也已经收获颇丰了。</p><h2 id="照管好你的测试"><a href="#照管好你的测试" class="headerlink" title="照管好你的测试"></a>照管好你的测试</h2><p>自动化特性的好处在于你可以把它们作为活文档来长期信赖，因为你会将每一个场景都用于检查产品代码，以确保它们仍然有效。</p><p>对于同代码打交道的程序员来说，这还有另一件好处：在他们开发系统的时候，那些测试可以充当安全网，对任何破坏已有行为的错误都给出警告。</p><h3 id="渗露的场景"><a href="#渗露的场景" class="headerlink" title="渗露的场景"></a>渗露的场景</h3><pre><code>Cucumber场景本质来说是状态转换，如果2个测试之间存在状态依赖，那就发生了渗露（leak）</code></pre><p>每个场景都是独立的，可以确保场景将系统置于干净的状态，然后再添加自己的数据。</p><h3 id="竞争条件和打瞌睡的步骤"><a href="#竞争条件和打瞌睡的步骤" class="headerlink" title="竞争条件和打瞌睡的步骤"></a>竞争条件和打瞌睡的步骤</h3><p>端对端的测试里，终究会遇到竞争条件和沉睡的步骤的问题。</p><p>一种粗糙的解决方法就是引进固定时长地停顿或睡眠。</p><p>如果一定要作出选择，我们宁可要缓慢但可靠的测试，也不要更快但不可靠的测试。</p><p>但如果熟知系统工作原理，就可以利用系统隐含的线索让测试知道何时能够安全地前进。</p><h3 id="共享的环境"><a href="#共享的环境" class="headerlink" title="共享的环境"></a>共享的环境</h3><p>对单一环境的共享使用会对数据库这种紧张地资源造成沉重且不稳定的负荷，从而造就不可靠的测试。</p><p>解决之道在于“一键式搭建系统”</p><h3 id="被隔离的测试人员"><a href="#被隔离的测试人员" class="headerlink" title="被隔离的测试人员"></a>被隔离的测试人员</h3><p>测试人员不应该被看作二等公民，应该与开发人员结对，创造结构更清晰，更稳健的测试套件。</p><p>这样测试人员就可以解放自己，去做更有趣、更有创造性的探索性测试。（exploratory testing）</p><h3 id="固件数据-（fixture-data）"><a href="#固件数据-（fixture-data）" class="headerlink" title="固件数据 （fixture data）"></a>固件数据 （fixture data）</h3><p>固件数据，即使开始时相对精简，时间长了体积也会只增不减。随着越来越多的场景开始依赖这些数据，且每个场景都要对它们做一点特别的处理，固件数据的体积会越来越大，复杂度也会越来越高。</p><p>当你为了某个场景对数据做点改动，结果却使其他场景失败时，你将开始感受到脆弱的特性的痛苦。</p><p>有这么多不同的场景依赖于固件数据，你会倾向于糊上更多的数据，因为这比修改已有的数据更加安全。某个场景失败时，你很难清楚系统中的哪一团数据可能跟失败相关，诊断起来也更加困难。</p><p>我们认为固件数据是一种反模式（antipattern）。</p><p>我们更倾向于使用之前介绍过的测试数据构造器，比如FactoryGirl ，那样可以让测试本身从内部创建相关数据，而不是让这些数据淹没在一大团混乱的固件数据集合中。</p><h3 id="大量场景"><a href="#大量场景" class="headerlink" title="大量场景"></a>大量场景</h3><p>数量巨大的特性很难组织得井井有条，可通过子文件夹和标签来合理组织。</p><p>另外一种方法就是考虑下移一些到单元测试里。</p><h3 id="大泥球"><a href="#大泥球" class="headerlink" title="大泥球"></a>大泥球</h3><p>软件架构一团糟得情况叫做大泥球（Big Ball of Mud）。</p><p>Alistair Cockurn的<a href="http://antinomy.github.io/art/2014/11/20/HexArchitecture.html" target="_blank" rel="noopener">端口和适配器（port and adapter）</a>架构是一种让系统容易测试的架构，建议使用.</p><h1 id="勾勒出领域模型"><a href="#勾勒出领域模型" class="headerlink" title="勾勒出领域模型"></a>勾勒出领域模型</h1><pre><code>任何面向对象程序的核心都是领域模型。</code></pre><p>基于领域模型工作，而不是用户界面上的各种花样。</p><p>一旦有了能够反映我们对系统理解的领域模型，给它包上漂亮的外衣是很容易的事情。</p><h2 id="准确用词"><a href="#准确用词" class="headerlink" title="准确用词"></a>准确用词</h2><h2 id="实话实说"><a href="#实话实说" class="headerlink" title="实话实说"></a>实话实说</h2><h2 id="做最简单的事情"><a href="#做最简单的事情" class="headerlink" title="做最简单的事情"></a>做最简单的事情</h2>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Richardson Maturity Model</title>
      <link href="/2015/07/03/Art-2015-2015-07-03-RichardsonMaturityModel/"/>
      <url>/2015/07/03/Art-2015-2015-07-03-RichardsonMaturityModel/</url>
      <content type="html"><![CDATA[<h1 id="Richardson-Restful成熟度模型"><a href="#Richardson-Restful成熟度模型" class="headerlink" title="Richardson Restful成熟度模型"></a>Richardson Restful成熟度模型</h1><h1 id="走向荣耀的REST"><a href="#走向荣耀的REST" class="headerlink" title="走向荣耀的REST"></a>走向荣耀的REST</h1><p>Leonard Richardson提出的一个模型，把REST方法的主要元素分解成三步。<br>它们包括：资源，http 动词，超媒体控制。</p><p>作者 : Martin Fowler<br>译者 : A生<br><a href="http://martinfowler.com/articles/richardsonMaturityModel.html#level0" target="_blank" rel="noopener">原文地址</a></p><hr><p>内容  </p><p>[Level 0]<br>[Level 1 - 资源][]<br>[Level 2 - http 动词][]<br>[Level 3 - 超媒体控制][]  </p><hr><p>最近我正在读《 <a href="http://www.amazon.com/gp/product/0596805829?ie=UTF8&amp;tag=martinfowlerc-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=0596805829" target="_blank" rel="noopener">Rest In Practice</a> 》的草稿， 一本我的同事们写的书。<br>他们的目的是解释如何使用Restful web服务来处理许多企业面临着的集成问题。<br>这本书的核心是认为网络是一个存在的、经证实工作得很好的、大规模可伸缩的分布式系统。<br>我们根据这样的想法，可以更容易地构建集成系统。  </p><p><img src="/img/2015/rmm-overview.png" alt="img"><br>Figure 1: Steps toward REST  </p><p>为了更好的解释一个web风格系统的特殊属性，作者们用了一个由Leonard Richardson提出的restful成熟度模型，并在一个QCon talk的时候解释过它。<br>这个模型是很好的方式去思考那些技术，所以我把自己的解释也穿插在内。<br>（这里关于协议的例子只是为了说明问题，我不认为它值得去写代码和测试，所以在细节实现上可能会有些问题。）</p><hr><h1 id="Level-0"><a href="#Level-0" class="headerlink" title="[Level 0]"></a>[Level 0]</h1><p>这个模型的起点是，为了远程调用，使用HTTP来作为一个传输系统，但不使用任何web的机制。<br>基本上你所做的是使用HTTP作为隧道机制为自己的远程交互机制,通常基于<a href="http://www.eaipatterns.com/EncapsulatedSynchronousIntegration.html" target="_blank" rel="noopener">远程过程调用</a>。</p><p><img src="/img/2015/rmm-level0.png" alt="img"><br>Figure 2: An example interaction at Level 0</p><p>让我们假设我要预约我的医生。<br>我的预约软件首先需要知道我的医生什么时候有空，所以它向医院的预约系统请求这些信息。<br>在level 0的情景下，医院将在某个URL开放一个服务端点。<br>然后我向该端点post一个带有我的请求所有细节的文档。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /appointmentService HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">openSlotRequest</span> <span class="attr">date</span> = <span class="string">"2010-01-04"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>服务器会返回一个给我对应信息的文档。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">openSlotList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">doctor</span> <span class="attr">id</span> = <span class="string">"mjones"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">start</span> = <span class="string">"1600"</span> <span class="attr">end</span> = <span class="string">"1650"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">doctor</span> <span class="attr">id</span> = <span class="string">"mjones"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">openSlotList</span>&gt;</span></span><br></pre></td></tr></table></figure><p>我在这里用了XML作为例子，但其内容可以实际上可以是任何格式：JSON、YAML、key－value pairs，或者其他自定义格式。</p><p>我的下一步是进行预约，所以我可以向服务端点再次post一个文档。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /appointmentService HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointmentRequest</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointmentRequest</span>&gt;</span></span><br></pre></td></tr></table></figure><p>顺利的话，我会收到一个告诉我预约成功的回应。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointment</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果出现问题，某人在我之前就预定了，那我会在回答的结构内得到某种错误消息。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointmentRequestFailure</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">reason</span>&gt;</span>Slot not available<span class="tag">&lt;/<span class="name">reason</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointmentRequestFailure</span>&gt;</span></span><br></pre></td></tr></table></figure><p>目前为止，这就是一个直截了当的RPC风格的系统。<br>它很简单，它只是来回抛出普通XML（POX）。<br>同样原理，如果你使用SOAP 或 XML－RPC的话，唯一的不同就是你怎样去封装XML消息。  </p><h1 id="Level-1-资源"><a href="#Level-1-资源" class="headerlink" title="[Level 1 - 资源]"></a>[Level 1 - 资源]</h1><p>向RMM迈向荣耀的第一步是引入资源。</p><p><img src="/img/2015/rmm-level1.png" alt="img"><br>Figure 3: Level 1 adds resources</p><p>所以我们初始的查询里，我们会有给医生的一个资源。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /doctors/mjones HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">openSlotRequest</span> <span class="attr">date</span> = <span class="string">"2010-01-04"</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>答复里携带同样基本的消息，但是每一个时间段都是一个可以独立对应的资源。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">openSlotList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"5678"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1600"</span> <span class="attr">end</span> = <span class="string">"1650"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">openSlotList</span>&gt;</span></span><br></pre></td></tr></table></figure><p>带着特殊资源的预约意味着post着一个特定的时间段。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /slots/1234 HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointmentRequest</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointmentRequest</span>&gt;</span></span><br></pre></td></tr></table></figure><p>一切顺利的话，我会得到一个跟之前相似的回应。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointment</span></span></span><br></pre></td></tr></table></figure><p>现在的区别是任何人需要做关于预约的任何事情，如测试一些预定，<br>他们会先持有预约的资源，那可能是一个URL（e.g. <a href="http://royalhope.nhs.uk/slots/1234/appointment）" target="_blank" rel="noopener">http://royalhope.nhs.uk/slots/1234/appointment）</a>,<br>然后post那个资源。  </p><p>对于像我这样一个（面向）对象佬，这个就像是去定义对象的概念。<br>而不是在以太之间调用函数和传参，我们调用一个为其他信息提供参数的特别的对象。  </p><h1 id="Level-2-http-动词"><a href="#Level-2-http-动词" class="headerlink" title="[Level 2 - http 动词]"></a>[Level 2 - http 动词]</h1><p>我在所有level 0 和 1之间的交互里使用HTTP POST 动词，但是一些人用GETs 来取代或添加。<br>在那些level里，那并没有多少不同，他们都是被用作于允许您通过HTTP交互的隧道传输机制。<br>level 2 比这个更进一步，在HTTP本身的机制里尽可能地使用HTTP动词。</p><p><img src="/img/2015/rmm-level2.png" alt="img"><br>Figure 4: Level 2 addes HTTP verbs  </p><p>为了我们列表中的时间段，这个意味着我们要使用GET。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /doctors/mjones/slots?date=20100104&amp;status=open HTTP/1.1</span><br><span class="line">Host: royalhope.nhs.uk</span><br></pre></td></tr></table></figure><p>答复和之前一样使用POST，</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">openSlotList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"5678"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1600"</span> <span class="attr">end</span> = <span class="string">"1650"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">openSlotList</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在level 2里，像这样在请求中使用GET是至关重要的。<br>HTTP定义GET为一个安全的操作，它不会对任何事物的状态作出重大改变。<br>这样允许我们在任何次数、任何顺序去安全地调用GETs，每次都得到相同的结果。<br>一个重要的结论是：它允许任何参与者在请求的路由里使用缓存，这是一个让web正常发挥它本身特性的关键元素。<br>HTTP包括了很多措施去支持缓存，可以用于任何交互者的沟通里。<br>遵循HTTP的规则，让我们能够去利用这种能力的优点。  </p><p>为了预约，我们需要一个HTTP动词去改变状态，一个Post或PUT。<br>我会使用和之前一样的POST。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /slots/1234 HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointmentRequest</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointmentRequest</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在这里权衡使用POST和PUT超过了我在这要说的范围，也许某天我会为了他们另起一篇文章。<br>但我想指出,一些人错误地把POST/PUT等同于create/update。它们之间的选择是相当不同的。  </p><p>就算我在level 1用于同样的post，那里有另外一个重要的不同之处，在于远程的服务怎样去回应。<br>如果一切顺利，服务应答了一个响应代码201，来表明这个世界上多了一个新的资源。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 201 Created</span><br><span class="line">Location: slots/1234/appointment</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointment</span>&gt;</span></span><br></pre></td></tr></table></figure><p>201的响应包括一个位置属性的URI，所以客户端在未来可以去用GET那个资源的当前状态。<br>这里的响应还包括该资源的展示，去保存当前客户端一个额外的调用。  </p><p>另外一个不同的区别，如果那里出现错误，如某人有预定的那个时间。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 409 Conflict</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">openSlotList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"5678"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1600"</span> <span class="attr">end</span> = <span class="string">"1650"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">openSlotList</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个应答中重要的部分，用一个HTTP的响应代码去识别那里出现了错误。<br>在这种情况下,409似乎是一个不错的选择,表明其他人已经在一个不兼容的方式下去更新资源。<br>而不是使用响应代码200但又包含了错误的响应，在level 2 我们显然使用某种像这样的错误响应。<br>那是由协议设计者来决定使用什么代码，但是一个错误出现时，应该使用一个非2xx的响应代码。<br>Level 2 介绍了使用HTTP动词和HTTP响应代码。  </p><p>在这里有一个矛盾。<br>REST提倡使用所有的HTTP动词。<br>他们也在证明他们的方法：REST是试图学习web的实际成功的一面。<br>但是万维网在实际应用很少使用PUT或DELETE。<br>合理使用PUT和DELETE的情况越来越多，但是web的存在证明并不是其中一个。  </p><p>支持web存在的关键元素，是严格地分离来安全（例如GET）和非安全的操作，一起用状态码来帮助沟通遇到的各种错误。  </p><h1 id="Level-3-超媒体控制"><a href="#Level-3-超媒体控制" class="headerlink" title="[Level 3 - 超媒体控制]"></a>[Level 3 - 超媒体控制]</h1><p>最后的level介绍了一个你经常听到的一个丑陋的缩写：HATEOAS (Hypertext As The Engine Of Application State)。<br>它解决的问题是：如何从一个开放的时间段里，去知道预约应该做些什么？  </p><p><img src="/img/2015/rmm-level3.png" alt="img"><br>Figure 5: Level 3 adds hypermedia controls  </p><p>我们开始同样初始化的GET，跟我们在level 2 发送的一样。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET /doctors/mjones/slots?date=20100104&amp;status=open HTTP/1.1</span><br><span class="line">Host: royalhope.nhs.uk</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">但是应答里多了一个新元素  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">``` xml</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">openSlotList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"/linkrels/slot/book"</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">uri</span> = <span class="string">"/slots/1234"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"5678"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1600"</span> <span class="attr">end</span> = <span class="string">"1650"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"/linkrels/slot/book"</span> </span></span><br><span class="line"><span class="tag">           <span class="attr">uri</span> = <span class="string">"/slots/5678"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">openSlotList</span>&gt;</span></span><br></pre></td></tr></table></figure><p>现在每一个时间段包含了一个URI，告诉我们如何去预约。  </p><p>超媒体控制的关键在于告诉我们，接下来我们能做什么，和我们需要操作的资源的URI。<br>而不是我们必须要知道那里可以post我们的预约请求，超媒体控制的应答里告诉了我们如何去做。  </p><p>POST 会再次复制level 2的</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /slots/1234 HTTP/1.1</span><br><span class="line">[various other headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointmentRequest</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointmentRequest</span>&gt;</span></span><br></pre></td></tr></table></figure><p>然后应答里包括了一系列为了不同事情的下一步的超媒体控制。  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 201 Created</span><br><span class="line">Location: http://royalhope.nhs.uk/slots/1234/appointment</span><br><span class="line">[various headers]</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">appointment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">id</span> = <span class="string">"1234"</span> <span class="attr">doctor</span> = <span class="string">"mjones"</span> <span class="attr">start</span> = <span class="string">"1400"</span> <span class="attr">end</span> = <span class="string">"1450"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">patient</span> <span class="attr">id</span> = <span class="string">"jsmith"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/cancel"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">uri</span> = <span class="string">"/slots/1234/appointment"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/addTest"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">uri</span> = <span class="string">"/slots/1234/appointment/tests"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"self"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">uri</span> = <span class="string">"/slots/1234/appointment"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/changeTime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">uri</span> = <span class="string">"/doctors/mjones/slots?date=20100104@status=open"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"/linkrels/appointment/updateContactInfo"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">uri</span> = <span class="string">"/patients/jsmith/contactInfo"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span> = <span class="string">"/linkrels/help"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">uri</span> = <span class="string">"/help/appointment"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appointment</span>&gt;</span></span><br></pre></td></tr></table></figure><p>超媒体控制一个明显的好处在于：允许服务端在不破坏客户端的情况下，去修改它自己的URI scheme。<br>除了最初的入口点，只要客户端寻找“addTest” 链接URI，服务端团队可以处理所有的URI。   </p><p>一个长远的好处就是它帮助客户端的开发者去探索协议。<br>那个链接给客户端开发者一个接下来可能是什么的提示。<br>它不会给予所有的信息：指向同一个URI，“最近的”和“取消”的控制－－他们需要找出一个是GET和另外一个是DELETE。<br>但至少它给了他们一个起点,去考虑的更多信息，和在协议文档里寻找一个类似的URI。  </p><p>同样地它允许服务端团队通过响应里的新链接去宣传新的功能。<br>如果客户端开发者密切留意那些未知的链接，这些链接可以触发进一步的探索。  </p><p>那里没有绝对的标准关于如何去表示超媒体控制。<br>我在这里所做的是，在一个实践的团队里去使用当前建议的REST，这是遵循ATOM （<a href="http://atompub.org/rfc4287.html" target="_blank" rel="noopener">RFC 4287</a> ）<br>我为了一个目标的URI和一个rel属性，用一个带一个uri属性的 <link> 元素去描述这种关系。<br>一个众所周知的关系(如引用自己本身的元素)是赤裸的,任何特定的服务器是一个完全限定的URI。<br>ATOM说明知名linkrels的定义是：<a href="http://www.iana.org/assignments/link-relations/link-relations.xhtml" target="_blank" rel="noopener">链接关系的注册表</a><br>我所写的这些界限于ATOM所做的，通常被看作是安静的level 3里一个领导者。  </p><hr><p>Levels的定义</p><p>我应该强调RMM,是一个好的方式去思考什么是REST的元素,而不是一个REST本身级别的的定义。<br>Roy Fielding已经清晰地指出 <a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven" target="_blank" rel="noopener">level 3 是REST的一个前置条件</a><br>就像软件里的很多缩写，REST拥有许多的定义，但从Roy Fielding 杜撰了这个缩写开始，他的定义应该比大多数人更有分量。  </p><p>我觉得这个RMM有用的是,它提供了一个很好的方式，一步步去理解restfull思维背后的基本想法。<br>因此我认为这是来帮助我们了解概念的工具，而不是某种评价机制。<br>我不认为我们有足够多的例子，去真正确保restful方式是集成系统的正确方法。<br>在我建议的大多数情况下，我认为这是一个非常有吸引力的方法。  </p><p>和Ian Robinson讨论这个时，他强调当Leonard Richardson首次提出它时，<br>这个模型具有吸引力的地方是，这是常见的设计技术的关系。  </p><pre><code>+ Level 1 处理复杂性的问题通过使用分而治之,把一个大型的服务端点分解成多个资源。+ Level 2 引入一组标准的动词,这样我们可以以同样的方式处理类似的问题,消除了不必要的不确定性。+ Level 3 引入可查找性,提供一种方式让协议更具可读性。</code></pre><p>结果是，一个模型帮助我们去思考我们想要一个怎样的HTTP服务，去提供和设计人们希望与之交互的期望。</p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Test Assert Mock</title>
      <link href="/2015/05/27/Art-2015-2015-05-27-Test-Assert-Mock/"/>
      <url>/2015/05/27/Art-2015-2015-05-27-Test-Assert-Mock/</url>
      <content type="html"><![CDATA[<h1 id="测试-断言-模拟"><a href="#测试-断言-模拟" class="headerlink" title="测试 断言 模拟 "></a>测试 断言 模拟 </h1><p><img src="/img/2015/test-kind.png" alt="img"></p><h1 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h1><p>在很多人眼里，测试是一类东西：交给测试人员做的事情。<br>其实，测试有很多不同的种类（详见上图），不同的测试应用场景也不同。  </p><p>跟开发者密切相关的测试有：  </p><ul><li>提交测试  </li><li>单元测试  </li><li>组件测试  </li><li>集成测试  </li></ul><h2 id="测试是有成本的。"><a href="#测试是有成本的。" class="headerlink" title="测试是有成本的。"></a><em>测试是有成本的。</em></h2><p>编写要成本，运行要成本，维护更需要成本！  </p><p>成本最小的应该是提交测试，顾名思义，提交测试就是提交代码之前必须要运行的测试。<br>如果每次提交都要等个半个小时，那么估计很少人愿意频繁提交代码了。 ：）<br>提交测试的内容应该是单元测试里面比较重要的部分。  </p><h2 id="单元测试，必须要快！"><a href="#单元测试，必须要快！" class="headerlink" title="单元测试，必须要快！"></a><em>单元测试，必须要快！</em></h2><p>如何做到唯快不破？ 答案很简单：  </p><ul><li>No IO  </li><li>No DB  </li><li>No Network  </li></ul><p>业务代码不应该依赖：文件IO操作、DB读写，以及网络层面的外部调用。<br>所以好的设计很重要，把业务代码和IO／DB／Network 分离出来，对设计人员要求是有的。<br>DDD（领域驱动开发）在这方面做了很好的研究，例如Repository模式就很好的隔离业务和DB／IO之间的耦合。  </p><h2 id="DB／IO-／Network-并不是不重要"><a href="#DB／IO-／Network-并不是不重要" class="headerlink" title="DB／IO ／Network 并不是不重要"></a><em>DB／IO ／Network 并不是不重要</em></h2><p>关于它们的测试放在组件测试和集成测试的范畴,而这2个测试成本也越高。<br>DB和IO操作放在组件测试里去做，RPC之类的远程调用则放在集成测试里。  </p><h1 id="Assert"><a href="#Assert" class="headerlink" title="Assert"></a>Assert</h1><h2 id="System-Out-print"><a href="#System-Out-print" class="headerlink" title="System.Out.print()"></a>System.Out.print()</h2><p>在Java的世界里，最简陋的测试莫过于System.Out.print()啦。</p><p>假如我们有一个方法，我们期待它能返回数字5.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> anNum = getSomeNum5();</span><br></pre></td></tr></table></figure><p>如果采用print的方法，那么我们就直接的写下，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.Out.print(anNum);</span><br></pre></td></tr></table></figure><p>然后我们在控制台里看print出的数字，看看是不是5.<br>这样做的缺陷是，必须得人肉验证，你得盯着结果看。  </p><h2 id="Junit"><a href="#Junit" class="headerlink" title="Junit"></a>Junit</h2><p>如果你有用过Junit，那么我们就可以使用更高级点的断言了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> anNum = getSomeNum5();</span><br><span class="line">        assertEquals(<span class="number">5</span>,anNum);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，我们就可以愉快的运行测试了，很多IDE都会把结果用绿色和红色显示出来。  </p><p><img src="/img/2015/test-sample.png" alt="img"></p><p>assertEquals(5,anNum)的意思期待的返回的值是5，实际返回的是getSomeNum5()的结果。<br>我们修改一下getSomeNum5()的“bug”，测试就通过了。  </p><p><img src="/img/2015/test-sample-2.png" alt="img"></p><h2 id="Hamcrest"><a href="#Hamcrest" class="headerlink" title="Hamcrest"></a>Hamcrest</h2><p>那么测试通过了，我们就完事了么？<br>按照TDD的三部曲，红（失败），绿（通过），重构。<br>接下来要做的是重构。为什么要重构？ 因为我们是有追求的人。 ：）  </p><p>好吧，如果你也是一个有追求的人，那么让我们来重构吧。<br>assertEquals这个关键字有一些生硬的感觉，代码可读性上一般般。<br>这个时候，我们该祭出神器<a href="http://hamcrest.org/JavaHamcrest/javadoc/1.3/" target="_blank" rel="noopener">Hamcrest</a>了。</p><blockquote><p>Hamcrest is a library of matchers, which can be combined in to create flexible expressions of intent in tests.</p></blockquote><p>采用Hamcrest重构过的代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> junit.framework.TestCase.assertEquals;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.core.Is.is;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertThat;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> anNum = getSomeNum5();</span><br><span class="line">        assertThat(anNum, is(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>assertThat(anNum, is(5)); 假设anNum is 5， 可读性层面立马上去了。<br>重构完，如何保证之前的修改不容易扯到蛋？<br>当然是之前写的测试啦，用了成本的投资必须要有回报，所以重新跑一下之前的测试就知道重构的质量如何了。  </p><p><img src="/img/2015/test-sample-3.png" alt="img"></p><h1 id="Mock"><a href="#Mock" class="headerlink" title="Mock"></a>Mock</h1><p>以上的例子，只是一个很理想的例子。<br>生活中总有许多不如意的事情，比如，如果getSomeNum5()方法不是本地实现的，而是来自于某个神秘的国度。<br>你甚至不知道它是用什么语言实现的，那么测试的难度也提高了很多。  </p><p>如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Num5 someWhere = <span class="keyword">new</span> SomeWhere();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> anNum = someWhere.getSomeNum5();</span><br><span class="line"></span><br><span class="line">        assertThat(anNum, is(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// interface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Num5</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SomeWhere</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeWhere</span> <span class="keyword">implements</span> <span class="title">Num5</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSomeNum5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果你知道有一个叫Num5的接口，而它的具体实现是有另外一个团队来实现的，不幸的是那个团队还没完成功能。</p><p>难道我们能做的事情只能是等待？？<br><em>NO！</em></p><p>我们已经知道接口了，知道它该有的功能是什么。<br>所以我们可以假扮它了，嘿嘿～  </p><h2 id="Mockito"><a href="#Mockito" class="headerlink" title="Mockito"></a>Mockito</h2><p>这个时候我们该祭出神器 <a href="http://mockito.org/" target="_blank" rel="noopener">Mockito</a>了。  </p><p><img src="/img/2015/test-mockito.png" alt="img"></p><blockquote><p>Tasty mocking framework for unit tests in Java</p></blockquote><p>使用Mockito，你就不需要知道真正的SomeWhere是这么实现的，你只需要假扮它。  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.hamcrest.core.Is.is;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.assertThat;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.mock;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.when;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Antinomy on 15/5/27.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Num5 someWhere = getNum5Mock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> anNum = someWhere.getSomeNum5();</span><br><span class="line"></span><br><span class="line">        assertThat(anNum, is(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Num5 <span class="title">getNum5Mock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Num5 result = mock(Num5.class);</span><br><span class="line"></span><br><span class="line">        when(result.getSomeNum5()).thenReturn(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在以上的这段代码里，我们并不知道Somewhere是怎么实现的， 我们用了一个假扮的result去模拟Num5接口的实现。<br>when(result.getSomeNum5()).thenReturn(5);<br>当call到getSomeNum5()方法时，then Return 5 了。  </p><p>这样，我们就可以在Somewhere团队完成功能之前，模拟返回5，返回不是5的各种情况。<br>事先调试好集成代码，等到他们完工的时候，再切换成真正代码的调用。  </p><p><img src="/img/2015/test-sample-4.png" alt="img"></p><p><em>mock不是上策，它只是对不完美的设计的一种妥协。</em></p><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>好吧，我们成功地把一句print语句，复杂到要用接口，mock等方式来实现。<br>宇宙的熵就是这么来的，哈哈。</p><p><em>写测试的时候需要精心设计测试用例，需要有丰富的想象力，需要有一颗跨界的心。</em></p><h1 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a>Further Reading</h1><p><a href="http://dreamhead.blogbus.com/logs/226738756.html" target="_blank" rel="noopener">你应该更新的Java知识之常用程序库（二）</a></p><p>[Sample Codes][<a href="https://github.com/Antinomy/Antinomy.github.io/tree/master/sampleCodes/testWithMock/]" target="_blank" rel="noopener">https://github.com/Antinomy/Antinomy.github.io/tree/master/sampleCodes/testWithMock/]</a></p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Beck Design Rules</title>
      <link href="/2015/05/17/Art-2015-2015-05-17-BeckDesignRules/"/>
      <url>/2015/05/17/Art-2015-2015-05-17-BeckDesignRules/</url>
      <content type="html"><![CDATA[<h1 id="Beck-Design-Rules-（Beck设计规则-A生译）"><a href="#Beck-Design-Rules-（Beck设计规则-A生译）" class="headerlink" title="Beck Design Rules （Beck设计规则 A生译）"></a>Beck Design Rules （Beck设计规则 A生译）</h1><p><img src="/img/2015/kent.jpg" alt="img"></p><p>Kent Beck developed Extreme Programming, Test Driven Development, and can always be relied on for good Victorian facial hair for his local ballet.</p><p>作者 : Martin Fowler<br>译者 : A生<br><a href="http://martinfowler.com/bliki/BeckDesignRules.html" target="_blank" rel="noopener">原文地址</a></p><p>Kent Beck 归纳出他关于简单设计的四条规则，当他在1990年代发明<a href="http://martinfowler.com/bliki/ExtremeProgramming.html" target="_blank" rel="noopener">极限编程</a>的时候。</p><p>我将它们概括如下：  </p><ul><li>通过测试  </li><li>展现意图  </li><li>没有重复  </li><li>极少的元素  </li></ul><p>规则是按优先级排序的，所以 “通过测试” 比 “展现意图” 有着更高的优先级。  </p><p>最重要的规则就是 “通过测试”。<br>XP（极限编程）是关于测试如何在软件开发中上升为一等活动的革命，<br>所以自然地，它应该在那些规则之中扮演着尤其显要的角色。<br>关键点是无论你在软件中干了什么，主要目的是让它如心中所想那样的工作，测试在哪里就是确保它是那样的发生。  </p><p>“展现意图” 是Kent的方式去说明代码应该容易被理解。<br>沟通是极限编程的核心价值，很多程序员喜欢这样的认为：程序在哪里就是为了被别人去阅读的。<br>Kent解释这个规则的关键是，能够在代码里去表达你的意图，所以你的读者能够理解你当时写下那段代码的目的。  </p><p>“没有重复”可能是那些规则中最有力和微妙的。<br>它在别的地方也叫做 “DRY” or “SPOT” [备注]  的概念,Kent表达它是关于当说起所有的事情时，应该是“一次 只有一次”。<br>许多程序员已经注意到，去除重复是演进好的设计的一种的强力方式。  </p><p>最后一条规则告诉我们，任何不服务前面三条规则的，都应该被移走。<br>当这些规则制定的同时，许多设计上的建议是：为了能够增加对未来需求的灵活性，在一个架构上不断地增加元素。<br>具有讽刺意义的是，所有这些元素带来的额外的复杂性，让系统难于修改，因此在实践中的灵活性就更少了。  </p><p>人们常常会发现 “没有重复”和“展现意图” 之间有一些争议，导致争论的是这2个规则的优先次序。<br>我经常觉得他们之间的顺序并不重要，因为他们彼此在精炼代码的过程中相互依存。<br>诸如通过增加重复的内容来让代码更加清晰，往往是正在准备去掩盖一个问题，当这个问题将被更好的解决的时候。  </p><p><img src="/img/2015/kent-sketch.png" alt="img"></p><p>我喜欢这些规则的是记住它们很简单，遵循这些规则可以改进任何一种我用过的语言或编程的范式。<br>它们是Kent寻找普遍适用的原则的能力的其中一个例子，但足以改变我的行为。  </p><blockquote><p>At the time there was a lot of “design is subjective”, “design is a matter of taste” bullshit going around. I disagreed. There are better and worse designs. These criteria aren’t perfect, but they serve to sort out some of the obvious crap and (importantly) you can evaluate them right now. The real criteria for quality of design, “minimizes cost (including the cost of delay) and maximizes benefit over the lifetime of the software,” can only be evaluated post hoc, and even then any evaluation will be subject to a large bag full of cognitive biases. The four rules are generally predictive.</p></blockquote><blockquote><p>当有很多 “ 设计是主观的 ”,“ 设计是一种品味 ” 废话的时候。<br>我不同意，设计有更好的和更糟糕的。<br>这些标准并不完美,但是它们解决了一些明显的废话，(重要的是)现在你可以评估他们。<br>这四个规则通用地评估：质量设计的真正标准， “ 最小化成本(包括延迟的成本)和最大化效益在软件的生命周期 ” 。<br>而不是那些只能事后评估,甚至任何评估了就将受到一大堆认知偏见的评估。</p></blockquote><blockquote><p>– Kent Beck</p></blockquote><h2 id="Further-Reading"><a href="#Further-Reading" class="headerlink" title="Further Reading"></a>Further Reading</h2><p><a href="http://martinfowler.com/bliki/BeckDesignRules.html" target="_blank" rel="noopener">原文地址</a></p><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>＊DRY stands for Don’t Repeat Yourself, and comes from The Pragmatic Programmer.<br>SPOT stands for Single Point Of Truth.</p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>The Fear of Death</title>
      <link href="/2015/05/01/Tao-2015-2015-05-01-theFearOfDeath/"/>
      <url>/2015/05/01/Tao-2015-2015-05-01-theFearOfDeath/</url>
      <content type="html"><![CDATA[<h1 id="死亡的恐惧"><a href="#死亡的恐惧" class="headerlink" title="死亡的恐惧 "></a>死亡的恐惧 </h1><p><img src="/img/2015/deathFear1.png" alt="img"></p><p>最近有个朋友问我，要如何才能面对死亡的恐惧。  </p><p>好吧，其实这个问题，从我懂事以来就常在思考。<br>当你意识到，人出生的时候就注定了死亡，自己也会死的时候，会不会觉得整个世界都不会好了呢？  </p><pre><code>那么，自古以来，人们都怎么克服对死亡对恐惧，而微笑地活下去地呢？</code></pre><p>我能想到的，无非是以下几种：  </p><p>#遗忘<br>遗忘大概是最多人采取的策略。<br>在日常时候生活里，意识会假装死亡并不存在，从而无惧地生活下去。  </p><p>#宗教<br>如果经历过身边的人的死亡，那么遗忘策略可能就不那么奏效了。<br>这个时候，宗教就出现了。<br>在多数的宗教里，死亡并不是终点，而是试炼的一部分。<br>有些宗教通过复活来解决，有些宗教通过轮回来解决，有些则通过创造来天堂和地狱来分流不同的羔羊。<br>宗教的好处是你可以不用思考，只要怀着虔诚地追寻：  </p><pre><code>一位先知，一个预言，一部经书，一个启示。</code></pre><p>#哲学<br>当然也有一些不相信宗教的人，那么，他们该如何来克服自己对死亡的恐惧呢？<br>答案是构筑一个自己可以信服的理论来接受死亡，我们通常称之为哲学。  </p><pre><code>学哲学就是为了学死。</code></pre><p>我在某本哲学书里看到的，关于哲学和死亡，最为印象深刻的一句话。<br>哲学的流派也分好多，唯心的，唯物的，辩证的，等等，我就不一一介绍了。  </p><p>#忙碌<br>以上几种都算比较积极的方法。<br>接下来就是较为消极的方法了：  </p><p>有些人选择让自己一直处于忙碌的状态，这样就没空去想这个问题。  </p><pre><code>仿佛一只把头埋在沙里的鸵鸟，外面发生的事情，与我无关。  </code></pre><p>#拥抱<br>最为消极的方法，莫过于直接地去拥抱死亡了。<br>无法逃避，无法接受，最终只能选择自杀了。  </p><p>#结论<br>以上的种种胡言，都属于我当下这个时刻的想法。<br>以前我会害怕自己下的结论不够准确，不够全面。<br>现在我就不会了，因为我所说的，我所想的，都是我现有水平的结果。<br>以后肯定会变，随着时间，随着眼界的变化。<br>否定之否定，人才能不断地前进。  </p><p>当然，当我自己面对死亡的时候：</p><pre><code>该崩溃的时候，还是会崩溃。</code></pre>]]></content>
      
      <categories>
          
          <category> Tao </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>IntelliJ Tips</title>
      <link href="/2015/04/17/Tech-2015-2015-04-17-IntelliJTips/"/>
      <url>/2015/04/17/Tech-2015-2015-04-17-IntelliJTips/</url>
      <content type="html"><![CDATA[<h1 id="IntelliJ-Tips"><a href="#IntelliJ-Tips" class="headerlink" title="IntelliJ Tips"></a>IntelliJ Tips</h1><p><img src="/img/2015/IntelliJTips1.png" alt="img"></p><p>从RAD切换到IntelliJ已有一段时间，学习曲线总的来说，还不是很高。<br>直到我从windows换到Mac系统，一些奇怪到问题也出现了。  </p><h1 id="忽然失效的SpringUnitTest"><a href="#忽然失效的SpringUnitTest" class="headerlink" title="忽然失效的SpringUnitTest"></a>忽然失效的SpringUnitTest</h1><p>对我这种不写测试就写不了代码的码农来说，没什么比测试用例突然运行不了更打击人的了。<br>万万没想到，切换到高大上到mbp之后，IntelliJ的SpringUnitTest就跑不起来了。  </p><p>看了一下日志，原因是<em>SpringJUnit4ClassRunner</em>无法读取配置文件的路径。<br>在win系统下Eclipse和IntelliJ工作的正常的代码如下：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;<span class="string">"classpath:applicationContext*.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>经过一系列的排查和祈祷（囧），问题出在mac版的IntelliJ无法通过 通配符 ＊ 去载入所有的配置文件。<br>修改如下：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;</span><br><span class="line">        <span class="string">"classpath:applicationContext.xml"</span>,</span><br><span class="line">        <span class="string">"classpath:applicationContext-IoC.xml"</span>,</span><br><span class="line">        <span class="string">"classpath:applicationContext-persistence.xml"</span>&#125;)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>问题是解决了，具体的因果要深入到IDE的内部工作原理才行了。<br>我最近学会了一件事，不要凡事都非要求个因果。 ：）   </p><h2 id="ps：-最终还是完美解决了这个问题："><a href="#ps：-最终还是完美解决了这个问题：" class="headerlink" title="ps： 最终还是完美解决了这个问题："></a>ps： 最终还是完美解决了这个问题：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@ActiveProfiles</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="meta">@ContextConfiguration</span>(locations = &#123;<span class="string">"classpath*:applicationContext*.xml"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>classpath</em> 后面必须加多个*， 在<br><a href="http://docs.spring.io/spring/docs/4.0.1.RELEASE/spring-framework-reference/htmlsingle/#resources-wildcards-in-path-other-stuff" target="_blank" rel="noopener">Spring 文档</a>有提到，不过win平台没有这个问题。。</p><p>Other notes relating to wildcards</p><p>Please note that “ classpath<em>:” when combined with Ant-style patterns will only work reliably with at least one root directory before the pattern starts, unless the actual target files reside in the file system. This means that a pattern like “ classpath</em>:*.xml” will not retrieve files from the root of jar files but rather only from the root of expanded directories. This originates from a limitation in the JDK’s ClassLoader.getResources() method which only returns file system locations for a passed-in empty string (indicating potential roots to search).</p><p>Ant-style patterns with “ classpath:” resources are not guaranteed to find matching resources if the root package to search is available in multiple class path locations. This is because a resource such as</p><p>com/mycompany/package1/service-context.xml<br>may be in only one location, but when a path such as</p><p>classpath:com/mycompany/*<em>/service-context.xml<br>is used to try to resolve it, the resolver will work off the (first) URL returned by getResource(“com/mycompany”);. If this base package node exists in multiple classloader locations, the actual end resource may not be underneath. Therefore, preferably, use “ classpath</em>:” with the same Ant-style pattern in such a case, which will search all class path locations that contain the root package.</p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Kettle Tips</title>
      <link href="/2015/04/03/Tech-2015-2015-04-03-KettleTips/"/>
      <url>/2015/04/03/Tech-2015-2015-04-03-KettleTips/</url>
      <content type="html"><![CDATA[<h1 id="Kettle-Tips"><a href="#Kettle-Tips" class="headerlink" title="Kettle Tips"></a>Kettle Tips</h1><p><img src="/img/2015/kettle.png" alt="img"></p><p>Kettle作为一个开源的ETL工具，功能也算挺齐全的，当然坑也不会少。：）<br>so A生也小小的分享一下遇到的其中一些坑。</p><h1 id="解决中文乱码问题"><a href="#解决中文乱码问题" class="headerlink" title="解决中文乱码问题"></a>解决中文乱码问题</h1><p>DB 链接处设置：</p><p><img src="/img/2015/KettleTips1.png" alt="img"></p><pre><code>characterEncoding=utf8;characterSetResults=utf8;useUnicode=true去掉简易设置的选项：</code></pre><p><img src="/img/2015/KettleTips2.png" alt="img">    </p><h1 id="更新修改过的表结构"><a href="#更新修改过的表结构" class="headerlink" title="更新修改过的表结构"></a>更新修改过的表结构</h1><p>清除DB的缓存</p><p><img src="/img/2015/KettleTips3.png" alt="img"></p><h1 id="使用变量"><a href="#使用变量" class="headerlink" title="使用变量"></a>使用变量</h1><p>变量名字不能与Job/Trans命令参数同名，否则变量读取会失效。</p><pre><code>变量引用格式 ：    ${param}</code></pre><h1 id="去掉自动增加的小数点"><a href="#去掉自动增加的小数点" class="headerlink" title="去掉自动增加的小数点"></a>去掉自动增加的小数点</h1><p>输入输出字段定义格式</p><p><img src="/img/2015/KettleTips4.png" alt="img"></p><h1 id="Kettel-系统配置文件"><a href="#Kettel-系统配置文件" class="headerlink" title="Kettel 系统配置文件"></a>Kettel 系统配置文件</h1><p>在第一次运行kettle之后，kettle会在%HOME_USER_FOLDER%菜单里面创建一个 .kettle文件夹，  </p><p>windows  <em>C:\Documents and Settings\${your user name}.kettle\kettle.properties</em><br>linux <em>/home/${your user name }/.kettle/kettle.properties</em>  </p><h1 id="命令行运行Job-Trans"><a href="#命令行运行Job-Trans" class="headerlink" title="命令行运行Job/Trans"></a>命令行运行Job/Trans</h1><p><em>Job</em><br>./kitchen.sh -file=? -debug=debug -log=log.log<br><em>Trans</em><br>./pen.sh -file=? -debug=debug -log=log.log  </p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Agile and Lean</title>
      <link href="/2015/01/01/Art-2015-2015-01-01-AgileAndLean/"/>
      <url>/2015/01/01/Art-2015-2015-01-01-AgileAndLean/</url>
      <content type="html"><![CDATA[<h1 id="敏捷与精益"><a href="#敏捷与精益" class="headerlink" title="敏捷与精益"></a>敏捷与精益</h1><p><img src="http://img3.douban.com/spic/s26850464.jpg" alt="img"><br><img src="http://img3.douban.com/spic/s11231840.jpg" alt="img"></p><p>近期读了2本关于敏捷开发的书, 《敏捷开发一千零一夜》和《精益开发实战》.<br>回想起以前读过的所有关于敏捷和精益的书,感触良多。<br>一千零一夜的第六章:”从敏捷到精益” 和第十一章：“敏捷无它，持续改进” 于我的共鸣是最多的。</p><p><img src="/img/2015/DancingWithSoftware.png" alt="img"></p><h1 id="Do-Right-Thing-vs-Do-Thing-Right"><a href="#Do-Right-Thing-vs-Do-Thing-Right" class="headerlink" title="Do Right Thing vs. Do Thing Right"></a>Do Right Thing vs. Do Thing Right</h1><p>如果没有在做：“正确的事情”，越是“正确地做事”，就越是错的多，因为他们浪费就更多。</p><h1 id="只有敏捷是不够的"><a href="#只有敏捷是不够的" class="headerlink" title="只有敏捷是不够的"></a>只有敏捷是不够的</h1><p>敏捷不是银弹，其实这个世界很残酷，并不是掌握了什么就能一帆风顺的。<br>掌握知识是很重要，何时用，怎么用，对于每个人来说都不可能像看着菜谱煮菜那么简单。<br>只有Scrum是不行的，如果只有Scrum。<br>单单靠敏捷是不够的，结合精益能够增加多些成功的机会。  </p><h1 id="TDD的精神"><a href="#TDD的精神" class="headerlink" title="TDD的精神"></a>TDD的精神</h1><p>TDD是XP的基础,也是敏捷的基础,同时TDD的精神也是精益创业的基础.<br>测试驱动,快速得到反馈,迅速做出调整就是TDD的精神.<br>基本步骤:  </p><ol><li>提出需要验证的前提假设  </li><li>建立观测数据指标  </li><li>开发最小可行产品  </li><li>收集数据验证假设  </li></ol><p>我把TDD当做程序员的分水岭,TDD不只是关于测试,更是关于设计.</p><h1 id="道与术"><a href="#道与术" class="headerlink" title="道与术"></a>道与术</h1><p>技术牛人有两种, 精通”道”的与精通”术”的.<br>道是形而上的,是关于抽象的能力.<br>术是形而下的,是关于具象的能力.  </p><p>面向对象设计的能力,TDD的能力都是关于”道”的.<br>熟练掌握各种工具和语言的, 则是”术”上的高人.  </p><p>好的程序员是 “道” “术”双修的. :)</p><h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><pre><code>Uncle Bob大叔 : 架构无非是设计中不可逆的部分.Martin Folwer : 架构师有2种: 传统的架构师,非常厉害的做了很多&quot;大&quot;的设计（架构），他的设计可逆性很差，尽管合情合理。另外一种架构师尽量增强可逆性，哪怕是很大的设计。</code></pre><p>架构师做2件事： 建立架构，消灭架构。<br><em>You are what you do 。</em>  </p><h1 id="裸奔的领域模型"><a href="#裸奔的领域模型" class="headerlink" title="裸奔的领域模型"></a>裸奔的领域模型</h1><pre><code>用户不关心你的“解决方案”，用户关心他们的“问题”。</code></pre><p>领域层封装客户的业务需求,日常业务规则,我们开发软件的目的就是解决他们的需求.<br>UI是可变的,存储逻辑也是可以换掉的,业务逻辑才是我们的核心。<br>所以领域模型必须裸奔，不依赖其它层。<br>通过IOC或者六边形架构可以解决依赖的问题。  </p><h1 id="问题与解决方案-，5个why"><a href="#问题与解决方案-，5个why" class="headerlink" title="问题与解决方案 ，5个why"></a>问题与解决方案 ，5个why</h1><p>很多开发团队非常容易犯的错误，他们激烈的讨论某一个技术问题如何实现，却不知道背后的用户逻辑。  </p><p><em>问题和解决方案是一对多的。</em>  </p><p>不要沉溺于技术问题，要时时记得用户的问题。  </p><p>Scrum里的User Story背后就隐藏这样的智慧：<br>    As a （who），<br>        i want （what），<br>            in orderto （why）</p><p>最后的why就是用于描述用户的问题或者业务需求。</p><h1 id="估算的过程很有帮助，估算的结果往往没有。"><a href="#估算的过程很有帮助，估算的结果往往没有。" class="headerlink" title="估算的过程很有帮助，估算的结果往往没有。"></a>估算的过程很有帮助，估算的结果往往没有。</h1><p>团队估算是为了打破鸿沟，它会把团队成员的假想暴露出来，通过暴露假想来发现更多的问题。  </p><p>觉得浪费时间，让一个人去做这些事情，完成估算，拆好任务，贴在板上，完毕？<br><em>呵呵。</em></p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Hex Architecture</title>
      <link href="/2014/11/20/Art-2014-2014-11-20-HexArchitecture/"/>
      <url>/2014/11/20/Art-2014-2014-11-20-HexArchitecture/</url>
      <content type="html"><![CDATA[<h1 id="六边形架构"><a href="#六边形架构" class="headerlink" title="六边形架构"></a>六边形架构</h1><p><img src="/img/2014/0721-HexagonalArchitecture.jpg" alt="img"><br>第一次看到六边形架构,是从《IDDD》这本书里看到的,当时就觉得这是和DDD相当match的架构.<br>稍微研究了下,发现Alistair Cockburn这篇<a href="http://alistair.cockburn.us/Hexagonal+architecture" target="_blank" rel="noopener">《Hexagonal Architecture》</a><br>详细地介绍什么是六边形架构,按照惯例, A生假假地的翻译了一下.</p><hr><h1 id="六边形架构-1"><a href="#六边形架构-1" class="headerlink" title="六边形架构"></a>六边形架构</h1><p>作者 : Alistair Cockburn<br>译者 : A生  </p><pre><code>创建一个既不需要UI也不需要DB就能工作的应用程序,那样你就能针对它去运行自动化的回归测试,即使DB挂了也能继续工作,不需要任何用户参与,就能和其他应用程序连接起来.</code></pre><p><img src="/img/2014/Hexagonal-1.jpg" alt="img"></p><h1 id="模式-端口与设配器-“对象结构”"><a href="#模式-端口与设配器-“对象结构”" class="headerlink" title="模式: 端口与设配器 (“对象结构”)"></a>模式: 端口与设配器 (“对象结构”)</h1><hr><p><em>别名 : 端口与设配器</em><br><em>别名 : 六边形架构</em>  </p><h2 id="意图"><a href="#意图" class="headerlink" title="意图"></a>意图</h2><p>允许一个应用程序平等地被用户,程序,自动化测试和批处理脚本所驱动,可被单独开发和测试于最终运行时的设备和数据库.  </p><p>从外面世界进来的事件到达某一个端口,一个技术意义上的设配器把它转换成一个过程调用或消息后传入应用程序.应用程序幸福地忽略输入设备的本来面目.当应用程序发送某些东西出去时,它通过某个端口发送至某个设配器,去创建被接收技术方(人工或自动)所需要的适当的信号.应用程序从语义上通过适配器和各处交互,而不需要去知道设配器另一端的本来面目.</p><p><img src="/img/2014/Hexagonal-2.gif" alt="img"></p><h1 id="特性-1"><a href="#特性-1" class="headerlink" title="特性 1"></a>特性 1</h1><h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2><p>这些年来软件应用程序里最大的问题之一,就是把业务逻辑渗透在用户接口的代码里.<br>由此引起的问题有三部分:   </p><ul><li>第一,系统不能被自动化测试套件整洁地测试,因为部分需要被测试的逻辑依赖经常变化的可视化细节,如字段长度和按钮位置等;</li><li>因为同样的原因,它变得不可能从一个人肉使用的系统变成一个批处理的系统;</li><li>还是同样的原因,当系统开始受欢迎的时候,它变得困难或不可能去允许该程序被另外的程序所驱动.  </li></ul><p>在许多组织里重复的,一种尝试了的解决方案,就是创建一个分层的架构.<br>在那个时候去承诺,真心诚意地去承诺,没有业务逻辑会放到新的分层里.<br>但是,当发生了破坏承诺的时候,却没有一种机制能够检测出.<br>组织会发现若干年后,新的分层和业务逻辑混在一起,老问题又再次出现了.  </p><p>现在想象应用程序提供的“每一片”功能，是以API（application programmed interface) 或函数调用的形式出现。<br>在这种情况下，当任何新的代码破坏现有可工作的功能的时候，测试或QA部门可通过运行自动化测试脚本来针对应用程序去发现问题。<br>业务专家可以在GUI细节最终确定之前，创建自动化测试用例，去告诉程序员，什么才是他们的工作正确完成的时候。（那些测试由测试部门来运行）。<br>应用程序可用“headless”模式去部署，所以只有API是有效的，其他的程序可利用它的功能——简化了整个复杂系统套件的设计，同时也许可了每一个Web上无需人介入的“business-to-business”的应用服务。<br>最后，自动化了功能上的回归测试，检测出了任何违背了把业务逻辑放在表现层之外的承诺。组织可以检测和修正逻辑泄露。  </p><p>另外一个类似的有趣问题，什么是被认为是正常的应用程序的“另一边”，那里是应用程序逻辑被绑定在外部的数据库或设备？当数据库服务器停机或进行重大的修订或替换时，程序员就不能继续工作，因为他们的工作绑定在数据库上。这会导致延迟成本和人们会经常感觉到很糟糕。</p><p>以上2个问题看起来不是很明显的相关，但它们在自然的解决方案中却显现出了对称性。</p><h2 id="自然的解决方案"><a href="#自然的解决方案" class="headerlink" title="自然的解决方案"></a>自然的解决方案</h2><p>客户端和服务器端两边的问题都是因为设计和编程上的同一个错误——业务逻辑和与外部实体交互之间的纠缠不清。<br>不对称的探索，不是在应用程序的“左边”和“右边“之间，而是应该在应用程序的”内部“和”外部“之间。这样的规则履行了与”内部“相关的代码不应该泄露到”外部“去。  </p><p>暂时移除任何左右或上下的不对称，我们看到了应用程序通过“端口”与外部代理们沟通。<br>“端口”一词应会引起联想到操作系统层面的端口，任何设备都可以插入使用某种协议的端口那里。同样道理，“端口”在电子产品那，任何设备只要符合规格，都可以插入电子产品里。  </p><pre><code>端口的协议就是为了两个设备之间的会话。  </code></pre><p>这样的协议以API的形式出现。  </p><p>每一个外部设备都有一个“设配器”，把API所定义的信号转换到设备所需要的，反之亦然。<br>一个图形化的用户接口或GUI就是一个设配器的例子，映射了一个人在API端口上的动作。<br>其他的设配器在同一个端口上则是自动化测试的安全带，例如FIT或Fitnesse，批处理驱动器，和任何为了应用程序和整体或网络之间沟通的代码。  </p><p>在应用程序的另一边，应用程序通过与外部实体沟通来获得数据。<br>数据库协议就是一种经典的协议。<br>从应用程序的角度，如果数据库从一个SQL数据库迁移到一个扁平的文件或其他类型的数据库，通过API的转换应该没有改变。<br>在同一个端口上增加的设配器应该包括一个SQL设配器，一个文件设配器。<br>最重要的，一个去连接到“mock”数据库，一个停留在内存里和完全不依赖真正数据库的设配器。  </p><p>许多应用程序只有2个端口：客户端的对话和数据库端的对话。<br>这让他们以不对称的形式出现，从而让看起来像是创建一个一维的，3/4/5层的架构的应用程序。  </p><p>这样的图纸会有2个问题。<br>第一、并且是最坏的情况，人们通常不会认真地对待分层中的“边界线”。他们会让应用程序的逻辑泄露在层级边界之外，导致以上所说的问题。<br>第二、应用程序可能会有超过2个以上的端口，所以架构上并不对应一维的层设计。  </p><p>六边形(或端口与设配器)架构通过在这种情况下注意到对称性来解决了这些问题：<br>一个应用程序在内部，通过某些端口与外界的东西交互。应用程序外面的东西能够尽早地去处理对称性。  </p><p>六边形有意在视觉上突出  </p><p>(a) 内外的对称性和相似自然的端口,摆脱了一维层视图和所有的调用,和<br>(b) 不同端口定义的存在数量——2,3 或4个 (4个是我最常遇到的)</p><p>六边形不是六边的是因为数字6很重要,而是允许人们进行绘制是有空间去放入他们所需要的端口和设配器,不限制于一维层次的绘制。术语“六边形架构”是来自可视化的效果。  </p><p>术语“端口与设配器”拾起了部分绘制的“目的”。端口定义了有目的的会话。通常会有多个设配器对应一个端口，为了多样的技术可插入端口内。 有代表性的，它们可以包括一个电话机器应答，一个人工应答，一个按键式电话，一个图形化人机界面，一个测试装置，一个批处理驱动器，一个http接口，一个程序到程序的接口，一个mock（内存内）数据库，一个真正的数据库（可能有不同的数据库用于开发。测试和实际使用）。  </p><p>在应用程序里，左右不对称将再次带出来，无论如何，这个模式的主要目的是集中于内外不对称，从应用程序的角度，假装短暂地识别所有的外面组件。</p><h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p><img src="/img/2014/Hexagonal-3.gif" alt="img"></p><h1 id="特性-2"><a href="#特性-2" class="headerlink" title="特性 2"></a>特性 2</h1><p>特性2显示了一个应用程序有着2个活动端口和用于同一个端口多个设配器。那2个端口分别是应用程序控制方面和数据检索方面。这样的绘制显示出应用程序可以被平等地驱动于：一个自动化、系统级别的回归测试套件，一个人类用户，一个远程的http应用程序，或者另一个应用程序。在数据方面，应用程序从外部数据库解耦，可以被配置运行在一个内存内的Oracle，或“mock”，数据库替换者；或者它可以运行在针对测试的或运行时的数据库。应用程序功能上的规格，或许在用例内，是针对与六边形内部的接口，而不是针对任何一个外部的技术可能用到的接口。   </p><p><img src="/img/2014/Hexagonal-4.gif" alt="img"></p><h1 id="特性-3"><a href="#特性-3" class="headerlink" title="特性 3"></a>特性 3</h1><p>特性3显示出同一个应用程序对应一个三层架构绘制。每一个端口简化到只有2个适配器。这样的绘制趋势于去显示，多个适配器怎样去适应于顶层和低层，和在开发系统中被用到的，多个适配器之间的序列。编号的箭头显示出一个团队和应用程序可能会用到的次序：</p><ol><li>用于被应用程序驱动的一个FIT测试设备和用着取代真正数据库的mock（内存内）数据库；  </li><li>增加一个GUI到应用程序，仍然跑在mock数据库。  </li><li>在集成测试里，针对于一个真正包含测试数据的数据库，运行自动化测试脚本（如从Cruise Control）去驱动应用程序。  </li><li>真正地去使用，一个人通过应用程序去访问真正的数据库。  </li></ol><h2 id="样例代码"><a href="#样例代码" class="headerlink" title="样例代码"></a>样例代码</h2><p>幸运地可以通过FIT的文档，一个最简化应用程序去演示端口与适配器。它是一个简单的折扣计算的应用程序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">discount(amount) = amount * rate(amount);</span><br></pre></td></tr></table></figure><p>在我们的程序里，amount会来自用户和rate会来自一个数据库，所以那里会有2个端口。<br>我们实现它们在以下步骤：</p><ul><li>测试取代mock数据库的一个固定的rate</li><li>然后是GUI</li><li>然后是一个可被切换到真正数据库的mock数据库</li></ul><p><em>感谢在IHC的Gyan Sharma 提供这个例子的代码。</em></p><h3 id="步骤1：-FIT-App-constant-as-mock-database"><a href="#步骤1：-FIT-App-constant-as-mock-database" class="headerlink" title="步骤1： FIT App constant-as-mock-database"></a>步骤1： FIT App constant-as-mock-database</h3><p>首先我们创建测试用例通过一个HTML table(看FIT文档如下):</p><table><br><tbody><tr><br><td> TestDiscounter </td><td> </td><br></tr><br><tr><br><td> amount  </td><td> discount() </td><br></tr><br><tr><br><td> 100  </td><td> 5 </td><br></tr><br><tr><br><td> 200  </td><td>10 </td><br></tr><br></tbody></table><p>注意列名会变成class和function名字在我们的应用程序里。<br>FIT包括了摆脱这种“programmerese”的道路，但是为了这篇文章会简单地把它们放进来。  </p><p>知道了那些会是测试的数据，我们创建用户边的设配器，来自FIT里的ColumnFixture如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> fit.ColumnFixture; </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDiscounter</span> <span class="keyword">extends</span> <span class="title">ColumnFixture</span> </span></span><br><span class="line"><span class="class"></span>&#123; </span><br><span class="line">   <span class="keyword">private</span> Discounter app = <span class="keyword">new</span> Discounter(); </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">double</span> amount;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">discount</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">   </span>&#123; <span class="keyword">return</span> app.discount(amount); &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实际上那里的所有都是到设配器的，目前为止，测试可从命令行里运行（看FIT的书会有你所需要的路径）。我们使用这个：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set FIT_HOME=<span class="regexp">/FIT/</span>FitLibraryForFit15Feb2005</span><br><span class="line">java -cp %FIT_HOME%<span class="regexp">/lib/</span>javaFit1<span class="number">.1</span>b.jar;%FIT_HOME%<span class="regexp">/dist/</span>fitLibraryForFit.jar;src;bin</span><br><span class="line">fit.FileRunner test/Discounter.html TestDiscount_</span><br></pre></td></tr></table></figure><p>FIT 生产出一个导出的文件，通过颜色告诉我们那些测试通过了（或者失败，唯一我们在过程中从那里打错了）   </p><p>在这个点上的代码已经准备好去check in，集成在Cruise Control或你自己的自动化构建机器里，包括在构建-测试套件里。</p><h3 id="步骤2：-UI-App-constant-as-mock-database"><a href="#步骤2：-UI-App-constant-as-mock-database" class="headerlink" title="步骤2： UI App constant-as-mock-database"></a>步骤2： UI App constant-as-mock-database</h3><p>我会让你去创建属于你自己的UI和让它驱动Discounter应用程序，因为代码放在这里有点过长，某些关键的代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">   ...</span><br><span class="line"> Discounter app = <span class="keyword">new</span> Discounter();</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent event)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">   String amountStr = text1.getText();</span><br><span class="line">   <span class="keyword">double</span> amount = Double.parseDouble(amountStr);</span><br><span class="line">   discount = app.discount(amount));</span><br><span class="line">   text3.setText( <span class="string">""</span> + discount );</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure><p>在这个点上的代码可以去被演示和回归测试。用户端的设配器都已运行中。</p><h3 id="步骤3：-FIT-or-UI-App-mock-database"><a href="#步骤3：-FIT-or-UI-App-mock-database" class="headerlink" title="步骤3：  (FIT or UI) App mock database"></a>步骤3：  (FIT or UI) App mock database</h3><p>去创建一个可替换的数据库端的设配器，我们为一个仓储创建一个“接口”，一个“RepositoryFactory” 会生产出要么模拟数据库、要么真正的服务的对象，在内存里去模拟数据库。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RateRepository</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">double</span> <span class="title">getRate</span><span class="params">(<span class="keyword">double</span> amount)</span></span>;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepositoryFactory</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">RepositoryFactory</span><span class="params">()</span> </span>&#123;  <span class="keyword">super</span>(); &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RateRepository <span class="title">getMockRateRepository</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MockRateRepository();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockRateRepository</span> <span class="keyword">implements</span> <span class="title">RateRepository</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getRate</span><span class="params">(<span class="keyword">double</span> amount)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(amount &lt;= <span class="number">100</span>) <span class="keyword">return</span> <span class="number">0.01</span>;</span><br><span class="line">      <span class="keyword">if</span>(amount &lt;= <span class="number">1000</span>) <span class="keyword">return</span> <span class="number">0.02</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0.05</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>挂钩这个设配器到Discounter应用程序内，我们需要更改下应用程序自身，去接受使用一个repository设配器，和让（FIT / UI）用户端的设配器传入repository去使用（real or mock）到应用程序的构造函数里。<br>这里有已更改的应用程序和一个FIT设配器传入一个模拟的repository。<br>（FIT设配器的代码，选择是否传入到模拟或真实repository的设配器里，在没有增加太多新的信息情况下有点过长，所以我在这里省略的那个版本）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> repository.RepositoryFactory;</span><br><span class="line"><span class="keyword">import</span> repository.RateRepository;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Discounter</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> RateRepository rateRepository;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Discounter</span><span class="params">(RateRepository r)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>();</span><br><span class="line">      rateRepository = r;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">discount</span><span class="params">(<span class="keyword">double</span> amount)</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">double</span> rate = rateRepository.getRate( amount ); </span><br><span class="line">      <span class="keyword">return</span> amount * rate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">import</span> app.Discounter;</span><br><span class="line"><span class="keyword">import</span> fit.ColumnFixture;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDiscounter</span> <span class="keyword">extends</span> <span class="title">ColumnFixture</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Discounter app = </span><br><span class="line">       <span class="keyword">new</span> Discounter(RepositoryFactory.getMockRateRepository());</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">double</span> amount;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">discount</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> app.discount( amount );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>那样就包括了实现六边形架构的最简单的版本。</p><p>另外一个不同的实现，使用Ruby和Rack为了浏览器使用，详情：<br><a href="https://github.com/totheralistair/SmallerWebHexagon" target="_blank" rel="noopener">https://github.com/totheralistair/SmallerWebHexagon</a></p><h2 id="应用程序指南"><a href="#应用程序指南" class="headerlink" title="应用程序指南"></a>应用程序指南</h2><h3 id="左右不对称"><a href="#左右不对称" class="headerlink" title="左右不对称"></a>左右不对称</h3><p>端口和设配器模式是故意把所有的端口都写上去像是从根本上是相似的。那样的假装在架构层面是有用的。<br>在实现阶段，端口和设配器显示出2种风味，我将其称之为“主要的”和“次要的”，理由很快会揭晓。它们可称之为“驱动”设配器和“被驱动”设配器。  </p><p>警觉的读者会注意到所有已给的例子里，FIT fixtures是用了左边端口而mock在右边。<br>在三层的架构里，FIT 坐落在顶层而mock坐落在底层。  </p><p>相关的主意是来自“主角”和“次角”的例子。“主角”是驱动了应用程序（改变静止的状态和执行某个已知的功能）。“次角”是被应用程序所驱动的，无论是从中获取应答还是仅仅是通知。“主角”和“次角”的差别是在于谁触发了或者是负责了会话。  </p><p>FIT是代替主角的自然测试设配器，从框架设计成读取一个脚本和驱动应用程序开始。<br>mock是代替了“次角”的自然测试设配器，从被设计成从应用程序里去应答查询和记录事件开始。  </p><p>这些观察带领我们服从系统的用例上下文图，和在六边形的左边（或顶层）去绘制“主要端口”和“主要适配器”，在六边形的右边（或底层）去绘制“次要端口”和“次要适配器”。  </p><p>主次要端口和设配器之间的关系，和他们在FIT和mock的各自实现，记在脑子里是有用的，但应该是用来作为使用端口和设配器架构的结论，而不是简化之。<br>实现端口和设配器的最终好处从一个完全隔离模式敏捷地去运行应用程序。  </p><h3 id="用例和应用程序边界"><a href="#用例和应用程序边界" class="headerlink" title="用例和应用程序边界"></a>用例和应用程序边界</h3><p>使用六边形架构模式是有用地去加强，编写用例的首选模式。  </p><p>编写用例通常会犯的错误是，在每个端口外面包含了亲密的技术知识。<br>在行业里这种用例获得了众所周知的坏名声，变得冗长，难读，沉闷，易碎，维护昂贵。  </p><p>理解端口和设配器模式，我们可以看到用例一般应该写在应用程序边界内（六边形内部），<br>去指定被应用程序所支持的功能和事件，不去管外部的技术。<br>这样用例是简短，易读，更少维护成本，和在时间上更加稳定。</p><h3 id="多少端口？"><a href="#多少端口？" class="headerlink" title="多少端口？"></a>多少端口？</h3><p>到底什么是或不是端口，很大程度上只是口味的问题。<br>在极端的情况下，每一个用例只有自己的端口，为了许多的应用程序提供了上百个端口。<br>另外的一种选择，可以想象把所有的主要端口和次要端口融合在一起，到那时3只有2个端口，左边的和右边的。  </p><p>没有最好只有更好。   </p><p>已知应用的天气预报系统有着4个自然的端口：天气反馈，管理员，通知用户，用户数据库。<br>咖啡售卖机的有4个自然的端口：用户，包括食谱和价格的数据库，售卖机，和硬币箱子。<br>医院的药物系统可能有3个：一个给护士，一个给药方数据库，一个给控制药物分配器。  </p><p>选择“错误”数量的端口数不见得会有任何特殊的坏处，所以保持一种直觉即可。<br>我倾向于选择少量的数目，2,3或4，如上所述和已知应用。</p><h3 id="已知应用"><a href="#已知应用" class="headerlink" title="已知应用"></a>已知应用</h3><p><img src="/img/2014/Hexagonal-5.gif" alt="img"></p><h1 id="特性-4"><a href="#特性-4" class="headerlink" title="特性 4"></a>特性 4</h1><p>特性展现一个有着4个端口并且每个端口都有多个设配器的应用程序。<br>这是从一个应用程序衍生出的监听来自国家天气服务的警报，关于地震，龙卷风，火灾<br>和水灾。和通知人们通过他们的电话或电话对讲机。<br>在我们讨论这个系统的时候，这个系统的接口已确认，从“技术，连接的目的”上讨论过。那里有一个接口为了接收电线上的触发数据，一个为了把通知数据发送到对答的机器上，一个GUI实现的管理接口，和一个获取用户数据的数据库接口。  </p><p>人们正在努力，因为他们需要从天气服务增加一个http接口，一个email接口给他们的用户，和他们不得不寻找一种方式可以为了不同的客户采购偏好，绑定和解绑他们增长着的应用程序套件。他们害怕停留在一个维护和测试的噩梦里，因为他们不得不实现，测试和维护所有独立的组合和排列的版本。  </p><p>他们修改了设计，在系统接口上根据“目的”而不是根据“技术”去架构，让技术通过设配器变得可以替换（所有方面的）。<br>他们立马提高了速度去包含http订阅和email通知（新的设配器通过虚线绘制出来）。<br>通过APIs让每个应用程序在headless模式下运行，他们可以增加一个 app-to-add 的设配器和解除绑定应用程序套件，按需连接子应用程序。<br>最后，让每一个应用程序可完全独立的执行，通过内置的测试和mock设配器，他们获得了敏捷的通过独立的自动化测试脚本去回归测试他们的应用程序。</p><hr><h1 id="Mac-Windows-Google-Flickr-Web-2-0"><a href="#Mac-Windows-Google-Flickr-Web-2-0" class="headerlink" title="Mac, Windows, Google, Flickr, Web 2.0"></a>Mac, Windows, Google, Flickr, Web 2.0</h1><p>早在1990时，MacIntosh应用程序如文档处理软件就需要有API驱动的接口，所以应用程序和用户编写的脚本就可以访问应用程序的所有的功能。Windows桌面软件有着同样的能力。（我没有对应的历史知识去说谁先出现，反正那也不是重点）  </p><p>如今（2005）web软件的趋势是发布一个公共API去让别的软件直接的访问那些APIs。<br>虽然，那可能会通过google map去发布一些犯罪的数据，或者创建web应用程序包括Flickr在内的相片存档和注释的能力。</p><p>所有的这些例子都是关于把“主要的”端口的API可视化， 我们看不到任何信息在次要端口。</p><h1 id="Stored-Outputs"><a href="#Stored-Outputs" class="headerlink" title="Stored Outputs"></a>Stored Outputs</h1><p>Willem Bogaerts在C2 wiki上写下这个例子：<br>“我遇到过类似的事情，但是主要是因为我的应用程序层有很强的趋势去变成一个电话切换板去管理它不应该去做的事情。我的应用程序产生输出，显示给用户和有可能会去保存好它。我主要的问题是你不需要常常去储存它。所以我的应用程序产生输出，不得不缓存它和展现给用户。然后，当用户决定要保存导出的数据时，应用程序清空缓冲和真正的保存它。  </p><p>我一点都不喜欢这个，于是我想出了一个解决方案：有一个带存储功能的展现控制器。现在应用程序不再需要管道输出到不同的方向，只是简单地输出到展现控制器。展现控制器缓冲了结论和给用户去保存它的可能性。  </p><p>传统的架构分层强调“UI”和“存储”是不同的。<br>端口和设配器模式架构可以再简化输出到简单的“输出”。<br>”</p><h1 id="来自C2-wiki的匿名例子"><a href="#来自C2-wiki的匿名例子" class="headerlink" title="来自C2-wiki的匿名例子"></a>来自C2-wiki的匿名例子</h1><p>“在我做过的一个项目里，我们使用“真音响设备”的系统隐喻。<br>每一个组件定义了接口，每一个接口都有不同的目的。<br>我们几乎可以通过连线和设配器，没有限制的把组件们连接在一起<br>”</p><h1 id="分布式，大团队开发"><a href="#分布式，大团队开发" class="headerlink" title="分布式，大团队开发"></a>分布式，大团队开发</h1><p>这个还在实验阶段的使用和还不能恰当地评估这个模式的使用情况。<br>无论如何，那个很有意思去考虑的。  </p><p>不同位置的团队们全去构建六边形架构，用着FIT和mocks，所以应用程序和组件可以独立模式下去测试。CruiseControl每半个小时去运行构建和使用FIT+mock的组合去运行所有的应用程序。因为应用程序子系统和数据库已完整地，替换成mock和测试数据库了。</p><h1 id="独立的开发UI和应用程序逻辑"><a href="#独立的开发UI和应用程序逻辑" class="headerlink" title="独立的开发UI和应用程序逻辑"></a>独立的开发UI和应用程序逻辑</h1><p>这个还在早期的实验阶段的使用和还不能恰当地评估这个模式的使用情况。<br>无论如何，那个很有意思去考虑的。  </p><p>UI设计是不稳定的，因为它们还未定好是那一种驱动的技术或隐喻。<br>后端服务架构没有定好，事实上它可能在半年内经历过几次改变。<br>尽管如此，项目却是正常地启动和时间是滴答作响的。  </p><p>应用程序团队创建FIT测试和mocks去隔离他们的应用程序，创建可测试的，可演示的功能展示给他们的用户。<br>当UI和后端服务最终决定时，它“一个直接的”增加那些元素到应用程序里。<br>开始学习怎样实现它。（或你自己尝试下和写邮件给我）</p><hr><p>（A生注： 相关模式、感谢和其他引用就不再翻译拉～～ ：） ）</p><hr><h1 id="Related-Patterns"><a href="#Related-Patterns" class="headerlink" title="Related Patterns"></a>Related Patterns</h1><h2 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h2><p>The ‘’Design Patterns’’ book contains a description of the generic ‘’Adapter’’ pattern: “Convert the interface of a class into another interace clients expect.” The ports-and-adapters pattern is a particular use of the ‘’Adapter’’ pattern.</p><h2 id="Model-View-Controller"><a href="#Model-View-Controller" class="headerlink" title="Model-View-Controller"></a>Model-View-Controller</h2><p>The MVC pattern was implemented as early as 1974 in the Smalltalk project. It has been given, over the years, many variations, such as Model-Interactor and Model-View-Presenter. Each of these implements the idea of ports-and-adapters on the primary ports, not the secondary ports.</p><h2 id="Mock-Objects-and-Loopback"><a href="#Mock-Objects-and-Loopback" class="headerlink" title="Mock Objects and Loopback"></a>Mock Objects and Loopback</h2><p>“A mock object is a “double agent” used to test the behaviour of other objects. First, a mock object acts as a faux implementation of an interface or class that mimics the external behaviour of a true implementation. Second, a mock object observes how other objects interact with its methods and compares actual behaviour with preset expectations. When a discrepancy occurs, a mock object can interrupt the test and report the anomaly. If the discrepancy cannot be noted during the test, a verification method called by the tester ensures that all expectations have been met or failures reported.” — From <a href="http://MockObjects.com" target="_blank" rel="noopener">http://MockObjects.com</a></p><p>Fully implemented according to the mock-object agenda, mock objects are used throughout an application, not just at the external interface The primary thrust of the mock object movement is conformance to specified protocol at the individual class and object level. I borrow their word “mock” as the best short description of an in-memory substitute for an external secondary actor.</p><p>The Loopback pattern is an explicit pattern for creating an internal replacement for an external device.</p><h2 id="Pedestals"><a href="#Pedestals" class="headerlink" title="Pedestals"></a>Pedestals</h2><p>In “Patterns for Generating a Layered Architecture”, Barry Rubel describes a pattern about creating an axis of symmetry in control software that is very similar to ports and adapters. The ‘’Pedestal’’ pattern calls for implementing an object representing each hardware device within the system, and linking those objects together in a control layer. The ‘’Pedestal’’ pattern can be used to describe either side of the hexagonal architecture, but does not yet stress the similarity across adapters. Also, being written for a mechanical control environment, it is not so easy to see how to apply the pattern to IT applications.</p><h2 id="Checks"><a href="#Checks" class="headerlink" title="Checks"></a>Checks</h2><p>Ward Cunningham’s pattern language for detecting and handling user input errors, is good for error handling across the inner hexagon boundaries.</p><h2 id="Dependency-Inversion-Dependency-Injection-and-SPRING"><a href="#Dependency-Inversion-Dependency-Injection-and-SPRING" class="headerlink" title="Dependency Inversion (Dependency Injection) and SPRING"></a>Dependency Inversion (Dependency Injection) and SPRING</h2><p>Bob Martin’s Dependency Inversion Principle (also called Dependency Injection by Martin Fowler) states that “High-level modules should not depend on low-level modules. Both should depend on abstractions. Abstractions should not depend on details. Details should depend on abstractions.” The ‘’Dependency Injection ‘’pattern by Martin Fowler gives some implementations. These show how to create swappable secondary actor adapters. The code can be typed in directly, as done in the sample code in the article, or using configuration files and having the SPRING framework generate the equivalent code.</p><hr><hr><h1 id="Acknowledgements"><a href="#Acknowledgements" class="headerlink" title="Acknowledgements"></a>Acknowledgements</h1><p>Thanks to Gyan Sharma at Intermountain Health Care for providing the sample code used here. Thanks to Rebecca Wirfs-Brock for her book ‘’Object Design’’, which when read together with the ‘’Adapter’’ pattern from the ‘’Design Patterns’’ book, helped me to understand what the hexagon was about. Thanks also to the people on Ward’s wiki, who provided comments about this pattern over the years (e.g., particularly Kevin Rutherford’s <a href="http://silkandspinach.net/blog/2004/07/hexagonal_soup.html)" target="_blank" rel="noopener">http://silkandspinach.net/blog/2004/07/hexagonal_soup.html)</a>.</p><hr><h1 id="References-and-Related-Reading"><a href="#References-and-Related-Reading" class="headerlink" title="References and Related Reading"></a>References and Related Reading</h1><p>FIT, A Framework for Integrating Testing: Cunningham, W., online at <a href="http://fit.c2.com" target="_blank" rel="noopener">http://fit.c2.com</a>, and Mugridge, R. and Cunningham, W., ‘’Fit for Developing Software’’, Prentice-Hall PTR, 2005.</p><p>The ‘’Adapter’’ pattern: in Gamma, E., Helm, R., Johnson, R., Vlissides, J., ‘’Design Patterns’’, Addison-Wesley, 1995, pp. 139-150.</p><p>The ‘’Pedestal’’ pattern: in Rubel, B., “Patterns for Generating a Layered Architecture”, in Coplien, J., Schmidt, D., ‘’PatternLanguages of Program Design’’, Addison-Wesley, 1995, pp. 119-150.</p><p>The ‘’Checks’’ pattern: by Cunningham, W., online at <a href="http://c2.com/ppr/checks.html" target="_blank" rel="noopener">http://c2.com/ppr/checks.html</a></p><p>The ‘’Dependency Inversion Principle’‘: Martin, R., in ‘’Agile Software Development Principles Patterns and Practices’’, Prentice Hall, 2003, Chapter 11: “The Dependency-Inversion Principle”, and online at <a href="http://www.objectmentor.com/resources/articles/dip.pdf" target="_blank" rel="noopener">http://www.objectmentor.com/resources/articles/dip.pdf</a></p><p>The ‘’Dependency Injection’’ pattern: Fowler, M., online at <a href="http://www.martinfowler.com/articles/injection.html" target="_blank" rel="noopener">http://www.martinfowler.com/articles/injection.html</a></p><p>The ‘’Mock Object’’ pattern: Freeman, S. online at <a href="http://MockObjects.com" target="_blank" rel="noopener">http://MockObjects.com</a></p><p>The ‘’Loopback’’ pattern: Cockburn, A., online at <a href="http://c2.com/cgi/wiki?LoopBack" target="_blank" rel="noopener">http://c2.com/cgi/wiki?LoopBack</a></p><p>‘’Use cases:’’ Cockburn, A., ‘’Writing Effective Use Cases’’, Addison-Wesley, 2001, and Cockburn, A., “Structuring Use Cases with Goals”, online at <a href="http://alistair.cockburn.us/crystal/articles/sucwg/structuringucswithgoals.htm" target="_blank" rel="noopener">http://alistair.cockburn.us/crystal/articles/sucwg/structuringucswithgoals.htm</a></p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>The Little Mocker</title>
      <link href="/2014/10/14/Art-2014-2014-10-14-TheLittleMocker/"/>
      <url>/2014/10/14/Art-2014-2014-10-14-TheLittleMocker/</url>
      <content type="html"><![CDATA[<h1 id="The-Little-Mocker"><a href="#The-Little-Mocker" class="headerlink" title="The Little Mocker"></a>The Little Mocker</h1><p><img src="http://files.colabug.com/forum/201405/09/122549a1wfhyfn11wsrfsr.jpg.thumb.jpg" alt="img"></p><p>关于Mock和Stub之间的区别，我一直没搞明白。</p><p>直到看了Uncle Bob的<a href="http://blog.8thlight.com/uncle-bob/2014/05/14/TheLittleMocker.html" target="_blank" rel="noopener">The Little Mocker</a> ，才知道里面的水还挺深的，我姑且尝试把它翻译一下：</p><hr><h1 id="小Mocker"><a href="#小Mocker" class="headerlink" title="小Mocker"></a>小Mocker</h1><p>作者:Uncle Bob<br>译者:A生  </p><p>接下来的讨论是关于mocking：</p><p>这是什么？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Authorizer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">authorize</span><span class="params">(String username, String password)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>一个interface.</p></blockquote><p>那么这样呢?</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DummyAuthorizer</span> <span class="keyword">implements</span> <span class="title">Authorizer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">authorize</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>那是Dummy</p></blockquote><p>那你拿Dummy做什么呢?</p><blockquote><p>你把它传入某地方,但你并不在意怎么用它的时候.</p></blockquote><p>就像?</p><blockquote><p>作为测试的一部分,当必须要传入一个参数,但你知道那个参数永远不会用到的时候.</p></blockquote><p>能举个例子么?</p><blockquote><p>当然.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">System</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">System</span><span class="params">(Authorizer authorizer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.authorizer = authorizer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">loginCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//returns number of logged in users.</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">newlyCreatedSystem_hasNoLoggedInUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System system = <span class="keyword">new</span> System(<span class="keyword">new</span> DummyAuthorizer());</span><br><span class="line">    assertThat(system.loginCount(), is(<span class="number">0</span>));</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>我懂了.为了能构造系统,必须传入一个Authorizer到构造函数里;但authorize方法永不会被调用到,所以在这个测试里,没有人会登陆入.</p><blockquote><p>你懂的.</p></blockquote><p>所以DummyAuthorizer的authorize方法返回一个null并不是一个错误.</p><blockquote><p>其实不是.事实上,一个Dummy最好能有所返回.</p></blockquote><p>为什么呢?</p><blockquote><p>因为任何人尝试用这个Dummy,他们会得到一个NullPointerException.</p></blockquote><p>啊,你不想这个Dummy被使用.</p><blockquote><p>对!它只是一个dummy.</p></blockquote><p>但这不是一个mock?我以为那些测试对象叫做mocks.</p><blockquote><p>它们是;但那是行话.</p></blockquote><p>行话?</p><blockquote><p>是的,”mock”这个词汇,有时被用于一种非正式的场合,用来代表测试对象的整个家族.</p></blockquote><p>那么这些测试对象们有一个正式的名字么?</p><blockquote><p>有,它们叫做”Test Doubles” [1].</p></blockquote><p>你指像电影里的”替身”么?</p><blockquote><p>必须滴.</p></blockquote><p>那么”mock”这个词只是通俗的行话?</p><blockquote><p>不,它也有一个正式的含义;但当我们非正式说mock时,它是Test Double的同义词.</p></blockquote><p>为什么我们得有2个词?不能只用Test Double代替Mock么?</p><blockquote><p>历史原因.</p></blockquote><p>历史?</p><blockquote><p>是的,很久之前某个很聪明的人写了一篇<a href="http://www.ccs.neu.edu/research/demeter/related-work/extreme-programming/MockObjectsFinal.PDF" target="_blank" rel="noopener">文章</a>来介绍和定义什么Mock对象.很多人读过并且开始使用这个词.没有读过的人听到这个词,也开始广义地使用.他们甚至把它变成动词,他们会说:”让我们mock那个对象吧”,或 “我们有很多的mocking要做”.</p></blockquote><p>很多词汇都发生过类似的事情,不是么?</p><blockquote><p>的确是的.特别是当一个词只有一个音节,那是容易说出的.</p></blockquote><p>耶，我猜那会容易说些：“让我们mock它吧” 而不是 “让我们为此做个测试替身吧”.</p><blockquote><p>对, 口语是生活的一种现实.</p></blockquote><p>OK,但我们需要精确的说呢…</p><blockquote><p>那你应该用正式的语言.</p></blockquote><p>那什么是Mock呢?</p><blockquote><p>在我们说那之前,我们应该看下其他种类的测试替身.</p></blockquote><p>比如?</p><blockquote><p>先看下Stubs</p></blockquote><p>什么是stub?</p><blockquote><p>这,就是一个stub:</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptingAuthorizerStub</span> <span class="keyword">implements</span> <span class="title">Authorizer</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">authorize</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>它返回ture.</p><blockquote><p>那就是.</p></blockquote><p>为什么?</p><blockquote><p>好的,假设你要测试你的系统的一部分其中需要你先登陆.</p></blockquote><p>那我就登陆咯.</p><blockquote><p>但你早已知道登陆是可行的,你在其他地方测试了它,为什么要测试多一次?</p></blockquote><p>因为那样容易?</p><blockquote><p>但是那样耗时,也需要做配置先. 如果登陆里有bug,那你的测试会失败.<br>毕竟, 那是不必要的耦合.</p></blockquote><p>Hmmm,好吧,为了有效的辩论,当我同意吧,下一步应该?</p><blockquote><p>你为了那测试,简单注入AcceptingAuthorizerStub到你的系统里.</p></blockquote><p>它会毫无疑问地去授权用户.</p><blockquote><p>对</p></blockquote><p>所以如果我想测试没有授权过的用户时,我应该用一个返回false的stub.</p><blockquote><p>又对了.</p></blockquote><p>Ok,那还有别的什么?</p><blockquote><p>还有这个:</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptingAuthorizerSpy</span> <span class="keyword">implements</span> <span class="title">Authorizer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">boolean</span> authorizeWasCalled = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">authorize</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    authorizeWasCalled = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我觉得那叫作Spy.</p><blockquote><p>正确.</p></blockquote><p>所以我为什么要这样用呢?</p><blockquote><p>当你需要确定authorize方法一定会被系统调用的时候,你会这么做.</p></blockquote><p>啊,我懂了.在我的测试里注入像一个stub的东西,但在测试的最后会检测变量authorizerWasCalled去确保系统是否真的调用了authorize方法.</p><blockquote><p>完全正确.</p></blockquote><p>所以一个Spy,侦查了调用者,我觉得它能记录所有这种类型的事情.</p><blockquote><p>它的确能做到,例如,它能算出调用的总次数.</p></blockquote><p>yeah,或者它能保持一个列表来记录每次传入的参数.</p><blockquote><p>对的,你可以通过Spies去了解,在测试的对象里的算法是如何工作的.</p></blockquote><p>听起来像耦合.</p><blockquote><p>那是!你不得不小心点. Spy用得越多,你的测试就越耦合你系统的实现,最终导致易脆的测试.</p></blockquote><p>什么是易脆的测试?</p><blockquote><p>一个测试破坏了一些不应该去破坏一个测试的理由.</p></blockquote><p>如若你改变系统里的代码,某些测试也会受到破坏.</p><blockquote><p>对,但设计良好的测试能最小化那种破坏,Spies恰恰与之相反.</p></blockquote><p>OK,我懂了.那还有别的测试替身么?</p><blockquote><p>还有2种,第一种是:</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptingAuthorizerVerificationMock</span> <span class="keyword">implements</span> <span class="title">Authorizer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">boolean</span> authorizeWasCalled = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Boolean <span class="title">authorize</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">    authorizeWasCalled = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> authorizedWasCalled;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然,这是一个mock.</p><blockquote><p>对,一个真正的Mock.</p></blockquote><p>真正的?</p><blockquote><p>对,这是一个正式的mock对象,与字面上的含义一致.</p></blockquote><p>我明白了,它看起来像你把测试里的断言移至verify方法里,真正的mock.</p><blockquote><p>对,Mocks知道他们在测试什么.</p></blockquote><p>所以那是?你只是把断言放入mock里?</p><blockquote><p>不完全,是,断言放入了mock里.然而,mock在测试的是<em>行为</em>.</p></blockquote><p>行为?</p><blockquote><p>对, mock并不关心函数返回的值.它关心的什么函数被调用,调用了什么参数,什么时候和有多频繁被调用.</p></blockquote><p>所以一个mock经常是一个spy?</p><blockquote><p>对,一个mock调查了被测试模块的行为,它知道什么样的行为是被期待的.</p></blockquote><p>Hmmm,把期望搬入mock里感觉上是一种耦合.</p><blockquote><p>那是.</p></blockquote><p>那为什么呢?</p><blockquote><p>那样写一个mocking工具会容易的多.</p></blockquote><p>一个mocking工具?</p><blockquote><p>是的,像JMock,EasyMock,或Mockito等.那些工具能让你飞一般去创建mock对象.</p></blockquote><p>看起来很复杂.</p><blockquote><p>那倒不会,<a href="http://martinfowler.com/articles/mocksArentStubs.html" target="_blank" rel="noopener">这里</a>有Martin Fowler一篇介绍它的著名文章.</p></blockquote><p>那是不是还有一本关于它的书,有么?</p><blockquote><p>有,<a href="http://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627" target="_blank" rel="noopener">Growing Object Oriented Software, Guided by Tests</a>就是一本关于驱动mock的主流设计哲学的书.</p></blockquote><p>Ok, 所以完了? 你说过还有另外一种的.</p><blockquote><p>对, 再多一种, Fakes.</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcceptingAuthorizerFake</span> <span class="keyword">implements</span> <span class="title">Authorizer</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> Boolean <span class="title">authorize</span><span class="params">(String username, String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username.equals(<span class="string">"Bob"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ok,那样很奇怪,所有叫做”Bob”的用户都会被授权.</p><blockquote><p>对, 一个Fake有业务上的行为. 你可以驱动一个fake根据不同的数据表现出不同的行为.</p></blockquote><p>看起来像虚拟器.</p><blockquote><p>对,虚拟器是fakes.</p></blockquote><p>Fakes不是stubs吧?</p><blockquote><p>不是,faker有真正业务上的行为;stubs没有. 事实上,我们之前谈论的测试替身没有一种包含真正业务行为.</p></blockquote><p>所有fakes在基础概念上完全不同的.</p><blockquote><p>的确是.我们可以这样说: 一个Mock是一种spy,一个spy是一种stub,而一个stub是一种dummy. 不是fake 不是它们中的任何一种. 它是完全不同类型的测试替身.</p></blockquote><p>我可以想象fakes会复杂起来.</p><blockquote><p>它们可以变得极端的复杂,所以它们会复杂到需要自己的单元测试.在极端情况下,fakes变成了真正的系统.</p></blockquote><p>Hmmm.</p><blockquote><p>对,Hmmm. 我不常写fakes,事实上,三十多年来我没有写过一个.</p></blockquote><p>Wow! 那你会写什么? 其他剩下的测试替身么?</p><blockquote><p>最多用的是stubs和spyies. 我自己写的,我不常用mocking工具.</p></blockquote><p>那你用Dummies么?</p><blockquote><p>对, 但极少.</p></blockquote><p>那mocks呢?</p><blockquote><p>只有我用mocking工具的时候用.</p></blockquote><p>但你说过你不用mocking工具.</p><blockquote><p>对,我通常不会用.</p></blockquote><p>为什么不?</p><blockquote><p>因为stubs 和 spies是很容易写的, 我的IDE让此变的简单.我只要指着接口告诉IDE去实现它,瞧!它就给我一个dummy了.所以我只需要一个小小改变就能变成stub 或spy.所以我真的很少用mocking工具.</p></blockquote><p>所以它只是为了方便?</p><blockquote><p>对, 事实上我不喜欢mocking工具的奇怪语法,还有配置它们的复杂性. 我发现写自己的测试替身在多数情况下会比较简单.</p></blockquote><p>OK, 好的, 谢谢你的对话.</p><blockquote><p>随时欢迎.</p></blockquote><hr><p>[1] <a href="http://www.amazon.com/xUnit-Test-Patterns-Refactoring-Code/dp/0131495054" target="_blank" rel="noopener">xUnit Test Patterns</a></p><hr><p>PS: 最后,A生简单的介绍它们之间的关系:</p><p><img src="/img/2014/Mocks.png" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Time Of BigData</title>
      <link href="/2014/10/01/Tao-2014-2014-10-01-TimeOfBigData/"/>
      <url>/2014/10/01/Tao-2014-2014-10-01-TimeOfBigData/</url>
      <content type="html"><![CDATA[<h1 id="大数据时代"><a href="#大数据时代" class="headerlink" title="大数据时代"></a>大数据时代</h1><p><img src="http://img3.douban.com/lpic/s24574862.jpg" alt="img"></p><p> 大学的时候，老师曾提出一个简单的问题： 什么是IT？<br> 那个时候真的什么都不知道，就知道“挨踢” ：）</p><p> IT全称是Information Technology，即信息技术。<br> 在当代，多数技术人只知道关注T（技术）。<br> 然而，在大数据时代，应该注重的是I（信息）本身。<br> 这本《大数据时代》，打开了一道通往新时代的门，为此我们需要进行自我变革：  </p><p><img src="/img/2014/TimeOfBigData.png" alt="img"></p><p><a href="https://github.com/Antinomy/MindMappingRepository/blob/master/BigData/TimeOfBigData.org" target="_blank" rel="noopener">(MindMapping Source)</a></p><p>#思维变革</p><p>##随机采样<br> 小数据时代由于技术和人力问题，只能采样随机采样来采集数据。<br> 用最少的数据获得最多的信息，时代局限使然。  </p><p> 随机采样的局限性：<br> 分析的精确性随着采样的随机性增加而大幅提高，但与样本数量的增加关系不大。<br> 所以，采样的随机性比数量更重要。<br> 而且不适合考察子类别的情况，一旦继续细分，错误率就大大增加。  </p><p> 我们不能满足于正态分布一般中庸平凡的景象，生活中真正有趣的事情经常藏匿在细节之中。<br> 采样分析却无法捕捉到这些细节。  </p><p>##样本=总体<br> 一切都改变了，我们需要的是所有的数据，样本=总体。<br> 无论是针对一个小团体还是整个社会，多样性是有额外的价值的。<br> “大数据”全在于发现和理解信息内容及信息之间的关系。  </p><p>##拥抱混乱<br> 很多情况下，与其致力于避免错误相比，对错误的包容会带给我们更多的好处。<br> 执迷于精确性是信息匮乏时代和模拟时代的产物。  </p><p> 只有5%的数据是结构化且适用于传统数据库的。<br> 如果不接受混乱，剩下的95%的非结构化数据都无法利用。<br> 大数据的简单算法比小数据的复杂算法更有效。<br> 接受数据的不精确和不完美，反而能够更好的进行预测，也能够更好地了解这个世界。  </p><p> 混乱是一种标准途径，而不应该是竭力避免的。我们再也不能假装活在一个齐整的世界里。</p><p>##因果只是关联的一种</p><p> 在大数据时代，知道“是什么”就够了，没有必要知道“为什么”。<br> 不必非得知道现象背后的原因，而是让数据自己“发声”。  </p><p> 在哲学界，关于因果关系是否存在的争论已持续几个世纪了。<br> 如果凡事皆有因果，那么我们就没有决定的自由，即宿命论。<br> 所有生命的轨迹都只是受因果关系的控制而已。  </p><p> 不是因果关系，而是相关关系。  </p><p> 相关关系的核心是量化两个数据值之间的数理关系。<br> 我们理解世界不再需要建立在假设的基础上，这个假设是指针对现象建立的有关其产生机制和内在机理的假设。  </p><p> 一个东西要出故障，不会是瞬间的，而是慢慢地出问题的。<br> 通过找到关联物并监控它，我们就能预测未来。  </p><p>##三个思维变革<br> 实际上，与大数据相关的三个思维转变：  </p><ol><li>分析与某事物相关的所有数据，而不是依靠分析少量的数据样本。  </li><li>接受数据的纷繁复杂，不再追求精确性。  </li><li>不再探求难以捉摸的因果关系，转而关注事物的相关关系。  </li></ol><p>#商业变革<br> 大数据发展的核心动力来源于人类测量、记录和分析世界的渴望。  </p><p>##数据化<br> 数据化不是数字化，我们可以从文字，方位，沟通，甚至最不可能的地方提取数据。<br> 世间万物，一切皆可“量化”。<br> 有了大数据的帮助，我们不会把世界看做一连串自然或是社会现象的事件。  </p><pre><code>本质上世界是由信息构成的。 </code></pre><p>##数据创新<br> 数据就像一个神奇的宝石矿，第一眼只能看道冰山一角，不断挖掘才能不断给予。<br> 对于数据，我们可以进行重组、扩展、开放和再利用。<br> 就算是数据废气，数据折旧也可从中估值。  </p><p>##角色定位<br> 根据价值的不同来源，分别出现三种大数据公司：  </p><ol><li>基于数据本身的公司  </li><li>基于技能的公司  </li><li><p>基于思维的公司  </p><p>同时也出现了：<br>新的职业： 数据科学家<br>新的中介： 数据中间商  </p><p>传统的专家也会逐渐消亡，全才会比专才更重要。<br>大数据，决定企业竞争力。  </p></li></ol><p>#管理变革</p><p>##风险<br> 大数据会带来很多威胁：</p><ol><li><p>加深对大众隐私的威胁：<br>告知与许可，模糊/匿名化失效，隐私被二次利用。  </p></li><li><p>对公平公正和自由意志的亵渎 ：<br>运用预测来判断和惩罚人类的潜在行为。  </p></li><li><p>运用不当会变成权贵依赖镇压民众的工具。  </p><p>如果大数据分析完全准确，那么我们的未来就会被精准的预测。<br>因此，我们不仅失去选择的权利，而且会按照预测去行动。<br>如果预测成为了现实，我们也失去的自由的意志，自由选择生活的权利。  </p><p>既然我们别无选择，那么我们也就不需要承担责任，这不是很讽刺吗？  </p><p>我们比想象中更容易受到数据的统治——让数据良莠参半的方式统治我们。<br>反对数据独裁和对数据的过分依赖，才能走出大数据的困境。<br>##掌控<br>我们在生产和信息交流方式上的变革，必然会引发自我管理上的变革：  </p></li><li><p>个人隐私保护<br>从个人许可证到让数据使用者承担责任。  </p></li><li><p>个人动因vs预测分析<br>保护个人动因，防范“数据独裁”的危害： 公开、公正、可反驳原则。  </p></li><li><p>击碎黑盒子<br>大数据算法师的崛起：评估数据源，分析和预测工具的选取，计算结果的解读和考察。  </p></li><li><p>反数据垄断大亨  </p></li></ol><p>#正在发生的未来<br> 大数据为我们提供的不是最终答案，只是参考答案。<br> 帮助是暂时的，更好的方法和答案还在不久的未来。  </p><pre><code>凡是过去，皆为序曲</code></pre>]]></content>
      
      <categories>
          
          <category> Tao </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Open Source Licence</title>
      <link href="/2014/09/28/Other-2014-2014-09-28-OpenSourceLicence/"/>
      <url>/2014/09/28/Other-2014-2014-09-28-OpenSourceLicence/</url>
      <content type="html"><![CDATA[<h1 id="开源许可证"><a href="#开源许可证" class="headerlink" title="开源许可证"></a>开源许可证</h1><p> <img src="/img/2014/OpenSourceLicence.png" alt="img"></p><p> 开源世界的许可证多如牛毛，常见的开源许可证如BSD, GPL, LGPL,MIT等。<br> 那么他们之间到底有什么区别呢？<br> 我尝试肤浅地解释他们之间的区别：  </p><h1 id="是否允许闭源？"><a href="#是否允许闭源？" class="headerlink" title="是否允许闭源？"></a>是否允许闭源？</h1><p> 第一个分水岭，是否允许闭源？<br> 如果允许闭源的话，就可以修改源代码，拿来商用。  </p><p> <em>如果允许闭源</em>，那下一个分支就是：</p><h2 id="是否必须包括原版权？"><a href="#是否必须包括原版权？" class="headerlink" title="是否必须包括原版权？"></a>是否必须包括原版权？</h2><p> <a href="http://www.apache.org/licenses/" target="_blank" rel="noopener">Apache协议</a><br> 允许闭源,但需在衍生的软件的协议里包括Apache的协议。<br> 如果不需要放置原版权，是否可以在衍生的软件放入自己的广告又成了下一个分支:<br> <a href="http://www.opensource.org/licenses/mit-license.php" target="_blank" rel="noopener">MIT</a>最为宽松,可以放入广告，<br> <a href="http://www.freebsd.org/copyright/freebsd-license.html" target="_blank" rel="noopener">BSD</a>则不能。  </p><p> <em>如果不允许闭源</em>，那下一个分支就是：</p><h2 id="是否采用同样的许可证？"><a href="#是否采用同样的许可证？" class="headerlink" title="是否采用同样的许可证？"></a>是否采用同样的许可证？</h2><p> 对新增的代码是否需要采用源代码同样的许可证。<br> <a href="">GPL</a>最为严格,要求所有衍生代码采用同样的许可证.<br> <a href="">LGPL</a>则不需要。</p><h1 id="WTFPL"><a href="#WTFPL" class="headerlink" title="WTFPL"></a>WTFPL</h1><p> 然而,最牛逼开源协议当属<br> <a href="http://wtfpl.org/" target="_blank" rel="noopener">WTFPL</a> (what the fuck public license) ，没有之一。</p>]]></content>
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>MindMapping - Choice on Tools</title>
      <link href="/2014/09/25/Tech-2014-2014-09-25-MindMapping-ChoiceOnTools/"/>
      <url>/2014/09/25/Tech-2014-2014-09-25-MindMapping-ChoiceOnTools/</url>
      <content type="html"><![CDATA[<h1 id="MindMapping-工具的选择"><a href="#MindMapping-工具的选择" class="headerlink" title="MindMapping - 工具的选择"></a>MindMapping - 工具的选择</h1><p> 从中学的时候接触一本叫《学习的革命》的书开始，学会了用思维导图来分析问题和记录笔记。<br> 而我用来制作思维导图的工具，也一直在变化。<br> 工具的变化，其实反映的是我思维方式的变化。  </p><h1 id="纸笔"><a href="#纸笔" class="headerlink" title="纸笔"></a>纸笔</h1><p><img src="/img/2014/MindMapping-Tools-1.jpg" alt="img"><br> 通过纸和笔，可以无阻力的制作思维导图。<br> 适合临时性的创作，不适合需要反复修改的情形。  </p><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><pre><code>不会被工具所限制，思维无阻</code></pre><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><pre><code>难以携带和分享</code></pre><h1 id="手机：App"><a href="#手机：App" class="headerlink" title="手机：App"></a>手机：App</h1><p> 手机的App就非常方便随身携带，但是屏幕太小，思维阻力最大。<br><img src="/img/2014/MindMapping-Tools-2.jpg" alt="img">  </p><h2 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h2><pre><code>随时随地记录思维，易携带和分享</code></pre><h2 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h2><pre><code>屏幕有限，思维阻力大</code></pre><h1 id="PC-Website"><a href="#PC-Website" class="headerlink" title="PC Website"></a>PC Website</h1><p> 通过在线的网站来制作简单，但是受限于网络环境。<br> 网速不好的时候，思维阻力也大。<br><img src="/img/2014/MindMapping-Tools-3.png" alt="img">  </p><h2 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h2><pre><code>无需客户端，打开网页即可，便于分享</code></pre><h2 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h2><pre><code>受限制于网络环境，思维阻力大</code></pre><h1 id="PC-Client：FreeMind-Xmind"><a href="#PC-Client：FreeMind-Xmind" class="headerlink" title="PC Client：FreeMind/Xmind"></a>PC Client：FreeMind/Xmind</h1><p> 通过PC客户端（FreeMind/Xmind）来制作就不会受限于网速，相对思维阻力较小。<br> 但是其格式一般基于XML or 其他格式，可读性差，对版本控制不友好。<br><img src="/img/2014/MindMapping-Tools-4.png" alt="img">  </p><h2 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h2><pre><code>不受限于网络环境，思维阻力小</code></pre><h2 id="缺点-3"><a href="#缺点-3" class="headerlink" title="缺点"></a>缺点</h2><pre><code>难以版本控制，分享不方便</code></pre><h1 id="最终方案：-Org-text"><a href="#最终方案：-Org-text" class="headerlink" title="最终方案： Org text"></a>最终方案： Org text</h1><p> 经过了种种工具的试用，我最终找到了适合自己的工具。<br> Emacs下的Org模式，基于纯文本，版本控制和可读性最好。<br> 对版本控制也很友好，还可以导出MM格式来由FreeMind/Xmind来进行优化。<br> 唯一复杂的就是中间多了一层，有利必有弊嘛。<br><img src="/img/2014/MindMapping-Tools-5.png" alt="img">  </p><h2 id="优点-4"><a href="#优点-4" class="headerlink" title="优点"></a>优点</h2><pre><code>纯文本格式，版本控制友好制作简单，思维阻力最小。可导出MM格式，通过第三方美化</code></pre><h2 id="缺点-4"><a href="#缺点-4" class="headerlink" title="缺点"></a>缺点</h2><pre><code>多了一层中间层，略复杂</code></pre>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Way of Philosophy - Metaphysics</title>
      <link href="/2014/09/21/Tao-2014-2014-09-21-WayOfPhilosophy-Metaphysics/"/>
      <url>/2014/09/21/Tao-2014-2014-09-21-WayOfPhilosophy-Metaphysics/</url>
      <content type="html"><![CDATA[<h1 id="哲学之路-形而上学"><a href="#哲学之路-形而上学" class="headerlink" title="哲学之路 : 形而上学"></a>哲学之路 : 形而上学</h1><p><img src="http://ec4.images-amazon.com/images/I/41LcSjps8YL._SS500_.jpg" alt="img">  </p><p> 作为一支奇葩，中学时代最感兴趣的科目就是哲学。<br> 严格意义上是指政治课里的辩证唯物法，后来还想通过自考来考取哲学学位，<br> 不过最后因买不到考试用的教材而放弃了（冷门到没钱赚，哈哈）。  </p><p><img src="http://ec8.images-amazon.com/images/I/41pXBtOaQvL._SS500_.jpg" alt="img"><br> 直到看了林欣浩《哲学家们都干了些什么？》，我才决定从头学习大师的著作来追求我的哲学之路。</p><p><img src="/img/2014/Philosophy-all.png" alt="img">  </p><p>#第一站: 形而上学</p><p> 古希腊作为哲学的起源,出现了好多哲学的圣人.<br> 苏格拉底就是其中的佼佼者,他的学生柏拉图也是非常著名的.<br> 而柏拉图的学生亚里士多德,提出了《形而上学》.</p><h2 id="形而上者谓之道"><a href="#形而上者谓之道" class="headerlink" title="形而上者谓之道"></a>形而上者谓之道</h2><pre><code>形而上者谓之道,形而下者谓之器. ——《易经·系辞》</code></pre><p> 这里的形而上学主要是指哲学，同样形而上的还有数学和物理学（都是思辨科学）。<br> 哲学在先，数学和物理学是哲学的分支。<br> 数学研究事物的共同原理，物理学研究事物的偶性。  </p><p><img src="/img/2014/Philosophy-Metaphysics.png" alt="img">  </p><h2 id="性质与范围"><a href="#性质与范围" class="headerlink" title="性质与范围"></a>性质与范围</h2><p> 哲学是关于事物最初本原和原因的科学，属于思辨科学。<br> 研究“作为存在的存在”，以及其应有的各种偶性。  </p><h2 id="本体学说"><a href="#本体学说" class="headerlink" title="本体学说"></a>本体学说</h2><p> 只有本体是主体，其他的一切属性都是载体。<br> 本体是可以分离的，可独立存在。  </p><h2 id="四因学说"><a href="#四因学说" class="headerlink" title="四因学说"></a>四因学说</h2><p> 本因（质料因），物因（形式因），动因（运动因），极因（目的因）。<br> 事物的形成需要一定的质料，区别与其他事物的本质就是形式因。<br> 事物的生灭变化需要一种最初的力量源泉，即运动因。<br> 任何事物都有一定的目的。  </p><h2 id="形式和质料学说"><a href="#形式和质料学说" class="headerlink" title="形式和质料学说"></a>形式和质料学说</h2><p> 形式因，运动因，目的因归结在一起总称为“形式”。<br> 形式与质料是事物的两个方面。  </p><h2 id="潜能和现实学说"><a href="#潜能和现实学说" class="headerlink" title="潜能和现实学说"></a>潜能和现实学说</h2><p> 质料是没有任何规定性的不确定的东西，只是一种潜在的可能。<br> 当质料与形式结合起来，形式给予它一定的性质，才称为现实。  </p><h2 id="一"><a href="#一" class="headerlink" title="一"></a>一</h2><p> “一”的含义有2种：<br> 其一，就偶性而言的一。<br> 其二，就自身而言的一。<br> 我想起了“一即全，全即一”  </p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p> 总得来说，这本书概念性的东西太多。<br> 按照我目前的智商水平也就一知半解，余额不足需要充值。 ：）<br> 不是因为懂才写下来，是因为不懂才写下来。      </p>]]></content>
      
      <categories>
          
          <category> Tao </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Philosophy </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Weird Issue - Line NotFound</title>
      <link href="/2014/09/18/Art-2014-2014-09-18-WeridIssue-NotFoundedLine/"/>
      <url>/2014/09/18/Art-2014-2014-09-18-WeridIssue-NotFoundedLine/</url>
      <content type="html"><![CDATA[<h1 id="疑难杂症-找不到的线"><a href="#疑难杂症-找不到的线" class="headerlink" title="疑难杂症 : 找不到的线"></a>疑难杂症 : 找不到的线</h1><blockquote><p><img src="/img/2014/LineNotFound-1.png" alt="img"></p></blockquote><hr><p>#找不到的线</p><p>##起因<br> 在最近的工作中，遇到一个简单地不能再简单的需求，把图片里的一条横线改个颜色。</p><p> 拥有多年PS（涂鸦）经验的老夫以为可以秒杀这个需求，万万没想到，竟花费了我几天的时间才搞定。</p><p>##分析<br> 按照常识，那条横线一般都会是一张图片，找到源文件PS一下就搞定。</p><p>但是，当我查看放图片的目录时就震惊了，木有！！</p><blockquote><p><img src="/img/2014/LineNotFound-3.png" alt="img"></p></blockquote><p>##困境<br> 这时我就下意识地觉得这条简单的横线可能是用js+css绘制的，瞬间觉得原作者高大上起来。</p><p> 可是在查看了所有的js和css代码之后，我陷入了深深的绝望之中。木有，还是木有！！！</p><p>##排除<br>  在我陷入困境几天之后，好心的同事S提醒我试试排除法。<br>  于是经过一轮HTML的注释之后，我找到的Root Cause！</p><p>##解决</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">background</span>=<span class="string">"bg.png"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>放大图片一看,焕然大悟!!</p><blockquote><p><img src="/img/2014/LineNotFound-2.png" alt="img"></p></blockquote><p>原来还是图片,不过是用一条很长的竖线里一个很猥琐的点,去平铺而成的横线!! Orz</p><hr><p>#总结</p><p>##答案总在不经意的时候逃过<br>    1.有些问题的确不容易一下找到答案,往往解决方案就在附近却视而不见。</p><pre><code>2.人往往容易往复杂的地方去想，蓦然回首却发现答案很简单。3.实在不行的时候，试试排除法吧。囧</code></pre><p>##吐糟<br> 最后吐槽下这个设计，这样高明（猥琐）的设计往往带来维护的复杂性。</p><p> 很多时候，还是Keep it simple 比较好。</p>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TroubleShoot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Bootstrap - Way Of Responsive Web Design</title>
      <link href="/2014/09/06/Tech-2014-2014-09-06-Bootstrap-WayOfResponsiveWebDesign/"/>
      <url>/2014/09/06/Tech-2014-2014-09-06-Bootstrap-WayOfResponsiveWebDesign/</url>
      <content type="html"><![CDATA[<h1 id="Bootstrap-响应式Web设计之道"><a href="#Bootstrap-响应式Web设计之道" class="headerlink" title="Bootstrap - 响应式Web设计之道"></a>Bootstrap - 响应式Web设计之道</h1><p>建立自己的个人blog也有一段时间的，跟用其他著名的blog不一样。所有事情都可以享受DIY的乐趣，当然，也有付出不少的时间。基本功能也搞的7788， 就是用手机端查看博客的时候，排版差劲的很。基于后PC时代，移动设备的时代也开始了。稍微百谷歌度之后，还是有简单的解决方案的——Bootstrap。</p><blockquote><h2 id="什么是-Bootstrap？"><a href="#什么是-Bootstrap？" class="headerlink" title="什么是 Bootstrap？"></a>什么是 <a href="http://getbootstrap.com/" target="_blank" rel="noopener">Bootstrap</a>？</h2><p>应用<a href="http://www.w3cschool.cc/bootstrap/bootstrap-intro.html" target="_blank" rel="noopener">w3cschool</a>的定义:<br>Bootstrap 是一个用于快速开发 Web 应用程序和网站的前端框架。Bootstrap 是基于 HTML、CSS、JAVASCRIPT 的。</p></blockquote><h2 id="Bootstrap-的网格系统（Grid-System）"><a href="#Bootstrap-的网格系统（Grid-System）" class="headerlink" title="Bootstrap 的网格系统（Grid System）"></a>Bootstrap 的网格系统（Grid System）</h2><p>Grid System是基于移动设备优先策略,简单实现多设备自适应layout的关键。<br>通过不同的class设定就能实现不同的布局：<br><a href="/img/2014/0824-IDDD.png" target="_blank"><br><img src="/img/2014/Bootstarp-1.png" alt="img"><br></a></p><p>e.g. 以下HTML Code，就能简单地实现响应式布局</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-12 col-md-offset-1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        content </span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Bootstrap-的必要文件"><a href="#Bootstrap-的必要文件" class="headerlink" title="Bootstrap 的必要文件"></a>Bootstrap 的必要文件</h2><p>除了Bootstrap自己的CSS和字体,Jquery的库也是要的,官方下载后放入自己的路径下即可</p><p><img src="/img/2014/Bootstarp-5.png" alt="img"></p><h2 id="最终效果如下-不同设备下不同的自适应布局"><a href="#最终效果如下-不同设备下不同的自适应布局" class="headerlink" title="最终效果如下,不同设备下不同的自适应布局:"></a>最终效果如下,不同设备下不同的自适应布局:</h2><pre><code>大屏幕</code></pre><p><img src="/img/2014/Bootstarp-2.png" alt="img"></p><pre><code>中屏幕</code></pre><p><img src="/img/2014/Bootstarp-3.png" alt="img"></p><pre><code>小屏幕</code></pre><p><img src="/img/2014/Bootstarp-4.png" alt="img"></p><hr>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Issues On Upgrade Jekyll-2.2.0</title>
      <link href="/2014/09/03/Tech-2014-2014-09-03-IssuesOnUpgradeJekyll-2-2-0/"/>
      <url>/2014/09/03/Tech-2014-2014-09-03-IssuesOnUpgradeJekyll-2-2-0/</url>
      <content type="html"><![CDATA[<h1 id="Jekyll-2-2-0-的坑"><a href="#Jekyll-2-2-0-的坑" class="headerlink" title="Jekyll-2.2.0 的坑"></a>Jekyll-2.2.0 的坑</h1><p>手痒把Jekyll升级到2.2.0的时候,发现服务已经启动不起来了. @_@ |||</p><p>折腾了一阵子,搞定了中间出现的几个问题, 终于正常了. ^_^</p><p><img src="/img/2014/jekyll2.2.0.png" alt="img"></p><hr><h2 id="问题1-JavaScript-runtime-Issue"><a href="#问题1-JavaScript-runtime-Issue" class="headerlink" title="问题1 : JavaScript runtime Issue"></a>问题1 : JavaScript runtime Issue</h2><p><em>Could not find a JavaScript runtime.</em></p><p>Jekyll 2.2.0比起旧版本需要多一个Js runtime, 装个node.js fixed.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nodejs</span><br></pre></td></tr></table></figure><hr><h2 id="问题2-pygments-Issue"><a href="#问题2-pygments-Issue" class="headerlink" title="问题2: pygments Issue"></a>问题2: pygments Issue</h2><p><em>Deprecation: The ‘pygments’ configuration option has been renamed to ‘highlighter’. Please update your config file accordingly. The allowed values are ‘rouge’, ‘pygments’ or null.</em></p><p>pygments (代码高亮插件)在 _config.yml的配置格式改变了.</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">pygments:</span> <span class="literal">true</span>  --&gt;  <span class="symbol">highlighter:</span> pygments</span><br></pre></td></tr></table></figure><hr><p>最后重新启动下服务,搞定!</p><pre><code>jekyll serve --watch</code></pre><p><img src="/img/2014/jekyll2.2.0-Done.png" alt="img"></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Benefit of Extract Method</title>
      <link href="/2014/09/02/Tech-2014-2014-09-02-BenefitOfExtractMethod/"/>
      <url>/2014/09/02/Tech-2014-2014-09-02-BenefitOfExtractMethod/</url>
      <content type="html"><![CDATA[<h1 id="提炼方法的好处？"><a href="#提炼方法的好处？" class="headerlink" title="提炼方法的好处？"></a>提炼方法的好处？</h1><p>  在最近的一次Code Review里，我和同事在一个基本的问题上产生了分歧。三言两语很难说的清楚，我决定尝试把它写清楚。</p><p>  分歧的起因在于我把以下的这段代码：</p><hr><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// some method</span></span><br><span class="line"><span class="built_in">memset</span>( pData-&gt;field1 , <span class="string">' '</span> ,<span class="keyword">sizeof</span>(pData-&gt;field1));</span><br><span class="line"><span class="built_in">memset</span>( pData-&gt;field2 , <span class="string">' '</span> ,<span class="keyword">sizeof</span>(pData-&gt;field2));</span><br><span class="line"><span class="built_in">memset</span>( pData-&gt;field3 , <span class="string">' '</span> ,<span class="keyword">sizeof</span>(pData-&gt;field3));</span><br><span class="line"><span class="built_in">memset</span>( pData-&gt;field4 , <span class="string">' '</span> ,<span class="keyword">sizeof</span>(pData-&gt;field4));</span><br><span class="line"><span class="built_in">memset</span>( pData-&gt;field5 , <span class="string">' '</span> ,<span class="keyword">sizeof</span>(pData-&gt;field5));</span><br><span class="line"><span class="built_in">memset</span>( pData-&gt;field6 , <span class="string">' '</span> ,<span class="keyword">sizeof</span>(pData-&gt;field6));</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>  写成:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Init_String</span><span class="params">(CHAR *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">memset</span>(str ,<span class="string">' '</span>,<span class="keyword">sizeof</span>(str))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// some method</span></span><br><span class="line">Init_String(pData-&gt;field1);</span><br><span class="line">Init_String(pData-&gt;field2);</span><br><span class="line">Init_String(pData-&gt;field3);</span><br><span class="line">Init_String(pData-&gt;field4);</span><br><span class="line">Init_String(pData-&gt;field5);</span><br><span class="line">Init_String(pData-&gt;field6);</span><br><span class="line">...</span><br></pre></td></tr></table></figure><hr><h2 id="同事对此有以下几点疑问"><a href="#同事对此有以下几点疑问" class="headerlink" title="同事对此有以下几点疑问:"></a>同事对此有以下几点疑问:</h2><pre><code>1. 有什么好处?2. 多了个方法，性能会变低。3. 与过去的风格不同，增加学习曲线。</code></pre><hr><h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2><p>在回答所有的问题之前,我先说下我的动机,在原先的方法里</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>( pData-&gt;field1 , <span class="string">' '</span> ,<span class="keyword">sizeof</span>(pData-&gt;field1));</span><br></pre></td></tr></table></figure><p>看来好简单的一句程序里，出现了2次”pData-&gt;field1”。<br>这里已经出现了重复的臭味道，随着这样的写法数量增多，这段代码就越来越臭了。</p><p>有代码洁癖的我是觉得难以忍受的。</p><p>根据DRY原则（Dont Repeat Yourself）,我把代码里不变的部分用Extract Method的手法重构到一个方法里。</p><p>方法名叫Init_String（），我简单的把一个内存的操作的工作封装到‘初始化字符串’的方法里。</p><p>下次我再看到这里我就只需要知道它能帮我初始化‘字符串’就行，而不需要分神去理会它是如何的实现。</p><p>然后，我再来一一解答所有问题：</p><hr><h2 id="有什么好处"><a href="#有什么好处" class="headerlink" title="有什么好处?"></a>有什么好处?</h2><pre><code>1. 符合DRY原则 (一次且仅一次)   去除重复的代码,消除坏味道.2. 符合OCP原则 (开闭原则）   拆分不变与变化的代码，对于扩展是开放的，但是对于修改是封闭的.3. 更整洁的代码 (Clean Code)</code></pre><hr><h2 id="多了个方法，性能会变低"><a href="#多了个方法，性能会变低" class="headerlink" title="多了个方法，性能会变低?"></a>多了个方法，性能会变低?</h2><p>多了一个新方法,每次memset时就call 多次 Init_String（）.<br>看上去是会多耗点性能,但是新的method跟原来的代码是在同一个文件里的.<br>从内存的角度,其内存地址也应该相近,在数量有限的call里,我认为性能是人感受不出来的.<br>当然要更深入讨论,可以去了解C函数的调用机制.</p><hr><h2 id="与过去的风格不同，增加学习曲线。"><a href="#与过去的风格不同，增加学习曲线。" class="headerlink" title="与过去的风格不同，增加学习曲线。"></a>与过去的风格不同，增加学习曲线。</h2><p>的确,这里是个问题。<br>例如100个文件里就1个文件是这种写法，风格不统一会对新人造成一点点阅读困难。</p><p>我们当然做不到一夜之间就改变所有文件，也没有这个必要。<br>这不应该成为阻止我们改进的绊脚石。<br>我一直认为改进应该是增量的，每一次随着需求变化可以适当在满足需求的同时，改善现有的代码。</p><p>重构是有成本的，但也是有回报的。我觉得值得投资。</p><hr><h2 id="Extract-Method"><a href="#Extract-Method" class="headerlink" title="Extract Method"></a>Extract Method</h2><p>最后再啰嗦下什么是Extract Method （提炼函数）.</p><p>Extract Method （提炼函数）是最常用的重构手法之一。当看见一个过长的函数或者一段需要注释才能让人理解用途的代码，就应该将这段代码放进一个独立函数中。</p><p>简短而命名良好的函数的好处：首先，如果每个函数的粒度都很小，那么函数被复用的机会就更大；其次，这会使高层函数读起来就想一系列注释；再次，如果函数都是细粒度，那么函数的覆写也会更容易些。</p><p><a href="http://msdn.microsoft.com/en-us/library/0s21cwxk.aspx" target="_blank" rel="noopener">Further Read</a></p><hr><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><p><a href="http://www.cplusplus.com/reference/cstring/memset/" target="_blank" rel="noopener">memset</a></p><p><a href="http://zh.wikipedia.org/wiki/%E4%B8%80%E6%AC%A1%E4%B8%94%E4%BB%85%E4%B8%80%E6%AC%A1" target="_blank" rel="noopener">一次且仅一次</a></p><p><a href="http://zh.wikipedia.org/wiki/%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99" target="_blank" rel="noopener">开闭原则</a></p><p><a href="http://zh.wikipedia.org/wiki/%E4%BB%A3%E7%A0%81%E9%87%8D%E6%9E%84" target="_blank" rel="noopener">代码重构</a></p>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>WhatBuddhaSay?</title>
      <link href="/2014/08/26/Tao-2014-2014-08-26-WhatBuddhaSay/"/>
      <url>/2014/08/26/Tao-2014-2014-08-26-WhatBuddhaSay/</url>
      <content type="html"><![CDATA[<h1 id="《佛祖都说了些什么》"><a href="#《佛祖都说了些什么》" class="headerlink" title="《佛祖都说了些什么》"></a>《佛祖都说了些什么》</h1><p><img src="http://img5.douban.com/mpic/s27349059.jpg" alt="img"></p><p>《佛祖都说了些什么》这本算佛教的入门书，对我这种想系统地了解下佛教的人来说，还是不错的。</p><p>佛教有两大基本原理：<em>万法缘起（哲学）、轮回（神学）</em>。</p><p>我个人比较buy哲学角度的万法缘起，对于轮回就。。<br>很多理念了解起来还是挺有意思的，如三千世界。<br>同时也介绍了各个学派以及主要的代表人物。</p><p><a href="/img/2014/WhatBuddhaSay.png" target="_blank"><br><img src="/img/2014/WhatBuddhaSay.png" alt="img"><br></a></p><h2 id="两大原理"><a href="#两大原理" class="headerlink" title="两大原理"></a>两大原理</h2><p><a href="/img/2014/WhatBuddhaSay-1.png" target="_blank"><br><img src="/img/2014/WhatBuddhaSay-1.png" alt="img"><br></a></p><h2 id="学派"><a href="#学派" class="headerlink" title="学派"></a>学派</h2><p><a href="/img/2014/WhatBuddhaSay-2.png" target="_blank"><br><img src="/img/2014/WhatBuddhaSay-2.png" alt="img"><br></a></p><h2 id="主要代表人物"><a href="#主要代表人物" class="headerlink" title="主要代表人物"></a>主要代表人物</h2><p><a href="/img/2014/WhatBuddhaSay-3.png" target="_blank"><br><img src="/img/2014/WhatBuddhaSay-3.png" alt="img"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">* 两大原理</span><br><span class="line">** 万法缘起 （哲学）</span><br><span class="line">   万事万物都是因为一定的原因产生的</span><br><span class="line">*** 因缘</span><br><span class="line">    因是内因，缘是外因</span><br><span class="line">*** 法无自性，万法无常</span><br><span class="line">**** 无常</span><br><span class="line">     事物处于一直变化的状态中，不能永恒存在。</span><br><span class="line">**** 无我</span><br><span class="line">     我也是无常，有生有灭</span><br><span class="line">*** 凡人执著心</span><br><span class="line">**** 法执</span><br><span class="line">     认为万物实有</span><br><span class="line">**** 我执</span><br><span class="line">     认为我实有</span><br><span class="line">*** 空</span><br><span class="line">    事物的本质，就是佛性</span><br><span class="line">**** 色即是空</span><br><span class="line">**** 破除时间与空间概念</span><br><span class="line">** 轮回 （神学）</span><br><span class="line">*** 六道轮回</span><br><span class="line">    一切皆苦，六道既苦海</span><br><span class="line">*** 因果报应</span><br><span class="line">    菩萨畏因，众生畏果。</span><br><span class="line">**** 业 </span><br><span class="line">     众生所做的事</span><br><span class="line">**** 报 （果）</span><br><span class="line">     业按照因缘规律产生的后果</span><br><span class="line">***** 三报</span><br><span class="line">      现报，生报，后报</span><br><span class="line">*** 涅磐</span><br><span class="line">    跳出轮回</span><br><span class="line">**** 修行方法</span><br><span class="line">***** 戒</span><br><span class="line">      遵守戒律</span><br><span class="line">***** 定</span><br><span class="line">      打坐禅定</span><br><span class="line">***** 慧 （最重要）</span><br><span class="line">      开启智慧，不再无明。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">* 学派</span><br><span class="line">** 大乘 （万法性空）</span><br><span class="line">   主张普度众生，帮助他人修行</span><br><span class="line">   人人都能成佛，领悟佛性即可。</span><br><span class="line">*** 中观学</span><br><span class="line">    中观般若，类似辩证唯物主义，般若学的高峰。 </span><br><span class="line">    （般若，梵语“智慧”。 ）  </span><br><span class="line">**** 假有</span><br><span class="line">     事物存在，但不远存不变。</span><br><span class="line">**** 八不中道</span><br><span class="line">     不生亦不灭，不常亦不断。</span><br><span class="line">     不一亦不异，不来亦不出。</span><br><span class="line">**** 真俗二谛义</span><br><span class="line">     真谛，真正的真理，是不能用语言直接表达。</span><br><span class="line">     俗谛， 世俗的道理。 </span><br><span class="line">*** 唯识学</span><br><span class="line">    瑜伽唯识，类似主观唯心主义</span><br><span class="line">**** 六识（六根）</span><br><span class="line">     眼，耳，鼻，舌，身，意 </span><br><span class="line">**** 末那识 （第七）</span><br><span class="line">     产生我的概念 </span><br><span class="line">**** 阿赖耶识 （第八）</span><br><span class="line">      其他<span class="number">7</span>识都是无明，造业的结果，本质是空的。</span><br><span class="line">      破除七识就能成佛。</span><br><span class="line">***** ..主体</span><br><span class="line">      众生的，轮回的.</span><br><span class="line">***** 共相</span><br><span class="line">      众人阿赖耶识共同作用</span><br><span class="line">**** 赖耶缘起</span><br><span class="line">     阿赖耶识产生万物</span><br><span class="line">*** 天台宗</span><br><span class="line">**** 三千世界</span><br><span class="line">     一念三千</span><br><span class="line">***** 十界互具</span><br><span class="line">      十如是</span><br><span class="line">***** 三世间</span><br><span class="line">      一念三世</span><br><span class="line">**** 佛是“性具善恶”</span><br><span class="line">     但不为之所控制</span><br><span class="line">**** 无情有性</span><br><span class="line">     所有物体都有佛性</span><br><span class="line">**** 三谛圆融 （空 假 中）</span><br><span class="line">     因缘所生法，我说即是空，亦为是假名，亦是中道义。</span><br><span class="line">*** 华严宗</span><br><span class="line">**** 一即一切，一切即一</span><br><span class="line">**** 一真法界</span><br><span class="line">     万物是互为因果的一体</span><br><span class="line">**** 法界缘起</span><br><span class="line">     以不起为起</span><br><span class="line">*** 禅宗</span><br><span class="line">**** 饥来吃饭，困来即眠</span><br><span class="line">**** 反对文字、理性</span><br><span class="line">**** 即心即佛</span><br><span class="line">*** 净土宗</span><br><span class="line">**** 往生净土</span><br><span class="line">     《往生咒》</span><br><span class="line">**** 注重佛号</span><br><span class="line">*** 密宗</span><br><span class="line">**** 灌顶</span><br><span class="line">**** 修炼方法</span><br><span class="line">     身密、口密、意密</span><br><span class="line">** 小乘 （万法实有）</span><br><span class="line">*** 只讲自己修行</span><br><span class="line">*** 普通人不能成佛</span><br><span class="line">*** 不持金银</span><br><span class="line">*** 类型</span><br><span class="line">**** 佛</span><br><span class="line">***** 阿尼陀佛</span><br><span class="line">**** 菩萨 （大乘）</span><br><span class="line">     建立净土</span><br><span class="line">***** 观世音</span><br><span class="line">***** 弥勒佛</span><br><span class="line">**** 罗汉</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">* 主要代表人物</span><br><span class="line">** 释迦牟尼 </span><br><span class="line">** 龙树 （中观）</span><br><span class="line">*** 人法两空</span><br><span class="line">*** 八不中道</span><br><span class="line">** 道安</span><br><span class="line">*** 不依国主，法事难立</span><br><span class="line">*** 反对格义</span><br><span class="line">*** 出家</span><br><span class="line">** 慧远 （道安徒弟）</span><br><span class="line">*** 三报论</span><br><span class="line">*** 不敬王者</span><br><span class="line">*** 形尽神不灭</span><br><span class="line">** 鸠摩罗什</span><br><span class="line">*** 翻译佛经</span><br><span class="line">** 道生</span><br><span class="line">*** 顿悟成佛</span><br><span class="line">*** 善不受报</span><br><span class="line">*** 一阐提也能成佛</span><br><span class="line">** 玄奘 （唯识）</span><br><span class="line">*** 求取《瑜伽师地论》</span><br><span class="line">*** 一阐提不能成佛</span><br><span class="line">** 慧能 （南禅，禅宗创始人）</span><br><span class="line">*** 本来无一物，何处惹尘埃</span><br><span class="line">*** 反对坐禅、依赖佛经</span><br><span class="line">** 神秀 （北禅）</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Tao </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Buddha </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Why DDD?</title>
      <link href="/2014/08/24/Art-2014-2014-08-24-IDDD/"/>
      <url>/2014/08/24/Art-2014-2014-08-24-IDDD/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-为什么DDD？"><a href="#lt-lt-实现领域驱动设计-gt-gt-为什么DDD？" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 为什么DDD？"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 为什么DDD？</h1><p><img src="http://img5.douban.com/mpic/s2336739.jpg" alt="img"><br><img src="http://img5.douban.com/mpic/s27236377.jpg" alt="img"></p><p>《领域驱动设计 : 软件核心复杂性应对之道》（DDD）于06年出版的时候，经过8年时间的演化，<br>DDD也开始添加一些新的内容，《实现领域驱动设计》（IDDD）正是对其做了很好的补充。</p><p>作为一个OO思维的工程师，我觉得对OO的领悟分为三个阶段：</p><pre><code>一、开始使用面向对象    摆脱面向过程的思维影响，用更自然的角度去思考问题。    面向对象，用类和接口去封装对象的行为。二、开始使用设计模式    模式一词来自亚历山大的《建筑的永恒之道》，使用模式是为了得到无名之质。    由Gof引入到软件行业，于是有了著名的《设计模式》一书。    设计模式进一步去除设计上的重复，着重解决一些经典的问题。三、开始使用领域设计    领域概念的出现，是为了把业务从其他非业务（技术实现）的泥团之中分离出来。    把所有跟业务有关的知识封装于领域之内,实现业务与实现的解耦。    从而避免出现贫血对象，避免业务逻辑四分八裂在系统之中，与页面和数据库深深的耦合在一起。</code></pre><p>IDDD对DDD进行了很好的补充：<br>    增加了领域事件的概念，也增加了实际应用中会遇到的问题和解决方案。<br>    《实现领域驱动设计》在DDD 的思想和实现之间建立起了一座桥梁，架构师和程序员均可阅读，同时也可以作为一本DDD 参考书。</p><p><a href="/img/2014/0824-IDDD.png" target="_blank"><br><img src="/img/2014/0824-IDDD.png" alt="img"><br></a></p><h2 id="章节内容"><a href="#章节内容" class="headerlink" title="章节内容:"></a>章节内容:</h2><h2 id="一-DDD入门"><a href="#一-DDD入门" class="headerlink" title="一 : DDD入门"></a><a href="/art/2014/07/18/IDDD_1.html">一 : DDD入门</a></h2><h2 id="二-领域、子域和限界上下文"><a href="#二-领域、子域和限界上下文" class="headerlink" title="二 : 领域、子域和限界上下文"></a><a href="/art/2014/07/20/IDDD_2.html">二 : 领域、子域和限界上下文</a></h2><h2 id="三-上下文映射图"><a href="#三-上下文映射图" class="headerlink" title="三 : 上下文映射图"></a><a href="/art/2014/07/20/IDDD_3.html">三 : 上下文映射图</a></h2><h2 id="四-架构"><a href="#四-架构" class="headerlink" title="四 : 架构"></a><a href="/art/2014/07/23/IDDD_4.html">四 : 架构</a></h2><h2 id="五-实体"><a href="#五-实体" class="headerlink" title="五: 实体"></a><a href="/art/2014/07/26/IDDD_5.html">五: 实体</a></h2><h2 id="六-值对象"><a href="#六-值对象" class="headerlink" title="六: 值对象"></a><a href="/art/2014/07/27/IDDD_6.html">六: 值对象</a></h2><h2 id="七-领域服务"><a href="#七-领域服务" class="headerlink" title="七: 领域服务"></a><a href="/art/2014/07/27/IDDD_7.html">七: 领域服务</a></h2><h2 id="八-领域事件"><a href="#八-领域事件" class="headerlink" title="八: 领域事件"></a><a href="/art/2014/07/31/IDDD_8.html">八: 领域事件</a></h2><h2 id="九-模块"><a href="#九-模块" class="headerlink" title="九: 模块"></a><a href="/art/2014/07/31/IDDD_9.html">九: 模块</a></h2><h2 id="十-聚合"><a href="#十-聚合" class="headerlink" title="十: 聚合"></a><a href="/art/2014/08/01/IDDD_10.html">十: 聚合</a></h2><h2 id="十一-工厂"><a href="#十一-工厂" class="headerlink" title="十一: 工厂"></a><a href="/art/2014/08/04/IDDD_11.html">十一: 工厂</a></h2><h2 id="十二-资源库"><a href="#十二-资源库" class="headerlink" title="十二: 资源库"></a><a href="/art/2014/08/15/IDDD_12.html">十二: 资源库</a></h2><h2 id="十三-集成限界上下文"><a href="#十三-集成限界上下文" class="headerlink" title="十三: 集成限界上下文"></a><a href="/art/2014/08/18/IDDD_13.html">十三: 集成限界上下文</a></h2><h2 id="十四-应用程序"><a href="#十四-应用程序" class="headerlink" title="十四: 应用程序"></a><a href="/art/2014/08/19/IDDD_14.html">十四: 应用程序</a></h2>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 14 Application</title>
      <link href="/2014/08/19/Art-2014-2014-08-19-IDDD-14/"/>
      <url>/2014/08/19/Art-2014-2014-08-19-IDDD-14/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-十四-应用程序"><a href="#lt-lt-实现领域驱动设计-gt-gt-十四-应用程序" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 十四: 应用程序"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 十四: 应用程序</h1><pre><code>应用程序通过用户界面向外展示领域模型的概念，并允许用户在模型上执行各种操作。</code></pre><p><a href="/img/2014/0819-IDDD_14.png" target="_blank"><br><img src="/img/2014/0819-IDDD_14.png" alt="img"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 应用程序</span><br><span class="line">  应用程序通过用户界面向外展示领域模型的概念，并允许用户在模型上执行各种操作。</span><br><span class="line">** 用户界面</span><br><span class="line">*** 类型</span><br><span class="line">**** Web界面</span><br><span class="line">***** Web <span class="number">1.0</span></span><br><span class="line">      纯粹请求-应答式，Struts，Spring MVC，ASP.net等。</span><br><span class="line">***** Web <span class="number">2.0</span></span><br><span class="line">      富互联网应用，使用Ajax和DHTML，</span><br><span class="line">      eg：Google GWT，Ext JS，Adobe Flex，MS Silverlight等。</span><br><span class="line">**** 本地客户端GUI</span><br><span class="line">     Java Swing，WinForm，WPF等。</span><br><span class="line">*** 渲染</span><br><span class="line">**** ..领域对象</span><br><span class="line">***** 使用调停者模式解耦</span><br><span class="line">**** ..数据传输对象</span><br><span class="line">     渲染多个聚合实例</span><br><span class="line">**** 领域负载对象..</span><br><span class="line">     整个聚合实例的引用</span><br><span class="line">**** 处理不同的客户端</span><br><span class="line">***** RIA</span><br><span class="line">***** 图像界面</span><br><span class="line">***** REST服务</span><br><span class="line">***** 消息系统</span><br><span class="line">**** 渲染适配器</span><br><span class="line">     处理用户编辑</span><br><span class="line">** 应用服务</span><br><span class="line">*** 解耦服务输出</span><br><span class="line">    六边形架构</span><br><span class="line">** 基础设施</span><br><span class="line">   为应用程序的其他部分提供技术支持。</span><br><span class="line">*** 使用依赖倒置原则解耦</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 13 Integrate Bounded Context</title>
      <link href="/2014/08/18/Art-2014-2014-08-18-IDDD-13/"/>
      <url>/2014/08/18/Art-2014-2014-08-18-IDDD-13/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-十三-集成限界上下文"><a href="#lt-lt-实现领域驱动设计-gt-gt-十三-集成限界上下文" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 十三: 集成限界上下文"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 十三: 集成限界上下文</h1><pre><code>在上下文映射图中，多个限界上下文之间需要进行集成。</code></pre><p><a href="/img/2014/0818-IDDD_13.png" target="_blank"><br><img src="/img/2014/0818-IDDD_13.png" alt="img"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 集成限界上下文</span><br><span class="line">  在上下文映射图中，多个限界上下文之间需要进行集成。</span><br><span class="line">** 集成基础</span><br><span class="line">*** 分布式计算原则</span><br><span class="line">    与RPC有着根本性区别</span><br><span class="line">**** 网络是不可靠的</span><br><span class="line">**** 总会存在时间延迟，有时非常严重</span><br><span class="line">**** 带宽是有限的</span><br><span class="line">**** 不要假设网络是安全的</span><br><span class="line">**** 网络拓扑结构将发生变化</span><br><span class="line">**** 知识和政策在多个管理员之间传播</span><br><span class="line">**** 网络传输是有成本的</span><br><span class="line">**** 网络是异构的</span><br><span class="line">*** 跨系统边界交换信息</span><br><span class="line">**** 创建某种形式的消息契约</span><br><span class="line">***** XML</span><br><span class="line">***** JSON</span><br><span class="line">***** 特殊格式</span><br><span class="line">***** 发布语言</span><br><span class="line">** 集成类型</span><br><span class="line">*** 通过REST</span><br><span class="line">**** 服务器端--开放主机服务</span><br><span class="line">**** 客户端--防腐层实现</span><br><span class="line">*** 通过消息</span><br><span class="line">**** 事件驱动架构</span><br><span class="line">**** 长时间处理过程</span><br><span class="line">***** 消息幂等</span><br><span class="line">***** 状态机</span><br><span class="line">***** 超时跟踪器</span><br><span class="line">**** 当消息机制或系统不可用时</span><br><span class="line">     考虑最差后果，以及对策</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 12 Repository</title>
      <link href="/2014/08/15/Art-2014-2014-08-15-IDDD-12/"/>
      <url>/2014/08/15/Art-2014-2014-08-15-IDDD-12/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-十二-资源库"><a href="#lt-lt-实现领域驱动设计-gt-gt-十二-资源库" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 十二: 资源库"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 十二: 资源库</h1><pre><code>资源库表示一个安全的存储区域，对其存品起保护作用。负责对象生命周期的中后期。</code></pre><p><a href="/img/2014/0815-IDDD_12.png" target="_blank"><br><img src="/img/2014/0815-IDDD_12.png" alt="img"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 资源库</span><br><span class="line">  表示一个安全的存储区域，对其存品起保护作用。</span><br><span class="line">  负责对象生命周期的中后期。</span><br><span class="line">** 面向..资源库</span><br><span class="line">*** 集合</span><br><span class="line">    模拟一个Set集合，不容许多次添加同一个聚合实例。</span><br><span class="line">    隐式跟踪每个持久化对象的改变。</span><br><span class="line">**** Hibernate实现</span><br><span class="line">**** TopLink实现</span><br><span class="line">*** 持久化</span><br><span class="line">    不支持对象变化的跟踪。</span><br><span class="line">**** Coherence实现</span><br><span class="line">**** MongoDB实现</span><br><span class="line">** 额外的行为</span><br><span class="line">   特殊的查找方法，返回值对象的查询结果。</span><br><span class="line">** 管理事务</span><br><span class="line">*** 针对关系型数据库，把事务放在应用层。</span><br><span class="line">*** 不要过度使用，特别在并发的环境下。</span><br><span class="line">** 类型层级</span><br><span class="line">*** Liskov替换原则</span><br><span class="line">** vs. 数据访问对象（DAO）</span><br><span class="line">*** DAO是从数据库的角度来看待问题</span><br><span class="line">*** Repository是从对象的角度来看待问题</span><br><span class="line">** 测试</span><br><span class="line">*** 以内存实现进行测试</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 11 Factory</title>
      <link href="/2014/08/04/Art-2014-2014-08-04-IDDD-11/"/>
      <url>/2014/08/04/Art-2014-2014-08-04-IDDD-11/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-十一-工厂"><a href="#lt-lt-实现领域驱动设计-gt-gt-十一-工厂" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 十一: 工厂"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 十一: 工厂</h1><pre><code>最经典的设计模式之一，负责复杂对象和聚合的创建，对象生命周期的前期. </code></pre><p><a href="/img/2014/0804-IDDD_11.png" target="_blank"><br><img src="/img/2014/0804-IDDD_11.png" alt="Alt text"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 工厂</span><br><span class="line">  最经典的设计模式之一，负责复杂对象和聚合的创建，对象生命周期的前期。</span><br><span class="line">** 领域模型中的工厂</span><br><span class="line">*** 只需要创建对象，不需要承担领域模型中的其他职责。</span><br><span class="line">** 聚合根中的工厂方法</span><br><span class="line">*** 有效表达限界上下文中的通用语言</span><br><span class="line">*** 减轻客户端创建实例时的负担</span><br><span class="line">*** 确保所创建的实例处于正确的状态</span><br><span class="line">** 领域服务中的工厂</span><br><span class="line">*** 集成</span><br><span class="line">**** 限界上下文</span><br><span class="line">**** 防腐层</span><br><span class="line">**** 发布语言</span><br><span class="line">**** 开发主机服务</span><br><span class="line">*** 与其他限界上下文交互</span><br><span class="line">*** 将外部对象翻译成本地对象</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 10 Aggregate</title>
      <link href="/2014/08/01/Art-2014-2014-08-01-IDDD-10/"/>
      <url>/2014/08/01/Art-2014-2014-08-01-IDDD-10/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-十-聚合"><a href="#lt-lt-实现领域驱动设计-gt-gt-十-聚合" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 十: 聚合"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 十: 聚合</h1><pre><code>聚合由实体和值对象在一致性边界内组成，却是最不容易理解的。 </code></pre><p><a href="/img/2014/0801-IDDD_10.png" target="_blank"><br><img src="/img/2014/0801-IDDD_10.png" alt="Alt text"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 聚合</span><br><span class="line">** 原则</span><br><span class="line">*** 在一致性边界内建模真正的不变条件</span><br><span class="line">**** 不变的业务规则</span><br><span class="line">**** 事务一致性</span><br><span class="line">**** 一致性边界</span><br><span class="line">*** 设计小聚合</span><br><span class="line">**** 更好性能和伸缩性</span><br><span class="line">**** 根实体</span><br><span class="line">     Root Entity</span><br><span class="line">*** 通过唯一标识引用其他聚合</span><br><span class="line">**** 通过标识引用使多个聚合协调工作</span><br><span class="line">**** 建模对象导航性</span><br><span class="line">***** 失联领域模型</span><br><span class="line">      （Disconnected Domain Model）</span><br><span class="line">****** 资源库</span><br><span class="line">****** 领域服务</span><br><span class="line">***** 通过应用服务来处理依赖关系</span><br><span class="line">**** 不在同个事务中修改多个聚合实例</span><br><span class="line">*** 在边界之外使用最终一致性</span><br><span class="line">**** 由边界内来控制一致性 — — 事务一致性</span><br><span class="line">**** 由边界外来控制一致性 — — 最终一致性</span><br><span class="line">** 打破原则的理由</span><br><span class="line">   有很多因素需要我们做出妥协，但不应该找各种借口来打破原则。</span><br><span class="line">*** 方便用户界面</span><br><span class="line">*** 缺乏技术支持</span><br><span class="line">*** 全局事务</span><br><span class="line">*** 查询性能</span><br><span class="line">** 通过发现，深入理解</span><br><span class="line">*** 重新思考设计</span><br><span class="line">*** 估算聚合成本</span><br><span class="line">*** 常用用例场景</span><br><span class="line">*** 内存消耗</span><br><span class="line">*** 探索另外的设计</span><br><span class="line">*** 实现最终一致性</span><br><span class="line">** 实现</span><br><span class="line">*** 创建具有唯一标识的根实体</span><br><span class="line">    将实体建模成聚合根（Aggregate Root）</span><br><span class="line">*** 优先使用值对象</span><br><span class="line">*** 迪米特法则和“告诉非询问”原则</span><br><span class="line">**** Law of Dememter</span><br><span class="line">***** “最小知识”原则</span><br><span class="line">***** 任何对象的任何方法只能调用</span><br><span class="line">****** 自身</span><br><span class="line">****** 传入的参数对象</span><br><span class="line">****** 它所创建的对象</span><br><span class="line">****** 自身包含的其他对象，并且拥有直接访问权</span><br><span class="line">**** Tell, Dont Ask</span><br><span class="line">***** 一个对象不应该被告知该怎么做</span><br><span class="line">*** 乐观并发</span><br><span class="line">**** 为根实体创建版本号</span><br><span class="line">**** 合理控制版本号</span><br><span class="line">*** 避免依赖注入</span><br><span class="line">**** 在聚合内注入 资源库/领域服务 有害，可在应用服务中使用</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 9 Module</title>
      <link href="/2014/07/31/Art-2014-2014-07-31-IDDD-9/"/>
      <url>/2014/07/31/Art-2014-2014-07-31-IDDD-9/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-九-模块"><a href="#lt-lt-实现领域驱动设计-gt-gt-九-模块" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 九: 模块"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 九: 模块</h1><pre><code>模块是命名的容器，通用语言的重要组成部分。</code></pre><p><a href="/img/2014/0731-IDDD_9.png" target="_blank"><br><img src="/img/2014/0731-IDDD_9.png" alt="Alt text"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 模块</span><br><span class="line">** Module</span><br><span class="line">*** Java</span><br><span class="line">**** package</span><br><span class="line">*** C<span class="comment">#</span></span><br><span class="line">**** <span class="keyword">namespace</span></span><br><span class="line">*** <span class="title">Ruby</span></span><br><span class="line">**** <span class="title">module</span></span><br><span class="line">** 通过模块完成设计</span><br><span class="line">*** 命名的容器</span><br><span class="line">*** 通用语言的重要组成部分</span><br><span class="line">*** 设计规则</span><br><span class="line">**** 和领域概念协调一致</span><br><span class="line">**** 根据通用语言来命名模块</span><br><span class="line">**** 不要机械式根据组件类型来创建</span><br><span class="line">     <span class="title">eg</span> 所有领域服务放在一起</span><br><span class="line">**** 松耦合</span><br><span class="line">**** 杜绝循环依赖</span><br><span class="line">**** 父子模块放松原则</span><br><span class="line">**** 不是静态概念，与模型的对象一道进行建模</span><br><span class="line">** 模块的基本命名规范</span><br><span class="line">*** 层级形式命名</span><br><span class="line">*** 避免顶级模块名与第三方模块命名冲突</span><br><span class="line">** 领域模型的命名规范</span><br><span class="line">*** 加入限界上下文名</span><br><span class="line">*** *.domain.model</span><br><span class="line">** 其他层的模块</span><br><span class="line">*** 分层架构命名</span><br><span class="line">*** 需要时才划分子模块</span><br><span class="line">** 先考虑模块，再考虑上下文</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 8 DomainEvent</title>
      <link href="/2014/07/31/Art-2014-2014-07-31-IDDD-8/"/>
      <url>/2014/07/31/Art-2014-2014-07-31-IDDD-8/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-八-领域事件"><a href="#lt-lt-实现领域驱动设计-gt-gt-八-领域事件" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 八: 领域事件"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 八: 领域事件</h1><pre><code>用于捕获发生在领域内，领域专家所关心的一些事情</code></pre><p><a href="/img/2014/0731-IDDD_8.png" target="_blank"><br><img src="/img/2014/0731-IDDD_8.png" alt="img"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 领域事件</span><br><span class="line">  用于捕获发生在领域内，领域专家所关心的一些事情</span><br><span class="line">** 何时/为什么使用？</span><br><span class="line">*** 当。。。的时候。。</span><br><span class="line">*** 通用语言的正式成员</span><br><span class="line">** 建模</span><br><span class="line">*** 创建具有聚合特征的</span><br><span class="line">**** 发生在过去的事情</span><br><span class="line">**** 应设计成不变的，但拥有唯一标识</span><br><span class="line">*** 身份标识</span><br><span class="line">**** 方便比较</span><br><span class="line">**** 需要发布在外部限界上下文时，唯一标识是必要的</span><br><span class="line">** 发布</span><br><span class="line">*** 从领域模型中发布</span><br><span class="line">**** 观察者模式</span><br><span class="line">***** 发送方</span><br><span class="line">      由聚合创建，并发布出去</span><br><span class="line">***** 订阅方</span><br><span class="line">      由应用/领域服务，向领域事件注册订阅</span><br><span class="line">      与聚合位于相同线程内</span><br><span class="line">*** 向远程限界上下文发布</span><br><span class="line">**** 消息设施的一致性</span><br><span class="line">     最终一致性</span><br><span class="line">***** 领域模型和消息设施，共享持久化存储</span><br><span class="line">***** 领域模型的持久化存储和消息持久化存储，由全局XA事务（两段提交）所控制</span><br><span class="line">***** 领域模型的持久化存储中，创建特殊的存储区域，即事件存储</span><br><span class="line">**** 自治服务和系统</span><br><span class="line">***** 通过领域事件，将任何系统设计成自治服务和系统</span><br><span class="line">***** 避免远程过程调用（RPC）</span><br><span class="line">**** 容许时延</span><br><span class="line">     长时间的事件延迟有可能发生</span><br><span class="line">** 事件存储</span><br><span class="line">*** 作为消息队列使用，将所有领域事件发布出去</span><br><span class="line">*** 基于REST的事件通知</span><br><span class="line">*** 跟踪bug</span><br><span class="line">*** 业务分析和预测</span><br><span class="line">*** 重建聚合</span><br><span class="line">*** 撤销操作</span><br><span class="line">** (向外部)转发存储事件的架构风格</span><br><span class="line">*** 发布事件通知</span><br><span class="line">**** 以REST资源的方式</span><br><span class="line">***** “拉”的方式，非“推”的方式</span><br><span class="line">***** 不能很好支持有顺序的接收</span><br><span class="line">**** 通过消息中间件</span><br><span class="line">** 实现</span><br><span class="line">*** 发布NotifiactionLog</span><br><span class="line">*** 发布基于消息的事件通知</span><br><span class="line">**** 事件消重</span><br><span class="line">***** 幂等操作</span><br><span class="line">      进行多次重复操作和只进行一次操作所产生的结果相同.</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 7 DomainService</title>
      <link href="/2014/07/27/Art-2014-2014-07-27-IDDD-7/"/>
      <url>/2014/07/27/Art-2014-2014-07-27-IDDD-7/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-七-领域服务"><a href="#lt-lt-实现领域驱动设计-gt-gt-七-领域服务" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 七: 领域服务"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 七: 领域服务</h1><pre><code>领域服务是用于处理业务逻辑，无状态的操作。确定是否需要使用，不要滥用，滥用导致贫血模型。</code></pre><p><a href="/img/2014/0727-IDDD_7.png" target="_blank"><br><img src="/img/2014/0727-IDDD_7.png" alt="img"><br></a></p><h2 id="MindMapping-Source-Org-Format"><a href="#MindMapping-Source-Org-Format" class="headerlink" title="MindMapping Source (Org Format):"></a>MindMapping Source (Org Format):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 领域服务</span><br><span class="line">** 什么是？</span><br><span class="line">*** 无状态的操作</span><br><span class="line">*** 处理业务逻辑</span><br><span class="line">** 什么不是？</span><br><span class="line">*** 不是应用服务</span><br><span class="line">    SOA，RPC，MoM</span><br><span class="line">** 确定是否需要？</span><br><span class="line">   不要滥用，滥用导致贫血模型</span><br><span class="line">** 建模</span><br><span class="line">*** 独立接口有必要？</span><br><span class="line">    没有，不会有另外的实现类的时候不必要</span><br><span class="line">*** 一个计算过程</span><br><span class="line">    业务逻辑绝不放在应用层</span><br><span class="line">*** 转换服务</span><br><span class="line">    用于集成限界上下文</span><br><span class="line">*** 创建迷你层</span><br><span class="line">    取决领域模型特征</span><br><span class="line">*** 测试</span><br><span class="line">    从客户端角度</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 6 ValueObject</title>
      <link href="/2014/07/27/Art-2014-2014-07-27-IDDD-6/"/>
      <url>/2014/07/27/Art-2014-2014-07-27-IDDD-6/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-六-值对象"><a href="#lt-lt-实现领域驱动设计-gt-gt-六-值对象" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 六: 值对象"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 六: 值对象</h1><pre><code>值对象易于开发、测试和维护。尽量使用值对象来建模，而不是实体。</code></pre><p><a href="/img/2014/0727-IDDD_6.png" target="_blank"><br><img src="/img/2014/0727-IDDD_6.png" alt="img"><br></a></p><h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 值对象</span><br><span class="line">** 特征</span><br><span class="line">*** 度量或描述</span><br><span class="line">    度量或描述领域中的一件东西</span><br><span class="line">*** 不变性</span><br><span class="line">**** 只读，创建后不改变</span><br><span class="line">**** 只通过构造函数赋值</span><br><span class="line">*** 概念整体</span><br><span class="line">**** 整体值对象</span><br><span class="line">     （Whole Value aka Value Object）</span><br><span class="line">*** 可替换性</span><br><span class="line">*** 相等性</span><br><span class="line">*** 无副作用行为</span><br><span class="line">**** 无副作用函数</span><br><span class="line">     （Side-Effect-Free <span class="function"><span class="keyword">Function</span>)</span></span><br><span class="line"><span class="function">** 最小化集成</span></span><br><span class="line"><span class="function">*** 更少的职责假设</span></span><br><span class="line"><span class="function">** 表示标准类型</span></span><br><span class="line"><span class="function">*** <span class="title">Java</span>里可用枚举来表示</span></span><br><span class="line"><span class="function">** 测试</span></span><br><span class="line"><span class="function">*** <span class="title">TDD</span></span></span><br><span class="line"><span class="function">** 实现</span></span><br><span class="line"><span class="function">*** 2个构造函数</span></span><br><span class="line"><span class="function">**** 1.接受所有参数的</span></span><br><span class="line"><span class="function">**** 2.浅复制其他值对象的</span></span><br><span class="line"><span class="function">     （<span class="title">Shallow</span> <span class="title">Copy</span>）</span></span><br><span class="line"><span class="function">** 持久化</span></span><br><span class="line"><span class="function">*** 拒绝数据建模泄露</span></span><br><span class="line"><span class="function">**** 数据建模式次要的</span></span><br><span class="line"><span class="function">     根据领域模型来设计数据模型，</span></span><br><span class="line"><span class="function">     而不是根据数据模型来设计领域模型</span></span><br><span class="line"><span class="function">*** 与<span class="title">ORM</span></span></span><br><span class="line"><span class="function">**** 单个值对象</span></span><br><span class="line"><span class="function">***** 直接映射</span></span><br><span class="line"><span class="function">**** 保存多个值对象</span></span><br><span class="line"><span class="function">***** 序列化到单个列</span></span><br><span class="line"><span class="function">****** 缺点</span></span><br><span class="line"><span class="function">******* 列宽限制</span></span><br><span class="line"><span class="function"><span class="title">MySQL</span> <span class="title">Varchar</span> <span class="title">limit</span> ：65535</span></span><br><span class="line"><span class="function">******* 不能查询</span></span><br><span class="line"><span class="function">其内在属性不能作为<span class="title">SQl</span>查询条件</span></span><br><span class="line"><span class="function">******* 需自定义类型</span></span><br><span class="line"><span class="function">***** 使用数据库实体</span></span><br><span class="line"><span class="function">****** 缺点</span></span><br><span class="line"><span class="function">******* 对象-关系抗阻</span></span><br><span class="line"><span class="function">***** 使用联合表</span></span><br><span class="line"><span class="function">****** 缺点</span></span><br><span class="line"><span class="function">******* 需满足数据库范式</span></span><br><span class="line"><span class="function">******* 每一个属性都不应该为<span class="title">NULL</span></span></span><br><span class="line"><span class="function">******* 不能包含嵌套的集合</span></span><br><span class="line"><span class="function">**** 枚举状态对象</span></span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 5 Entity</title>
      <link href="/2014/07/26/Art-2014-2014-07-26-IDDD-5/"/>
      <url>/2014/07/26/Art-2014-2014-07-26-IDDD-5/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-五-实体"><a href="#lt-lt-实现领域驱动设计-gt-gt-五-实体" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 五: 实体"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 五: 实体</h1><p>实体是有着生命周期的领域对象，拥有唯一标识。</p><p><a href="/img/2014/0726-IDDD_5.png" target="_blank"><br><img src="/img/2014/0726-IDDD_5.png" alt="img"><br></a></p><h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">* 实体</span><br><span class="line">** 为什么使用？</span><br><span class="line">*** 唯一的身份标识</span><br><span class="line">*** 生命周期</span><br><span class="line">（可变性，状态变化）</span><br><span class="line">** 唯一标识</span><br><span class="line">*** 生成方式</span><br><span class="line">（从简单到复杂）</span><br><span class="line">**** 用户提供</span><br><span class="line">***** 用户手动输入</span><br><span class="line">复杂性：在于需要用户自己生成高质量的标识</span><br><span class="line">**** 应用程序生成</span><br><span class="line">***** UUID</span><br><span class="line">Universally Unique Identifier</span><br><span class="line">***** GUID</span><br><span class="line">Globally Unique Identifier</span><br><span class="line">**** 持久化机制生成</span><br><span class="line">***** DB 自增列机制</span><br><span class="line">**** 另一个限界上下文提供</span><br><span class="line">*** 标识生成时间</span><br><span class="line">**** 对象创建时</span><br><span class="line">**** 持久化对象时</span><br><span class="line">*** 委派标识</span><br><span class="line">**** 层超类型</span><br><span class="line">Layer Supertype</span><br><span class="line">*** 标识稳定性</span><br><span class="line">**** 确保标识不被修改</span><br><span class="line">** 发现实体</span><br><span class="line">*** 本质特征</span><br><span class="line">*** 关键行为</span><br><span class="line">*** 角色和职责</span><br><span class="line">**** 领域对象扮演多种角色</span><br><span class="line">***** 通常用接口来定义</span><br><span class="line">****** 隐藏细节</span><br><span class="line">**** 领域语言优于技术实现</span><br><span class="line">*** 创建实体</span><br><span class="line">**** 提供构造函数来初始化实体状态</span><br><span class="line">*** 验证</span><br><span class="line">**** 目的</span><br><span class="line">***** 检查模型正确性</span><br><span class="line">**** 验证属性</span><br><span class="line">***** 自封装</span><br><span class="line">（<span class="keyword">Self</span>-Encapsulation）</span><br><span class="line">**** 验证整体</span><br><span class="line">***** 规格</span><br><span class="line">Specification</span><br><span class="line">***** 策略模式</span><br><span class="line">（Strategy）</span><br><span class="line">***** 延迟验证</span><br><span class="line">      （Deferred Validation）</span><br><span class="line">**** 验证对象组合</span><br><span class="line">*** 跟踪变化</span><br><span class="line">**** 领域事件</span><br><span class="line">**** 事件存储</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 4 Architecture</title>
      <link href="/2014/07/23/Art-2014-2014-07-23-IDDD-4/"/>
      <url>/2014/07/23/Art-2014-2014-07-23-IDDD-4/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-四-架构"><a href="#lt-lt-实现领域驱动设计-gt-gt-四-架构" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 四 : 架构"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 四 : 架构</h1><pre><code>第四章内容丰富，有些骨头有待反复嚼啃。六边形架构的确很赞，新项目开始架构首选。</code></pre><p><a href="/img/2014/0721-HexagonalArchitecture.jpg" target="_blank"><br><img src="/img/2014/0721-HexagonalArchitecture.jpg" alt="img"><br></a></p><p><a href="/img/2014/0723-IDDD_4.png" target="_blank"><br><img src="/img/2014/0723-IDDD_4.png" alt="img"><br></a></p><h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 架构</span><br><span class="line">不需要特定的架构，选择架构是为了减少风险，而不增加风险。</span><br><span class="line">** 分层</span><br><span class="line">Layers Architecture</span><br><span class="line">*** 严格</span><br><span class="line">Strict Layers Architecture</span><br><span class="line">*** 松散</span><br><span class="line">Relaxed Layers Architecture</span><br><span class="line">**** 允许耦合</span><br><span class="line">***** 观察者</span><br><span class="line">Observer</span><br><span class="line">***** 调停者</span><br><span class="line">Mediator</span><br><span class="line">*** 依赖倒置原则（DIP）</span><br><span class="line">Dependency Inversion Principle </span><br><span class="line">**** 抽象不应该依赖细节</span><br><span class="line">**** 细节应该依赖抽象</span><br><span class="line">** 六边形架构</span><br><span class="line">Hexagonal Architecture, 端口与适配器</span><br><span class="line">*** 特点</span><br><span class="line">**** 对称平等,持久生命力</span><br><span class="line">**** 非前后端,而是内外区域</span><br><span class="line">**** 一个客户一个适配器</span><br><span class="line">*** 基础架构</span><br><span class="line">**** 支撑其他架构</span><br><span class="line">(SOA,REST,CQRS...)</span><br><span class="line">** SOA</span><br><span class="line">面向服务架构(Service-Oriented Architecture)</span><br><span class="line">*** 服务设计原则</span><br><span class="line">**** 契约</span><br><span class="line">通过契约文档,阐述自身的目的和功能.</span><br><span class="line">**** 松耦合</span><br><span class="line">依赖最小化</span><br><span class="line">**** 抽象</span><br><span class="line">只发布契约,隐藏内部逻辑</span><br><span class="line">**** 重用性</span><br><span class="line">可被其他服务重用</span><br><span class="line">**** 自治性</span><br><span class="line">自行控制环境与资源，以保持独立性</span><br><span class="line">**** 无状态性</span><br><span class="line">**** 可发现性</span><br><span class="line">可通过元数据来查找和理解</span><br><span class="line">**** 组合性</span><br><span class="line">** REST</span><br><span class="line">Representational State Transfer</span><br><span class="line">*** Web架构风格的一种</span><br><span class="line">**** 松耦合性</span><br><span class="line">**** 伸缩性</span><br><span class="line">*** RESTful HTTP</span><br><span class="line">**** 服务器</span><br><span class="line">***** 资源是关键概念</span><br><span class="line">每种资源拥有一个URI</span><br><span class="line">****** 与客户端交互格式</span><br><span class="line">******* XML</span><br><span class="line">******* JSON</span><br><span class="line">******* HMTL</span><br><span class="line">******* 二进制数据</span><br><span class="line">***** 无状态通信</span><br><span class="line">****** 不同请求互相独立</span><br><span class="line">****** 提高系统伸缩性</span><br><span class="line">***** 可看做对象</span><br><span class="line">****** 对象方法</span><br><span class="line">******* GET</span><br><span class="line">******* PUT</span><br><span class="line">******* POST</span><br><span class="line">******* DELETE</span><br><span class="line">**** 客户端</span><br><span class="line">***** 转移方式</span><br><span class="line">****** 超媒体</span><br><span class="line">HATEOAS : Hypermedia <span class="keyword">as</span> the Engine of Application State</span><br><span class="line">****** 服务器重定向</span><br><span class="line">*** 和DDD联合方法</span><br><span class="line">**** 为系统接口层单独创建限界上下文</span><br><span class="line">通过适当的策略来访问实际的核心模型</span><br><span class="line">***** 优先考虑</span><br><span class="line">***** 适合专属系统</span><br><span class="line">**** 使用标准媒体类型</span><br><span class="line">***** 使用通用格式</span><br><span class="line">e.g. ical</span><br><span class="line">***** 本质：共享内核/发布语言</span><br><span class="line">***** 适合通用系统</span><br><span class="line">** CQRS</span><br><span class="line">命令和查询职责分离 ： Comman-Query Responsiblity Segregation</span><br><span class="line">*** 读写分离</span><br><span class="line">**** 读模型 （查询模型）</span><br><span class="line">***** 数据库视图（可实现）</span><br><span class="line">**** 写模型 （命令模型）</span><br><span class="line">***** 每个方法完成时发布领域事件</span><br><span class="line">****** 不合法的命令将失败，不发布领域事件</span><br><span class="line">***** 事件发布器</span><br><span class="line">***** 事件订阅器</span><br><span class="line">****** 更新查询模型</span><br><span class="line">******* 同步</span><br><span class="line">******* 异步</span><br><span class="line">***** ETL</span><br><span class="line">ORM持久化机制可用数据仓库的ETL转换结果</span><br><span class="line">*** 客户端驱动命令处理</span><br><span class="line">**** 客户端向服务器发送命令</span><br><span class="line">**** 命令处理器（接收）</span><br><span class="line">只完成有限的功能</span><br><span class="line">***** 分类风格</span><br><span class="line">categorized style</span><br><span class="line">****** 根据命令类别来实现应用服务</span><br><span class="line">****** 简单：易理解、创建、维护</span><br><span class="line">***** 专属风格</span><br><span class="line">dedicated style</span><br><span class="line">****** 每种命令对应单独的类</span><br><span class="line">****** 职责单一、互相独立</span><br><span class="line">***** 消息风格</span><br><span class="line">messaging style ，专属风格进一步发展</span><br><span class="line">****** 每个命令通过异步消息发送</span><br><span class="line">异步提高伸缩性</span><br><span class="line">****** 最复杂</span><br><span class="line">*** 处理最终一致性的查询模型</span><br><span class="line">**** UI临时性显示先前提交给命令模型的参数</span><br><span class="line">**** 显式地在UI上显示当前查询模型的时间</span><br><span class="line">** EDA</span><br><span class="line">   事件驱动架构</span><br><span class="line">*** 管道与过滤器</span><br><span class="line">*** 长时间处理过程（也叫Saga）</span><br><span class="line">**** 需考虑时间敏感性</span><br><span class="line">***** 被动超时检查</span><br><span class="line">***** 主动超时检查</span><br><span class="line">**** 最终一致性</span><br><span class="line">*** 事件源</span><br><span class="line">**** 事件存储</span><br><span class="line">***** 快照</span><br><span class="line">** 数据网织和基于网格的分布式计算</span><br><span class="line">*** 数据复制</span><br><span class="line">**** 内存数据库</span><br><span class="line">*** 事件驱动网织</span><br><span class="line">**** 支持开放架构</span><br><span class="line">*** 持续查询</span><br><span class="line">*** 分布式处理</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 2 Domian,Subdomain and Bounded Context</title>
      <link href="/2014/07/20/Art-2014-2014-07-20-IDDD-2/"/>
      <url>/2014/07/20/Art-2014-2014-07-20-IDDD-2/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-二-领域、子域和限界上下文"><a href="#lt-lt-实现领域驱动设计-gt-gt-二-领域、子域和限界上下文" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 二 : 领域、子域和限界上下文 "></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 二 : 领域、子域和限界上下文 </h1><p><a href="/img/2014/0720-IDDD_2.png" target="_blank"><br><img src="/img/2014/0720-IDDD_2.png" alt="img"><br></a></p><h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 领域、子域和限界上下文</span><br><span class="line">** 领域</span><br><span class="line">（一个组织所做的事情以及其中所包含的一切）</span><br><span class="line">*** （即）核心域</span><br><span class="line">**** 关注点</span><br><span class="line">** 子域</span><br><span class="line">*** 模块</span><br><span class="line">** 限界上下文</span><br><span class="line">*** 上下文映射图</span><br><span class="line">*** 理解</span><br><span class="line">**** 显式边界</span><br><span class="line">***** “大而全”注定失败</span><br><span class="line">***** 上下文才是王道</span><br><span class="line">**** 充满语义</span><br><span class="line">**** 不仅仅只包括模型</span><br><span class="line">***** DB Schema</span><br><span class="line">***** UI</span><br><span class="line">****** 拒绝使用智能UI反模式</span><br><span class="line">（Smart UI Anti-Pattern）</span><br><span class="line">**** 大小标准</span><br><span class="line">***** 如音乐</span><br><span class="line">完整性、纯洁性、力量、优雅、美</span><br><span class="line">***** 陷阱</span><br><span class="line">****** 根据开发任务拆分限界上下文</span><br><span class="line">****** 为了架构或资源创建</span><br><span class="line">****** 急于小型化</span><br><span class="line">**** 与技术组件保持一致</span><br><span class="line">***** IDE</span><br><span class="line">****** Eclipse/IntelliJ IDEA</span><br><span class="line">******* Project</span><br><span class="line">****** VS.NET</span><br><span class="line">******* Solution</span><br><span class="line">***** Java</span><br><span class="line">****** Top Package Name</span><br><span class="line">****** JAR/WAR/EAR</span><br><span class="line">******* OSGi</span><br><span class="line">******* Jigsaw</span><br><span class="line">***** .Net</span><br><span class="line">****** DLL</span><br><span class="line">** 战略设计</span><br><span class="line">*** 为什么重要？</span><br><span class="line">**** 更广阔的视野</span><br><span class="line">**** 避免大泥球架构</span><br><span class="line">（Big Ball of Mud）</span><br><span class="line">** 现实中的领域和子域</span><br><span class="line">*** 问题空间</span><br><span class="line">（Problem Space）</span><br><span class="line">**** 核心域和其他子域的组合</span><br><span class="line">*** 解决方案空间</span><br><span class="line">（Solution Space）</span><br><span class="line">**** 一组特定的软件模型</span><br><span class="line">**** 包括一个或多限界上下文</span><br><span class="line">通常希望和子域一对一</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 3 Context Map</title>
      <link href="/2014/07/20/Art-2014-2014-07-20-IDDD-3/"/>
      <url>/2014/07/20/Art-2014-2014-07-20-IDDD-3/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-三-上下文映射图"><a href="#lt-lt-实现领域驱动设计-gt-gt-三-上下文映射图" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 三 : 上下文映射图"></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 三 : 上下文映射图</h1><pre><code>见过太多大泥球了，最后不得不另谋他路。 </code></pre><p><a href="/img/2014/0720-IDDD_3.png" target="_blank"><br><img src="/img/2014/0720-IDDD_3.png" alt="img"><br></a></p><h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">* 上下文映射图</span><br><span class="line">** 为什么重要?</span><br><span class="line">*** 反映出与<span class="string">"大泥团"</span>之间的集成关系</span><br><span class="line">*** 从解决方案空间的角度看待问题</span><br><span class="line">** 绘制</span><br><span class="line">*** [Brandolini]风格</span><br><span class="line">*** U/D</span><br><span class="line">**** 上游</span><br><span class="line">(Upstream)</span><br><span class="line">**** 下游</span><br><span class="line">(Downstream)</span><br><span class="line">*** 不是企业架构</span><br><span class="line">** 产品和组织关系</span><br><span class="line">*** 合作关系</span><br><span class="line">Partnership</span><br><span class="line">*** 共享内核 </span><br><span class="line">Shared Kernel</span><br><span class="line">*** 客户方-供应方开发</span><br><span class="line">Customer-Supplier Development</span><br><span class="line">*** 尊奉者</span><br><span class="line">Conformist</span><br><span class="line">*** 另谋他路</span><br><span class="line">Separate Way</span><br><span class="line">*** 大泥球</span><br><span class="line">Big Ball Of Mud</span><br><span class="line">*** 防腐层(ACL)</span><br><span class="line">Anticorruption Layer</span><br><span class="line">**** 领域服务</span><br><span class="line">Domain Service</span><br><span class="line">*** 开放主机服务(OHS)</span><br><span class="line">Open Host Service</span><br><span class="line">**** REST</span><br><span class="line">*** 发布语言(PL)</span><br><span class="line">Published Language</span><br><span class="line">**** REST</span><br><span class="line">***** XML</span><br><span class="line">***** JSON</span><br><span class="line">**** EDA</span><br><span class="line">事件驱动架构(Event-Driven Architecture) </span><br><span class="line">***** 领域事件</span><br><span class="line">Domain Event</span><br><span class="line">***** 最终一致性</span><br><span class="line">Eventual Consistency</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>IDDD 1 Introduce</title>
      <link href="/2014/07/18/Art-2014-2014-07-18-IDDD-1/"/>
      <url>/2014/07/18/Art-2014-2014-07-18-IDDD-1/</url>
      <content type="html"><![CDATA[<h1 id="lt-lt-实现领域驱动设计-gt-gt-一-DDD入门"><a href="#lt-lt-实现领域驱动设计-gt-gt-一-DDD入门" class="headerlink" title="&lt;&lt; 实现领域驱动设计 &gt;&gt; 一 : DDD入门 "></a>&lt;&lt; 实现领域驱动设计 &gt;&gt; 一 : DDD入门 </h1><pre><code>看了才知道，原来一直处于初级阶段 DDD-Lite。</code></pre><p><a href="/img/2014/0718-IDDD_1.png" target="_blank"><br><img src="/img/2014/0718-IDDD_1.png" alt="img"><br></a></p><h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">* <span class="type">DDD</span>入门</span><br><span class="line">** 为什么需要</span><br><span class="line">*** 难以捉摸的业务价值</span><br><span class="line">*** 处理领域复杂性</span><br><span class="line">**** 简化,非复杂化</span><br><span class="line">*** 贫血症和失忆症</span><br><span class="line">**** 贫血领域对象</span><br><span class="line">(<span class="type">Anemic</span> <span class="type">Domain</span> <span class="type">Object</span>)</span><br><span class="line">***** 缺少内在行为</span><br><span class="line">***** 设计不当造成</span><br><span class="line">** 如何<span class="type">DDD</span></span><br><span class="line">*** 通用语言</span><br><span class="line">**** 团队共享的语言</span><br><span class="line">**** 通用,不是万能</span><br><span class="line">限界内通用</span><br><span class="line">*** 限界上下文</span><br><span class="line">** 业务价值</span><br><span class="line">*** 有用的领域模型</span><br><span class="line">*** 更准确的业务定义</span><br><span class="line">*** 领域专家可参与设计</span><br><span class="line">*** 更好的用户体验</span><br><span class="line">*** 清晰的模型边界</span><br><span class="line">*** 更好的企业架构</span><br><span class="line">*** 敏捷,迭代和持续建模</span><br><span class="line">*** 使用战略和战术新工具</span><br><span class="line">** 挑战</span><br><span class="line">*** 花时间和精力:创建通用语言</span><br><span class="line">*** <span class="string">"艰难"</span>的寻找:领域专家</span><br><span class="line">*** 改变思考方式</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDD </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>About Naming</title>
      <link href="/2014/07/06/Art-2014-2014-07-06-Naming/"/>
      <url>/2014/07/06/Art-2014-2014-07-06-Naming/</url>
      <content type="html"><![CDATA[<h1 id="命名那些事"><a href="#命名那些事" class="headerlink" title="命名那些事"></a>命名那些事</h1><p>命名的方式基本有三种，<a href="http://en.wikipedia.org/wiki/CamelCase" target="_blank" rel="noopener">驼峰式</a>、<a href="http://en.wikipedia.org/wiki/Snake_case" target="_blank" rel="noopener">蛇式</a>、<a href="http://en.wikipedia.org/wiki/Hungarian_notation" target="_blank" rel="noopener">匈牙利命名法</a>。</p><p><img src="/img/2014/0706-Naming.png" alt="Alt text"></p><p>其中使用驼峰和蛇式居多，而匈牙利命名法这种方法实在是反人类。</p><p>这里引用2位大师的吐槽</p><p>Robert C. Martin:</p><blockquote><p>… nowadays HN and other forms of type encoding are simply impediments. They make it harder to change the name or type of a variable, function, member or class. They make it harder to read the code. And they create the possibility that the encoding system will mislead the reader.</p></blockquote><p>Linus Torvalds :</p><blockquote><p>Encoding the type of a function into the name (so-called Hungarian notation) is brain damaged—the compiler knows the types anyway and can check those, and it only confuses the programmer.</p></blockquote><p>在变量前面加入类型前缀这种做法没有任何帮助,只能让代码难以阅读,让大脑受伤.<br>编译器知道类型检测,无需画蛇添足.</p><h2 id="MindMapping-Source"><a href="#MindMapping-Source" class="headerlink" title="MindMapping Source:"></a>MindMapping Source:</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* Naming</span><br><span class="line">** Camel(驼峰式)</span><br><span class="line">*** lowerCamel(小驼峰)</span><br><span class="line">*** UpperCamel(大驼峰)</span><br><span class="line">    也叫Pascal (帕斯卡)</span><br><span class="line">** Snake(蛇式)</span><br><span class="line">*** snake_case</span><br><span class="line">** Hungarian(匈牙利)</span><br><span class="line">*** c_Hungarian</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Art </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>14 Years of XP</title>
      <link href="/2014/06/29/Tech-2014-2014-06-29-14Years-Of-XP/"/>
      <url>/2014/06/29/Tech-2014-2014-06-29-14Years-Of-XP/</url>
      <content type="html"><![CDATA[<h1 id="14-Years-of-XP"><a href="#14-Years-of-XP" class="headerlink" title="14 Years of XP"></a>14 Years of XP</h1><p>Bob大叔近来发表了一篇文章《<a href="http://blog.8thlight.com/uncle-bob/2013/12/10/Thankyou-Kent.html" target="_blank" rel="noopener">极限编程，一次反思</a>》（<a href="http://www.vaikan.com/extreme-programming-a-reflection/" target="_blank" rel="noopener">译</a>），总结了极限编程（XP，Extreme Programming）这14年来的变化以及发展。</p><p>回想我第一次听到XP，已经是10几年前的事情。那时候我还在读大学，刚加入学校的计算机协会，认识了一个编程多年的同学，他介绍我去看下Kent Beck的XP。我当时就想，极限编程，这么花哨的名字肯定不是什么好东西，我还是认真学好我的软件工程好过。直到我出来工作几年，慢慢的接触其中的内容，才发现当时的我是多么的纱布。</p><p>所以，当你对有一件事情有偏见的时候，就应该小心地提醒自己，是否被偏见蒙蔽的了自己，最好debug一下自己。 :)</p><p><img src="/img/2014/0629-XP.png" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* XP</span><br><span class="line">** Simple Design</span><br><span class="line">** The Planning Game</span><br><span class="line">*** Scrum</span><br><span class="line">*** Kanban</span><br><span class="line">** Testing</span><br><span class="line">*** TDD</span><br><span class="line">**** ATDD</span><br><span class="line">**** BDD</span><br><span class="line">** Small Releases</span><br><span class="line">*** Continues Delivery</span><br><span class="line">** Refactoring</span><br><span class="line">** Metaphor</span><br><span class="line">*** DDD</span><br><span class="line">** Pair Programming</span><br><span class="line">** Collective Ownership</span><br><span class="line">** 40 Hour Week</span><br><span class="line">*** Sustainable Rate</span><br><span class="line">** Coding Standards</span><br><span class="line">** On Site Customer</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Tech </category>
          
      </categories>
      
      
    </entry>
    
    <entry>
      <title>Start Change</title>
      <link href="/2014/06/17/Other-2014-2014-06-17-StartChange/"/>
      <url>/2014/06/17/Other-2014-2014-06-17-StartChange/</url>
      <content type="html"><![CDATA[<h1 id="Start-Change"><a href="#Start-Change" class="headerlink" title="Start Change"></a>Start Change</h1><p>0617: New Blog start on github</p><p><img src="/img/2014/0617-blog1.jpg" alt="Alt text"></p>]]></content>
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
    </entry>
    
  
  
</search>
